C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE INTERRUPTIONS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\interruptions.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\4.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -interruptions.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP8051
                    -_Keil_951\Release/interruptions.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\interruptions.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // ----------------------------------------------------------------------------
   2          // Copyright (C)  qbrobotics. All rights reserved.
   3          // www.qbrobotics.com
   4          // ----------------------------------------------------------------------------
   5          
   6          /**
   7          * \file         interruptions.c
   8          *
   9          * \brief        Interruption functions are in this file.
  10          * \date         Dic. 1, 2015
  11          * \author       qbrobotics
  12          * \copyright    (C)  qbrobotics. All rights reserved.
  13          */
  14          
  15          
  16          //=================================================================     includes
  17          #include <interruptions.h>
  18          #include <command_processing.h>
  19          
  20          #include "globals.h"
  21          #include "utils.h"
  22          
  23          //===================================================================     global
  24          
  25          
  26          // PWM vaules needed to obtain 12 Volts given a certain input tension
  27          // Numbers are sperimentally calculated //[index] (milliampere)
  28          CYCODE uint8 pwm_preload_values[29] = {100,    //0 (11500)
  29                                                  83,
  30                                                  78,
  31                                                  76,
  32                                                  74,
  33                                                  72,    //5 (14000)
  34                                                  70,
  35                                                  68,
  36                                                  67,
  37                                                  65,
  38                                                  64,    //10 (16500)
  39                                                  63,
  40                                                  62,
  41                                                  61,
  42                                                  60,
  43                                                  59,    //15 (19000)
  44                                                  58,
  45                                                  57,
  46                                                  56,
  47                                                  56,
  48                                                  55,    //20 (21500)
  49                                                  54,
  50                                                  54,
  51                                                  53,
  52                                                  52,
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 2   

  53                                                  52,    //25 (24000)
  54                                                  52,
  55                                                  51,
  56                                                  51};   //28 (25500)
  57          
  58          
  59          //==============================================================================
  60          //                                                            WATCHDOG INTERRUPT
  61          //==============================================================================
  62          
  63          CY_ISR(ISR_WATCHDOG_Handler){
  64   1      
  65   1          // Set WDT flag
  66   1          
  67   1          watchdog_flag = TRUE;
  68   1      
  69   1      }
  70          
  71          //==============================================================================
  72          //                                                            RS485 RX INTERRUPT
  73          //==============================================================================
  74          
  75          CY_ISR(ISR_RS485_RX_ExInterrupt) {
  76   1      
  77   1          // Set RS485 flag
  78   1          
  79   1          interrupt_flag = TRUE;
  80   1           
  81   1      }
  82          
  83          //==============================================================================
  84          //                                                             INTERRUPT MANAGER
  85          //==============================================================================
  86          // Manage interrupt from RS485 
  87          //==============================================================================
  88          // Processing RS-485 data frame:
  89          //
  90          // - WAIT_START:    Waits for beginning characters;
  91          // - WAIT_ID:       Waits for ID;
  92          // - WAIT_LENGTH:   Data length;
  93          // - RECEIVE:       Receive all bytes;
  94          // - UNLOAD:        Wait for another device end of transmission;
  95          //
  96          //==============================================================================
  97          
  98          void interrupt_manager(){
  99   1      
 100   1          //===========================================     local variables definition
 101   1      
 102   1          static uint8 CYDATA state = WAIT_START;                      // state
 103   1          
 104   1          //------------------------------------------------- local data packet
 105   1          static uint8 CYDATA data_packet_index;
 106   1          static uint8 CYDATA data_packet_length;
 107   1          static uint8 data_packet_buffer[128];                     
 108   1          static uint8 CYDATA rx_queue[3];                    // last 2 bytes received
 109   1          //-------------------------------------------------
 110   1      
 111   1          uint8 CYDATA    rx_data;                            // RS485 UART rx data
 112   1          CYBIT           rx_data_type;                       // my id?
 113   1          uint8 CYDATA    package_count = 0;                     
 114   1      
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 3   

 115   1          //======================================================     receive routine
 116   1          
 117   1          // Get data until buffer is not empty 
 118   1          
 119   1          while(UART_RS485_GetRxBufferSize() && (package_count < 6)){  
 120   2              // 6 stima di numero massimo di pacchetti che riesco a leggere senza bloccare l'esecuzione del fir
             -mware
 121   2              
 122   2              // Get next char
 123   2              rx_data = UART_RS485_GetChar();
 124   2              
 125   2              switch (state) {
 126   3                  //-----     wait for frame start     -------------------------------
 127   3                  case WAIT_START:
 128   3                  
 129   3                      rx_queue[0] = rx_queue[1];
 130   3                      rx_queue[1] = rx_queue[2];
 131   3                      rx_queue[2] = rx_data;
 132   3                      
 133   3                      // Check for header configuration package
 134   3                      if ((rx_queue[1] == 58) && (rx_queue[2] == 58)) {
 135   4                          rx_queue[0] = 0;
 136   4                          rx_queue[1] = 0;
 137   4                          rx_queue[2] = 0;
 138   4                          state       = WAIT_ID;                    
 139   4                      }else
 140   3                          if ((rx_queue[0] == 63) &&      //ASCII - ?
 141   3                              (rx_queue[1] == 13) &&      //ASCII - CR
 142   3                              (rx_queue[2] == 10))        //ASCII - LF)
 143   3                              infoGet(INFO_ALL);
 144   3                      break;
 145   3      
 146   3                  //-----     wait for id     ----------------------------------------
 147   3                  case  WAIT_ID:
 148   3      
 149   3                      // packet is for my ID or is broadcast
 150   3                      if (rx_data == c_mem.id || rx_data == 0)
 151   3                          rx_data_type = FALSE;
 152   3                      else                //packet is for others
 153   3                          rx_data_type = TRUE;
 154   3                      
 155   3                      data_packet_length = 0;
 156   3                      state = WAIT_LENGTH;
 157   3                      break;
 158   3      
 159   3                  //-----     wait for length     ------------------------------------
 160   3                  case  WAIT_LENGTH:
 161   3      
 162   3       
 163   3                      data_packet_length = rx_data;
 164   3                      // check validity of pack length
 165   3                      if (data_packet_length <= 1) {
 166   4                          data_packet_length = 0;
 167   4                          state = WAIT_START;
 168   4                      } else if (data_packet_length > 128) {
 169   4                          data_packet_length = 0;
 170   4                          state = WAIT_START;
 171   4                      } else {
 172   4                          data_packet_index = 0;
 173   4                          
 174   4                          if(rx_data_type == FALSE)
 175   4                              state = RECEIVE;          // packet for me or broadcast
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 4   

 176   4                          else
 177   4                              state = UNLOAD;           // packet for others
 178   4                      }
 179   3                      break;
 180   3      
 181   3                  //-----     receiving     -------------------------------------------
 182   3                  case RECEIVE:
 183   3      
 184   3                      data_packet_buffer[data_packet_index] = rx_data;
 185   3                      data_packet_index++;
 186   3                      
 187   3                      // check end of transmission
 188   3                      if (data_packet_index >= data_packet_length) {
 189   4                          // verify if frame ID corresponded to the device ID
 190   4                          if (rx_data_type == FALSE) {
 191   5                              // copying data from buffer to global packet
 192   5                              memcpy(g_rx.buffer, data_packet_buffer, data_packet_length);
 193   5                              g_rx.length = data_packet_length;
 194   5                              g_rx.ready  = 1;
 195   5                              commProcess();
 196   5                          }
 197   4                          
 198   4                          data_packet_index  = 0;
 199   4                          data_packet_length = 0;
 200   4                          state              = WAIT_START;
 201   4                          package_count++;
 202   4                      
 203   4                      }
 204   3                      break;
 205   3      
 206   3                  //-----     other device is receving     ---------------------------
 207   3                  case UNLOAD:
 208   3                      if (!(--data_packet_length)) {
 209   4                          data_packet_index  = 0;
 210   4                          data_packet_length = 0;
 211   4                          RS485_CTS_Write(1);
 212   4                          RS485_CTS_Write(0);
 213   4                          state              = WAIT_START;
 214   4                          package_count++;
 215   4                      }
 216   3                      break;
 217   3              }
 218   2          }
 219   1      }
 220          
 221          //==============================================================================
 222          //                                                            FUNCTION SCHEDULER
 223          //==============================================================================
 224          // Call all the function with the right frequency
 225          //==============================================================================
 226          // Base frequency 1000 Hz
 227          //==============================================================================
 228          
 229          void function_scheduler(void) {
 230   1       
 231   1          static uint16 counter_calibration = DIV_INIT_VALUE;
 232   1          
 233   1          // Start ADC Conversion, SOC = 1
 234   1      
 235   1          timer_value0 = (uint32)MY_TIMER_ReadCounter();
 236   1          
 237   1          ADC_SOC_Write(0x01); 
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 5   

 238   1          
 239   1          // Check Interrupt 
 240   1      
 241   1          if (interrupt_flag){
 242   2              interrupt_flag = FALSE;
 243   2              interrupt_manager();
 244   2          }
 245   1        
 246   1          //---------------------------------- Get Encoders
 247   1      
 248   1          encoder_reading(0); 
 249   1          
 250   1          // Check Interrupt     
 251   1          
 252   1          if (interrupt_flag){
 253   2              interrupt_flag = FALSE;
 254   2              interrupt_manager();
 255   2          }   
 256   1          
 257   1          encoder_reading(1);
 258   1          
 259   1          // Check Interrupt 
 260   1          
 261   1          if (interrupt_flag){
 262   2              interrupt_flag = FALSE;
 263   2              interrupt_manager();
 264   2          }
 265   1          
 266   1          encoder_reading(2);
 267   1          
 268   1          // Check Interrupt 
 269   1          
 270   1          if (interrupt_flag){
 271   2              interrupt_flag = FALSE;
 272   2              interrupt_manager();
 273   2          }
 274   1      
 275   1          encoder_reading(3);
 276   1          
 277   1          // Check Interrupt 
 278   1          
 279   1          if (interrupt_flag){
 280   2              interrupt_flag = FALSE;
 281   2              interrupt_manager();
 282   2          }
 283   1          
 284   1          //---------------------------------- Control Motors
 285   1          
 286   1          motor_control(0);
 287   1      
 288   1          // Check Interrupt 
 289   1      
 290   1          if (interrupt_flag){
 291   2              interrupt_flag = FALSE;
 292   2              interrupt_manager();
 293   2          }
 294   1          
 295   1          motor_control(1);
 296   1          
 297   1          // Check Interrupt 
 298   1          
 299   1          if (interrupt_flag){
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 6   

 300   2              interrupt_flag = FALSE;
 301   2              interrupt_manager();
 302   2          }
 303   1      
 304   1          //---------------------------------- Read conversion buffer - LOCK function
 305   1      
 306   1          analog_read_end();
 307   1      
 308   1          //---------------------------------- Calibration 
 309   1      
 310   1          // Divider 100, freq = 10 Hz
 311   1          if (!(calibration_flag == STOP)) {
 312   2              if (counter_calibration == CALIBRATION_DIV) {
 313   3                  calibration();
 314   3                  counter_calibration = 0;
 315   3              }
 316   2              counter_calibration++;
 317   2          }
 318   1          // Check Interrupt 
 319   1          
 320   1          if (interrupt_flag){
 321   2              interrupt_flag = FALSE;
 322   2              interrupt_manager();
 323   2          }
 324   1         
 325   1          //---------------------------------- Update States
 326   1          
 327   1          // Load k-1 state
 328   1          memcpy( &g_measOld, &g_meas, sizeof(g_meas) );
 329   1          memcpy( &g_refOld, &g_ref, sizeof(g_ref) );
 330   1      
 331   1          // Load k+1 state
 332   1          memcpy( &g_ref, &g_refNew, sizeof(g_ref) );
 333   1      
 334   1          if (interrupt_flag){
 335   2              interrupt_flag = FALSE;
 336   2              interrupt_manager();
 337   2          }
 338   1      
 339   1          //CyDelayUs(100);
 340   1      
 341   1          timer_value = (uint32)MY_TIMER_ReadCounter();
 342   1          MY_TIMER_WriteCounter(5000000);
 343   1      
 344   1      }
 345          
 346          
 347          //==============================================================================
 348          //                                                                MOTORS CONTROL
 349          //==============================================================================
 350          
 351          void motor_control(const uint8 idx) {
 352   1          
 353   1          uint8 CYDATA index = idx;
 354   1       
 355   1          int32 CYDATA curr_ref;
 356   1      
 357   1          int32 CYDATA pwm_input = 0;
 358   1          
 359   1          int32 CYDATA pos_error;
 360   1          int32 CYDATA curr_error;
 361   1          int32 CYDATA handle_value;
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 7   

 362   1      
 363   1          int32 CYDATA err_emg_1, err_emg_2;
 364   1          int32 CYDATA err_joy_1, err_joy_2;
 365   1          int32 CYDATA pos_diff, pos_sum;
 366   1          
 367   1          int32 CYDATA k_p = c_mem.k_p;  
 368   1          int32 CYDATA k_i = c_mem.k_i; 
 369   1          int32 CYDATA k_d = c_mem.k_d; 
 370   1      
 371   1          int32 /*CYDATA*/ k_p_c = c_mem.k_p_c;  
 372   1          int32 /*CYDATA*/ k_i_c = c_mem.k_i_c; 
 373   1          int32 /*CYDATA*/ k_d_c = c_mem.k_d_c;   
 374   1      
 375   1          int32 /*CYDATA*/ k_p_dl = c_mem.k_p_dl;  
 376   1          int32 /*CYDATA*/ k_i_dl = c_mem.k_i_dl; 
 377   1          int32 /*CYDATA*/ k_d_dl = c_mem.k_d_dl; 
 378   1      
 379   1          int32 /*CYDATA*/ k_p_c_dl = c_mem.k_p_c_dl;  
 380   1          int32 /*CYDATA*/ k_i_c_dl = c_mem.k_i_c_dl; 
 381   1          int32 /*CYDATA*/ k_d_c_dl = c_mem.k_d_c_dl;  
 382   1      
 383   1          // Static Variables
 384   1          
 385   1          static CYBIT dirM0, dirM1;
 386   1          
 387   1          static int32 pos_error_sum[NUM_OF_MOTORS];
 388   1          static int32 curr_error_sum[NUM_OF_MOTORS];
 389   1          static int32 prev_curr_err[NUM_OF_MOTORS];
 390   1          static int32 prev_pos_err[NUM_OF_MOTORS];
 391   1      
 392   1          static uint8 current_emg = 0;   // 0 NONE
 393   1                                          // 1 EMG 1
 394   1                                          // 2 EMG 2
 395   1                                          // wait for both to get down
 396   1      
 397   1          err_emg_1 = g_meas.emg[0] - c_mem.emg_threshold[0];
 398   1          err_emg_2 = g_meas.emg[1] - c_mem.emg_threshold[1];
 399   1      
 400   1          // check index value
 401   1          if (index >= NUM_OF_MOTORS)
 402   1              return;
 403   1          // --------------- USE THIRD ENCODER AS INPUT FOR BOTH MOTORS --------------
 404   1          switch(c_mem.input_mode) {
 405   2      
 406   2              case INPUT_MODE_ENCODER3:
 407   2      /*
 408   2                  // Calculate handle value based on position of handle in the
 409   2                  // sensor chain and multiplication factor between handle and motor position
 410   2                  if (c_mem.double_encoder_on_off) 
 411   2                      handle_value = g_meas.pos[2] * c_mem.motor_handle_ratio;
 412   2                  else
 413   2                      handle_value = g_meas.pos[1] * c_mem.motor_handle_ratio;
 414   2                  
 415   2      
 416   2                  // Read handle and use it as reference for the motor
 417   2                  if (((handle_value - g_ref.pos[0]) > c_mem.max_step_pos) && (c_mem.max_step_pos != 0))
 418   2                      g_ref.pos[0] += c_mem.max_step_pos;
 419   2                  else {
 420   2                      if (((handle_value - g_ref.pos[0]) < c_mem.max_step_neg) && (c_mem.max_step_neg != 0))
 421   2                          g_ref.pos[0] += c_mem.max_step_neg;
 422   2                      else
 423   2                      g_ref.pos[0] = handle_value;
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 8   

 424   2                  }
 425   2      */
 426   2              break;
 427   2      
 428   2              case INPUT_MODE_EMG_PROPORTIONAL:
 429   2      /*            if (err_emg_1 > 0)
 430   2                      g_ref.pos[0] = (err_emg_1 * g_mem.pos_lim_sup[0]) / (1024 - c_mem.emg_threshold[0]);
 431   2                  else
 432   2                      g_ref.pos[0] = 0;
 433   2      */
 434   2              break;
 435   2      
 436   2              case INPUT_MODE_EMG_INTEGRAL:
 437   2      /*            if (err_emg_1 > 0)
 438   2                      g_ref.pos[0] += (err_emg_1 * g_mem.emg_speed << 1) / (1024 - c_mem.emg_threshold[0]);
 439   2      
 440   2                  if (err_emg_2 > 0) 
 441   2                      g_ref.pos[0] -= (err_emg_2 * g_mem.emg_speed << 1) / (1024 - c_mem.emg_threshold[1]);
 442   2      */            
 443   2              break;
 444   2      
 445   2              case INPUT_MODE_EMG_FCFS:
 446   2      /*            switch (current_emg) {
 447   2                      case 0:
 448   2                          // Look for the first EMG passing the threshold
 449   2                          if (err_emg_1 > 0) {
 450   2                              current_emg = 1;
 451   2                              break;
 452   2                          }
 453   2                          if (err_emg_2 > 0) {
 454   2                              current_emg = 2;
 455   2                              break;
 456   2                          }
 457   2                          break;
 458   2      
 459   2                      case 1:
 460   2                          // EMG 1 is first
 461   2                          if (err_emg_1 < 0) {
 462   2                              current_emg = 0;
 463   2                              break;
 464   2                          }
 465   2                          g_ref.pos[0] += (err_emg_1 * g_mem.emg_speed * 2) / (1024 - c_mem.emg_threshold[0]);
 466   2                          break;
 467   2      
 468   2                      case 2:
 469   2                          // EMG 2 is first
 470   2                          if (err_emg_2 < 0) {
 471   2                              current_emg = 0;
 472   2                              break;
 473   2                          }
 474   2                          g_ref.pos[0] -= (err_emg_2 * g_mem.emg_speed * 2) / (1024 - c_mem.emg_threshold[1]);
 475   2                          break;
 476   2      
 477   2                      default:
 478   2                          break;
 479   2                  }
 480   2      */
 481   2              break;
 482   2      
 483   2              case INPUT_MODE_EMG_FCFS_ADV:
 484   2      /*            switch (current_emg) {
 485   2                      // Look for the first EMG passing the threshold
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 9   

 486   2                      case 0:
 487   2                          if (err_emg_1 > 0) {
 488   2                              current_emg = 1;
 489   2                              break;
 490   2                          }
 491   2                          if (err_emg_2 > 0) {
 492   2                              current_emg = 2;
 493   2                              break;
 494   2                          }
 495   2                          break;
 496   2      
 497   2                      // EMG 1 is first
 498   2                      case 1:
 499   2                          // If both signals are under threshold go back to status 0
 500   2                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 501   2                              current_emg = 0;
 502   2                              break;
 503   2                          }
 504   2                          // but if the current signal come back over threshold, continue using it
 505   2                          if (err_emg_1 > 0) 
 506   2                              g_ref.pos[0] += (err_emg_1 * g_mem.emg_speed << 2) / (1024 - c_mem.emg_threshold[0
             -]);
 507   2                          
 508   2                          break;
 509   2      
 510   2                      // EMG 2 is first
 511   2                      case 2:
 512   2                          // If both signals are under threshold go back to status 0
 513   2                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 514   2                              current_emg = 0;
 515   2                              break;
 516   2                          }
 517   2                          // but if the current signal come back over threshold, continue using it
 518   2                          if (err_emg_2 > 0) {
 519   2                              g_ref.pos[0] -= (err_emg_2 * c_mem.emg_speed << 2) / (1024 - c_mem.emg_threshold[1
             -]);
 520   2                          }
 521   2                          break;
 522   2      
 523   2                      default:
 524   2                          break;
 525   2                  }
 526   2      */
 527   2              break;
 528   2              
 529   2              case INPUT_MODE_JOYSTICK:
 530   2      
 531   2                  err_joy_1 = 0;
 532   2                  err_joy_2 = 0;
 533   2                  if(!(g_meas.joystick[0] > 900)) {
 534   3                      err_joy_1 = g_meas.joystick[0] - g_mem.joystick_threshold;
 535   3      
 536   3                      //if (err_joy_1 > 0) {   
 537   3                      if(g_meas.joystick[0] > g_mem.joystick_threshold) {     //both motors wind the wire around
             - the pulley
 538   4                          g_refNew.pos[0] += ((int32) err_joy_1 * g_mem.closure_speed) / (1024 - g_mem.joystick_
             -threshold);
 539   4                          g_refNew.pos[1] += ((int32) err_joy_1 * g_mem.closure_speed) / (1024 - g_mem.joystick_
             -threshold);
 540   4      
 541   4                          /*temp = ((g_ref.pos[0] + g_ref.pos[1]) / 2) - c_mem.pos_lim_sup[0];
 542   4                          if(temp > 0) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 10  

 543   4                              g_ref.pos[0] -= temp;
 544   4                              g_ref.pos[1] -= temp;
 545   4                          }*/
 546   4                      }
 547   3                      else {
 548   4                          err_joy_1 = g_meas.joystick[0] + g_mem.joystick_threshold;
 549   4                          //if (err_joy_1 < 0) {
 550   4                          if(g_meas.joystick[0] < -g_mem.joystick_threshold) {  //both motors unroll the wire ar
             -ound the pulley
 551   5                              g_refNew.pos[0] += ((int32) err_joy_1 * g_mem.closure_speed) / (1024 - g_mem.joyst
             -ick_threshold);
 552   5                              g_refNew.pos[1] += ((int32) err_joy_1 * g_mem.closure_speed) / (1024 - g_mem.joyst
             -ick_threshold);
 553   5      
 554   5                              /*temp = ((g_ref.pos[0] + g_ref.pos[1]) / 2);
 555   5                              if(temp < 0) {
 556   5                                  g_ref.pos[0] -= temp;
 557   5                                  g_ref.pos[1] -= temp;
 558   5                              }*/
 559   5                          }
 560   4                      }
 561   3      
 562   3                      err_joy_2 = g_meas.joystick[1] - g_mem.joystick_threshold;
 563   3                      //if(err_joy_2 > 0) {
 564   3                      if(g_meas.joystick[1] > g_mem.joystick_threshold) {    //The wire is winded around the fir
             -st pulley and unwinded from the second one
 565   4                          g_refNew.pos[0] += ((int32) err_joy_2 * g_mem.closure_speed) / (1024 - g_mem.joystick_
             -threshold);
 566   4                          g_refNew.pos[1] -= ((int32) err_joy_2 * g_mem.closure_speed) / (1024 - g_mem.joystick_
             -threshold);
 567   4                      
 568   4                          /*temp = g_ref.pos[1] - c_mem.pos_lim_inf[1]; 
 569   4                          if(temp < 0) {
 570   4                              g_ref.pos[0] += temp;
 571   4                              g_ref.pos[1] -= temp;
 572   4                          }*/
 573   4                      }
 574   3                      else {
 575   4                          err_joy_2 = g_meas.joystick[1] + g_mem.joystick_threshold;
 576   4                          //if(err_joy_2 < 0) {
 577   4                          if(g_meas.joystick[1] < -g_mem.joystick_threshold) {  //The wire is unwinded from the 
             -first pulley and winded on the second one
 578   5                              g_refNew.pos[0] += ((int32) err_joy_2 * g_mem.closure_speed) / (1024 - g_mem.joyst
             -ick_threshold);
 579   5                              g_refNew.pos[1] -= ((int32) err_joy_2 * g_mem.closure_speed) / (1024 - g_mem.joyst
             -ick_threshold);
 580   5      
 581   5                              /*temp = g_ref.pos[0] - c_mem.pos_lim_inf[0]; 
 582   5                              if(temp < 0) {
 583   5                                  g_ref.pos[0] -= temp;
 584   5                                  g_ref.pos[1] += temp;
 585   5                              }*/
 586   5                          }
 587   4                      }
 588   3                  }
 589   2      
 590   2                  else {  //The button is pressed and the hand is opened firstly making the position difference
 591   3                          //equal to zero, then the position sum is gradually set to zero 
 592   3                      pos_diff = (g_meas.pos[0] - g_meas.pos[1]) >> c_mem.res[0];
 593   3                      pos_sum = (g_meas.pos[0] + g_meas.pos[1]) >> c_mem.res[0];
 594   3      
 595   3                      if(abs(pos_diff) > 500) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 11  

 596   4                          if(SIGN(pos_diff) == 1) {
 597   5                              g_refNew.pos[1] += g_mem.closure_speed;
 598   5                              g_refNew.pos[0] -= g_mem.closure_speed / 2;
 599   5                          }
 600   4                          else {
 601   5                              g_refNew.pos[0] += g_mem.closure_speed;
 602   5                              g_refNew.pos[1] -= g_mem.closure_speed / 2;
 603   5                          }
 604   4                          /*temp = ((g_ref.pos[0] + g_ref.pos[1]) / 2) - c_mem.pos_lim_sup[0];
 605   4                          if(temp > 0) {
 606   4                              g_ref.pos[0] -= temp;
 607   4                              g_ref.pos[1] -= temp;
 608   4                          }*/
 609   4                      }
 610   3                      else {
 611   4                          if(pos_sum > 0) {
 612   5                              g_refNew.pos[0] -= g_mem.closure_speed * 2;
 613   5                              g_refNew.pos[1] -= g_mem.closure_speed * 2;
 614   5                              if(g_refNew.pos[0] < 0)
 615   5                                  g_refNew.pos[0] = 0;
 616   5                              if(g_refNew.pos[1] < 0);
 617   5                                  g_refNew.pos[1] = 0;
 618   5                          }
 619   4                      }
 620   3                  }
 621   2              
 622   2              break;
 623   2      
 624   2              default:
 625   2                  break;
 626   2          }
 627   1      
 628   1          switch(c_mem.control_mode) {
 629   2              case CONTROL_ANGLE:
 630   2              
 631   2                  pos_error = g_ref.pos[index] - g_meas.pos[index << 1];
 632   2                 
 633   2                  if (interrupt_flag){
 634   3                      interrupt_flag = FALSE;
 635   3                      interrupt_manager();
 636   3                  }
 637   2                  
 638   2                  // error sum for integral
 639   2                  pos_error_sum[index] += pos_error;
 640   2      
 641   2                  //anti wind-up
 642   2                  if (pos_error_sum[index] > ANTI_WINDUP)
 643   2                      pos_error_sum[index] = ANTI_WINDUP;
 644   2                  else {
 645   3                      if (pos_error_sum[index] < -ANTI_WINDUP)
 646   3                          pos_error_sum[index] = -ANTI_WINDUP;
 647   3                  }
 648   2                    
 649   2                  if (interrupt_flag){
 650   3                      interrupt_flag = FALSE;
 651   3                      interrupt_manager();
 652   3                  }
 653   2                  // pwm_input init
 654   2                  pwm_input = 0;
 655   2                  // Proportional
 656   2                  if (k_p != 0) 
 657   2                      pwm_input = (int32)(k_p * pos_error) >> 16;
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 12  

 658   2                            
 659   2                  // Integral
 660   2                  if (k_i != 0) 
 661   2                      pwm_input += (int32)(k_i * pos_error_sum[index]) >> 16;
 662   2                  
 663   2                  // Derivative
 664   2                  if (k_d != 0)
 665   2                      pwm_input += (int32)(k_d * (pos_error - prev_pos_err[index])) >> 16;
 666   2               
 667   2                  prev_pos_err[index] = pos_error;
 668   2                      
 669   2                  if (interrupt_flag){
 670   3                      interrupt_flag = FALSE;
 671   3                      interrupt_manager();
 672   3                  }
 673   2                  
 674   2      
 675   2                  if (index == 0){
 676   3                      if (pwm_input >= 0)
 677   3                          dirM0 = 1;
 678   3                          //direction |= 0x01;
 679   3                      else
 680   3                          dirM0 = 0;
 681   3                          //direction &= 0xFE;
 682   3                  }
 683   2                  else { // index == 1
 684   3                      if (pwm_input >= 0)
 685   3                          dirM1 = 1;
 686   3                         // direction |= 0x02;
 687   3                      else
 688   3                          dirM1 = 0;
 689   3                          //direction &= 0xFD;
 690   3                  }
 691   2                  
 692   2              break;
 693   2      
 694   2              case CURR_AND_POS_CONTROL:
 695   2      
 696   2                  pos_error = g_ref.pos[index] - g_meas.pos[index << 1];
 697   2      
 698   2                  pos_error_sum[index] += pos_error;
 699   2      
 700   2                  if (interrupt_flag){
 701   3                      interrupt_flag = FALSE;
 702   3                      interrupt_manager();
 703   3                  }
 704   2      
 705   2                  // error_sum saturation
 706   2                  if (pos_error_sum[index] > POS_INTEGRAL_SAT_LIMIT)
 707   2                      pos_error_sum[index] = POS_INTEGRAL_SAT_LIMIT;
 708   2                  else {
 709   3                      if (pos_error_sum[index] < -POS_INTEGRAL_SAT_LIMIT)
 710   3                          pos_error_sum[index] = -POS_INTEGRAL_SAT_LIMIT;
 711   3                  }
 712   2                  // ------ position PID control -----
 713   2      
 714   2                  curr_ref = 0;
 715   2      
 716   2                  if (interrupt_flag){
 717   3                      interrupt_flag = FALSE;
 718   3                      interrupt_manager();
 719   3                  }
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 13  

 720   2      
 721   2                  // Proportional
 722   2                  if (k_p_dl != 0)
 723   2                      curr_ref += (int32)(k_p_dl * pos_error) >> 16;
 724   2      
 725   2                  // Integral
 726   2                  if (k_i_dl != 0)
 727   2                      curr_ref += (int32)(k_i_dl * pos_error_sum[index]) >> 16;
 728   2                  
 729   2                  // Derivative
 730   2                  if (k_d_dl != 0)
 731   2                      curr_ref += (int32)(k_d_dl * (pos_error - prev_pos_err[index])) >> 16;
 732   2      
 733   2                  prev_pos_err[index] = pos_error;
 734   2                              
 735   2                  if (interrupt_flag){
 736   3                      interrupt_flag = FALSE;
 737   3                      interrupt_manager();
 738   3                  }
 739   2      
 740   2                  // saturate max current
 741   2                  if (curr_ref > c_mem.current_limit)
 742   2                      curr_ref = c_mem.current_limit;
 743   2                  else {
 744   3                      if (curr_ref < -c_mem.current_limit)
 745   3                          curr_ref = -c_mem.current_limit;
 746   3                  }
 747   2      
 748   2                  if (interrupt_flag){
 749   3                      interrupt_flag = FALSE;
 750   3                      interrupt_manager();
 751   3                  }
 752   2      
 753   2                  // current error and error sum
 754   2                  curr_error = curr_ref - g_meas.curr[index];
 755   2                  curr_error_sum[index] += curr_error;
 756   2      
 757   2                  if (curr_error_sum[index] > CURR_INTEGRAL_SAT_LIMIT)
 758   2                      curr_error_sum[index] = CURR_INTEGRAL_SAT_LIMIT;
 759   2                  else{
 760   3                      if (curr_error_sum[index] < -CURR_INTEGRAL_SAT_LIMIT)
 761   3                          curr_error_sum[index] = -CURR_INTEGRAL_SAT_LIMIT;
 762   3                  }
 763   2      
 764   2                  if (interrupt_flag){
 765   3                      interrupt_flag = FALSE;
 766   3                      interrupt_manager();
 767   3                  }
 768   2      
 769   2                  // ----- current PID control -----
 770   2      
 771   2                  pwm_input = 0;
 772   2      
 773   2                  // Proportional
 774   2                  if (k_p_c_dl != 0)
 775   2                      pwm_input += (int32)(k_p_c_dl * curr_error) >> 16;
 776   2                  
 777   2                  // Integral
 778   2                  if (k_i_c_dl != 0)
 779   2                      pwm_input += (int32)(k_i_c_dl * curr_error_sum[index]) >> 16;
 780   2                  
 781   2                  // Derivative
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 14  

 782   2                  if (k_d_c_dl != 0)
 783   2                      pwm_input += (int32)(k_d_c_dl * (curr_error - prev_curr_err[index])) >> 16;
 784   2      
 785   2                  prev_curr_err[index] = curr_error;
 786   2      
 787   2                  if (interrupt_flag){
 788   3                      interrupt_flag = FALSE;
 789   3                      interrupt_manager();
 790   3                  }
 791   2      
 792   2                  if (index == 0){
 793   3                      if (pwm_input >= 0)
 794   3                          dirM0 = 1;
 795   3                          //direction |= 0x01;
 796   3                      else
 797   3                          dirM0 = 0;
 798   3                          //direction &= 0xFE;
 799   3                  }
 800   2                  else { // index == 1
 801   3                      if (pwm_input >= 0)
 802   3                          dirM1 = 1;
 803   3                         // direction |= 0x02;
 804   3                      else
 805   3                          dirM1 = 0;
 806   3                          //direction &= 0xFD;
 807   3                  }
 808   2      
 809   2              break;
 810   2      
 811   2              case CONTROL_CURRENT:
 812   2                  if(g_ref.onoff && tension_valid) {
 813   3                      // Current ref from pos ref
 814   3                      curr_ref = g_ref.pos[index] >> g_mem.res[index];
 815   3      
 816   3                      // saturate max current
 817   3                      if (curr_ref > c_mem.current_limit)
 818   3                          curr_ref = c_mem.current_limit;
 819   3                      else {
 820   4                          if(curr_ref < -c_mem.current_limit)
 821   4                             curr_ref = -c_mem.current_limit;
 822   4                      }
 823   3                      // Current error
 824   3                      curr_error = curr_ref - g_meas.curr[index];
 825   3      
 826   3                      // Error sum for integral
 827   3                      curr_error_sum[index] += curr_error;
 828   3      
 829   3                      //anti wind-up
 830   3                      if (curr_error_sum[index] > CURR_INTEGRAL_SAT_LIMIT)
 831   3                          curr_error_sum[index] = CURR_INTEGRAL_SAT_LIMIT;
 832   3                      else {
 833   4                          if (curr_error_sum[index] < -CURR_INTEGRAL_SAT_LIMIT)
 834   4                              curr_error_sum[index] = -CURR_INTEGRAL_SAT_LIMIT;
 835   4                      }
 836   3      
 837   3                      if (interrupt_flag){
 838   4                          interrupt_flag = FALSE;
 839   4                          interrupt_manager();
 840   4                      }
 841   3      
 842   3                      // pwm_input init
 843   3                      pwm_input = 0;
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 15  

 844   3      
 845   3                      // Proportional
 846   3                      if (k_p_c != 0)
 847   3                          pwm_input += (int32)(k_p * curr_error) >> 16;
 848   3      
 849   3                      // Integral
 850   3                      if (k_i_c != 0)
 851   3                          pwm_input += (int32)(k_i_c * (curr_error_sum[index] >> 6)) >> 10;
 852   3                      
 853   3                      // Derivative
 854   3                      if (k_d_c != 0)
 855   3                          pwm_input += (int32)(k_d_c * (curr_error - prev_curr_err[index])) >> 16;
 856   3      
 857   3                      if (interrupt_flag){
 858   4                          interrupt_flag = FALSE;
 859   4                          interrupt_manager();
 860   4                      }
 861   3      
 862   3                      // Update measure
 863   3                      prev_curr_err[index] = curr_error;
 864   3                      
 865   3                      if (index == 0) {
 866   4                          if (pwm_input >= 0)
 867   4                              dirM0 = 1;
 868   4                              //direction |= 0x01;
 869   4                          else
 870   4                              dirM0 = 0;
 871   4                              //direction &= 0xFE;
 872   4                      }
 873   3                      else { // index == 1
 874   4                          if (pwm_input >= 0)
 875   4                              dirM1 = 1;
 876   4                             // direction |= 0x02;
 877   4                          else
 878   4                              dirM1 = 0;
 879   4                              //direction &= 0xFD;
 880   4                      }
 881   3      
 882   3                      if (interrupt_flag){
 883   4                          interrupt_flag = FALSE;
 884   4                          interrupt_manager();
 885   4                      }
 886   3                  }
 887   2      
 888   2              break;
 889   2      
 890   2              case CONTROL_PWM:
 891   2                  // Direct PWM value
 892   2                  pwm_input = g_ref.pos[index] >> g_mem.res[index];
 893   2      
 894   2                  if (index == 0) {
 895   3                      if (pwm_input >= 0)
 896   3                          dirM0 = 1;
 897   3                          //direction |= 0x01;
 898   3                      else
 899   3                          dirM0 = 0;
 900   3                          //direction &= 0xFE;
 901   3                  }
 902   2                  else { // index == 1
 903   3                      if (pwm_input >= 0)
 904   3                          dirM1 = 1;
 905   3                         // direction |= 0x02;
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 16  

 906   3                      else
 907   3                          dirM1 = 0;
 908   3                          //direction &= 0xFD;
 909   3                  }
 910   2      
 911   2              break;
 912   2      
 913   2              default:
 914   2                  break;
 915   2          }
 916   1          
 917   1          if (interrupt_flag){
 918   2              interrupt_flag = FALSE;
 919   2              interrupt_manager();
 920   2          }
 921   1              
 922   1          // abs(pwm_input) must be lower or equal to PWM_MAX_VALUE
 923   1          if(pwm_input >  PWM_MAX_VALUE) 
 924   1              pwm_input =  PWM_MAX_VALUE;
 925   1          if(pwm_input < -PWM_MAX_VALUE) 
 926   1              pwm_input = -PWM_MAX_VALUE;
 927   1          
 928   1          if (interrupt_flag){
 929   2              interrupt_flag = FALSE;
 930   2              interrupt_manager();
 931   2          }   
 932   1      
 933   1          // remap pwm_input on pwm_limit based on input tension to have maximum 8 volts
 934   1          if (c_mem.control_mode != CONTROL_PWM)
 935   1              pwm_input = (((pwm_input << 10) / PWM_MAX_VALUE) * dev_pwm_limit) >> 10;
 936   1      
 937   1          // drive direction and pwm duty cycle
 938   1              
 939   1          if (dirM0){
 940   2              if (dirM1)
 941   2                  MOTOR_DIR_Write(0x03);
 942   2              else
 943   2                  MOTOR_DIR_Write(0x01);
 944   2          }
 945   1          else{
 946   2              if (dirM1)
 947   2                  MOTOR_DIR_Write(0x02);
 948   2              else
 949   2                  MOTOR_DIR_Write(0x00);
 950   2          }
 951   1      
 952   1          if (interrupt_flag){
 953   2              interrupt_flag = FALSE;
 954   2              interrupt_manager();
 955   2          }
 956   1          
 957   1          if (index == 0) {
 958   2              pwm_sign[0] = SIGN(pwm_input);
 959   2              PWM_MOTORS_WriteCompare1(abs(pwm_input));
 960   2          }
 961   1          else { // index == 1
 962   2              pwm_sign[1] = SIGN(pwm_input);
 963   2              PWM_MOTORS_WriteCompare2(abs(pwm_input));
 964   2          }
 965   1          
 966   1          if (interrupt_flag){
 967   2              interrupt_flag = FALSE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 17  

 968   2              interrupt_manager();
 969   2          }
 970   1      }
*** WARNING C280 IN LINE 361 OF interruptions.c: 'handle_value': unreferenced local variable
*** WARNING C280 IN LINE 392 OF interruptions.c: 'current_emg': unreferenced local variable
 971          
 972          //==============================================================================
 973          //                                                           ANALOG MEASUREMENTS
 974          //==============================================================================
 975          
 976          void analog_read_end() {
 977   1             
 978   1          /* =========================================================================
 979   1          /   Ideal formulation to calculate tension and current
 980   1          /
 981   1          /   tension = ((read_value_mV - offset) * 101) / gain -> [mV]
 982   1          /   current = ((read_value_mV - offset) * 375) / (gain * resistor) -> [mA]
 983   1          /
 984   1          /   Definition:
 985   1          /   read_value_mV = counts_read / 0.819 -> conversion from counts to mV
 986   1          /   offset = 2000 -> hardware amplifier bias in mV
 987   1          /   gain = 8.086 -> amplifier gain
 988   1          /   resistor = 18 -> resistor of voltage divider in KOhm 
 989   1          /
 990   1          /   Real formulation: tradeoff in good performance and accurancy, ADC_buf[] 
 991   1          /   and offset unit of measurment is counts, instead dev_tension and
 992   1          /   g_meas.curr[] are converted in properly unit.
 993   1          /  =========================================================================
 994   1          */
 995   1      
 996   1          int16 CYDATA i_aux;
 997   1      
 998   1          static emg_status CYDATA emg_1_status = RESET; 
 999   1          static emg_status CYDATA emg_2_status = RESET; 
1000   1      
1001   1          static joystick_status CYDATA UD_status = RESET;
1002   1          static joystick_status CYDATA LR_status = RESET;                                          
1003   1          
1004   1          static uint16 emg_counter_1 = 0;
1005   1          static uint16 emg_counter_2 = 0;
1006   1      
1007   1          static uint16 UD_counter = 0;
1008   1          static uint16 LR_counter = 0;
1009   1          
1010   1          static int32 UD_mean_value;
1011   1          static int32 LR_mean_value;
1012   1          
1013   1          // Wait for conversion end
1014   1          while(!ADC_STATUS_Read()){
1015   2              if (interrupt_flag){
1016   3                  interrupt_flag = FALSE;
1017   3                  interrupt_manager();
1018   3              }
1019   2          }
1020   1          
1021   1          // Convert tension read
1022   1          dev_tension = ((int32)(ADC_buf[0] - 1638) * 1952) >> 7;
1023   1          
1024   1          if (interrupt_flag){
1025   2              interrupt_flag = FALSE;
1026   2              interrupt_manager();
1027   2          }
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 18  

1028   1      
1029   1          // Until there is no valid input tension repeat this measurement
1030   1          
1031   1          if (dev_tension > 0){
1032   2              
1033   2              // Set PWM depends on tension
1034   2              pwm_limit_search();
1035   2              
1036   2              // Check Interrupt 
1037   2          
1038   2              if (interrupt_flag){
1039   3                  interrupt_flag = FALSE;
1040   3                  interrupt_manager();
1041   3              }
1042   2      
1043   2              // Filter and Set currents
1044   2              g_meas.curr[0] = filter_i1((int16) pwm_sign[0] * (((int32)(ADC_buf[1] - 1638) * 25771) >> 13));
1045   2              
1046   2              // Check Interrupt 
1047   2          
1048   2              if (interrupt_flag){
1049   3                  interrupt_flag = FALSE;
1050   3                  interrupt_manager();
1051   3              }
1052   2              g_meas.curr[1] = filter_i2((int16) pwm_sign[1] * (((int32)(ADC_buf[2] - 1638) * 25771) >> 13));
1053   2              
1054   2              // Check Interrupt 
1055   2          
1056   2              if (interrupt_flag){
1057   3                  interrupt_flag = FALSE;
1058   3                  interrupt_manager();
1059   3              }
1060   2              // if calibration is not needed go to "normal execution"
1061   2              if (!g_mem.emg_calibration_flag){
1062   3                  emg_1_status = 0; // normal execution
1063   3                  emg_2_status = 0; // normal execution
1064   3              }
1065   2      
1066   2              // EMG 1 calibration state machine
1067   2              
1068   2              // Calibration state machine
1069   2              switch(emg_1_status) {
1070   3                  case NORMAL: // normal execution
1071   3                      i_aux = filter_ch1(ADC_buf[3]);
1072   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[0];
1073   3          
1074   3                      if (interrupt_flag){
1075   4                          interrupt_flag = FALSE;
1076   4                          interrupt_manager();
1077   4                      }
1078   3                      //Saturation
1079   3                      if (i_aux < 0)
1080   3                          i_aux = 0;
1081   3                      else 
1082   3                          if (i_aux > 1024) 
1083   3                              i_aux = 1024;
1084   3                      
1085   3                      g_meas.emg[0] = i_aux;
1086   3          
1087   3                      if (interrupt_flag){
1088   4                          interrupt_flag = FALSE;
1089   4                          interrupt_manager();
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 19  

1090   4                      }
1091   3                      
1092   3                      break;
1093   3      
1094   3                  case RESET: // reset variables
1095   3                      emg_counter_1 = 0;
1096   3                      g_mem.emg_max_value[0] = 0;
1097   3                      emg_1_status = DISCARD; // goto next status
1098   3                      
1099   3                      break;
1100   3      
1101   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1102   3                      emg_counter_1++;
1103   3                      if (emg_counter_1 == EMG_SAMPLE_TO_DISCARD) {
1104   4                          emg_counter_1 = 0;          // reset counter
1105   4                          LED_REG_Write(0x01);        // turn on LED
1106   4                              
1107   4                          if (interrupt_flag){
1108   5                              interrupt_flag = FALSE;
1109   5                              interrupt_manager();
1110   5                          }
1111   4                          
1112   4                          emg_1_status = SUM_AND_MEAN;           // sum and mean status
1113   4                      }
1114   3                      break;
1115   3      
1116   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1117   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1118   3                      emg_counter_1++;
1119   3                      g_mem.emg_max_value[0] += filter_ch1(ADC_buf[3]);
1120   3                      
1121   3                      if (interrupt_flag){
1122   4                          interrupt_flag = FALSE;
1123   4                          interrupt_manager();
1124   4                      }
1125   3                      
1126   3                      if (emg_counter_1 == SAMPLES_FOR_EMG_MEAN) {
1127   4                          g_mem.emg_max_value[0] = g_mem.emg_max_value[0] / SAMPLES_FOR_EMG_MEAN; // calc mean
1128   4          
1129   4                          if (interrupt_flag){
1130   5                              interrupt_flag = FALSE;
1131   5                              interrupt_manager();
1132   5                          }                    
1133   4                          
1134   4                          LED_REG_Write(0x00);        // led OFF
1135   4                          emg_counter_1 = 0;          // reset counter
1136   4      
1137   4                          emg_1_status = NORMAL;           // goto normal execution
1138   4                      }
1139   3                      break;
1140   3      
1141   3                  default:
1142   3                      break;
1143   3              }
1144   2          
1145   2              if (interrupt_flag){
1146   3                  interrupt_flag = FALSE;
1147   3                  interrupt_manager();
1148   3              }
1149   2              // EMG 2 calibration state machine
1150   2              switch(emg_2_status) {
1151   3                  case NORMAL: // normal execution
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 20  

1152   3                      i_aux = filter_ch2(ADC_buf[4]);
1153   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[1];
1154   3          
1155   3                      if (interrupt_flag){
1156   4                          interrupt_flag = FALSE;
1157   4                          interrupt_manager();
1158   4                      }
1159   3                      
1160   3                      if (i_aux < 0) 
1161   3                          i_aux = 0;
1162   3                      else 
1163   3                          if (i_aux > 1024)
1164   3                              i_aux = 1024;
1165   3                      
1166   3                      g_meas.emg[1] = i_aux;
1167   3      
1168   3                      break;
1169   3      
1170   3                  case RESET: // reset variables
1171   3                      emg_counter_2 = 0;
1172   3                      g_mem.emg_max_value[1] = 0;
1173   3          
1174   3                      if (interrupt_flag){
1175   4                          interrupt_flag = FALSE;
1176   4                          interrupt_manager();
1177   4                      }
1178   3                      
1179   3                      emg_2_status = WAIT; // wait for EMG 1 calibration
1180   3                      break;
1181   3      
1182   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1183   3                      emg_counter_2++;
1184   3                      if (emg_counter_2 == EMG_SAMPLE_TO_DISCARD) {
1185   4                          emg_counter_2 = 0;          // reset counter
1186   4                          LED_REG_Write(0x01);        // turn on LED
1187   4          
1188   4                          if (interrupt_flag){
1189   5                              interrupt_flag = FALSE;
1190   5                              interrupt_manager();
1191   5                          }
1192   4                          
1193   4                          emg_2_status = SUM_AND_MEAN;           // sum and mean status
1194   4                      }
1195   3                      break;
1196   3      
1197   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1198   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1199   3                      emg_counter_2++;
1200   3                      g_mem.emg_max_value[1] += filter_ch2(ADC_buf[4]);
1201   3          
1202   3                      if (interrupt_flag){
1203   4                          interrupt_flag = FALSE;
1204   4                          interrupt_manager();
1205   4                      }
1206   3                      
1207   3                      if (emg_counter_2 == SAMPLES_FOR_EMG_MEAN) {
1208   4                          g_mem.emg_max_value[1] = g_mem.emg_max_value[1] / SAMPLES_FOR_EMG_MEAN; // calc mean
1209   4                          LED_REG_Write(0x00);        // led OFF
1210   4                          emg_counter_2 = 0;          // reset counter
1211   4                      
1212   4                          if (interrupt_flag){
1213   5                              interrupt_flag = FALSE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 21  

1214   5                              interrupt_manager();
1215   5                          }
1216   4                          
1217   4                          // if EMG control mode active, activate motors accordingly with startup value
1218   4                          if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1219   4                              (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1220   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1221   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1222   5                              if (c_mem.control_mode == CONTROL_ANGLE) {
1223   6                                  g_ref.pos[0] = g_meas.pos[0];
1224   6                                  g_ref.pos[1] = g_meas.pos[1];
1225   6                              }
1226   5                              g_ref.onoff = c_mem.activ;
1227   5                              MOTOR_ON_OFF_Write(g_ref.onoff);
1228   5                          }
1229   4                          emg_2_status = NORMAL;           // goto normal execution
1230   4                      }
1231   3                      break;
1232   3      
1233   3                  case WAIT: // wait for EMG calibration to be done
1234   3                      if (emg_1_status == NORMAL)
1235   3                          emg_2_status = DISCARD;           // goto discard sample
1236   3                      break;
1237   3      
1238   3                  default:
1239   3                      break;
1240   3              }
1241   2                  
1242   2              if (interrupt_flag){
1243   3                  interrupt_flag = FALSE;
1244   3                  interrupt_manager();
1245   3              }
1246   2          
1247   2              switch (UD_status) {
1248   3                  case NORMAL:
1249   3                      i_aux = ADC_buf[5];
1250   3                      // Remap the analog reading from -1024 to 1024.  
1251   3                      i_aux = (int32) (((float) (i_aux - UD_mean_value) / UD_mean_value) * g_mem.joystick_gains[
             -1]); 
1252   3                      
1253   3                      if (interrupt_flag){
1254   4                          interrupt_flag = FALSE;
1255   4                          interrupt_manager();
1256   4                      }
1257   3      
1258   3                      //Saturation
1259   3                      if (i_aux < -1024) 
1260   3                          i_aux = -1024;
1261   3                      if (i_aux > 1024)
1262   3                          i_aux = 1024;
1263   3      
1264   3                      g_meas.joystick[1] = (int16) i_aux;
1265   3      
1266   3                      if (interrupt_flag){
1267   4                          interrupt_flag = FALSE;
1268   4                          interrupt_manager();
1269   4                      }
1270   3      
1271   3                  break;
1272   3      
1273   3                  case RESET: // reset variables
1274   3                      UD_counter = 0;
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 22  

1275   3                      UD_mean_value = 0;
1276   3                      UD_status = WAIT; // go to waiting status
1277   3      
1278   3                  break;
1279   3      
1280   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1281   3                      UD_counter++;
1282   3                      if (UD_counter == JOYSTICK_SAMPLE_TO_DISCARD) {
1283   4                          UD_counter = 0;                     // reset counter
1284   4      
1285   4                          if (interrupt_flag){
1286   5                              interrupt_flag = FALSE;
1287   5                              interrupt_manager();
1288   5                          }
1289   4      
1290   4                          UD_status = SUM_AND_MEAN;           // sum and mean status
1291   4                      }
1292   3      
1293   3                  break;
1294   3      
1295   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1296   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1297   3                      UD_counter++;
1298   3                      UD_mean_value += ADC_buf[5];
1299   3      
1300   3                      if (interrupt_flag){
1301   4                          interrupt_flag = FALSE;
1302   4                          interrupt_manager();
1303   4                      }
1304   3      
1305   3                      if (UD_counter == SAMPLES_FOR_JOYSTICK_MEAN) {
1306   4                          UD_mean_value = UD_mean_value / SAMPLES_FOR_JOYSTICK_MEAN; // calc mean
1307   4      
1308   4                          if (interrupt_flag){
1309   5                              interrupt_flag = FALSE;
1310   5                              interrupt_manager();
1311   5                          }
1312   4      
1313   4                          UD_counter = 0;          // reset counter
1314   4                          UD_status = NORMAL;           // goto normal execution
1315   4                      }
1316   3                  break;
1317   3      
1318   3                  case WAIT: // wait for both EMG calibrations to be done
1319   3                      if (emg_1_status == NORMAL && emg_2_status == NORMAL)
1320   3                          UD_status = DISCARD;           // goto discard sample
1321   3                  break;
1322   3              }
1323   2      
1324   2              switch (LR_status) {
1325   3                  case NORMAL:
1326   3                      i_aux = ADC_buf[6];
1327   3      
1328   3                      i_aux = (int32) (((float) (i_aux - LR_mean_value) / LR_mean_value) * g_mem.joystick_gains[
             -0]); 
1329   3                      
1330   3                      if (interrupt_flag){
1331   4                          interrupt_flag = FALSE;
1332   4                          interrupt_manager();
1333   4                      }
1334   3      
1335   3                      //Saturation
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 23  

1336   3                      if (i_aux < -1024)
1337   3                          i_aux = -1024;
1338   3                      if (i_aux > 1024)
1339   3                          i_aux = 1024;
1340   3      
1341   3                      if (interrupt_flag){
1342   4                          interrupt_flag = FALSE;
1343   4                          interrupt_manager();
1344   4                      }
1345   3      
1346   3                      g_meas.joystick[0] = (int16) i_aux;
1347   3      
1348   3                  break;
1349   3      
1350   3                  case RESET: // reset variables
1351   3                      LR_counter = 0;
1352   3                      LR_mean_value = 0;
1353   3                      LR_status = WAIT; // goes waiting for all conversions to be done
1354   3                  break;
1355   3      
1356   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples8
1357   3                      LR_counter++;
1358   3                      if (LR_counter == JOYSTICK_SAMPLE_TO_DISCARD) {
1359   4                          LR_counter = 0;                     // reset counter
1360   4      
1361   4                          if (interrupt_flag){
1362   5                              interrupt_flag = FALSE;
1363   5                              interrupt_manager();
1364   5                          }
1365   4      
1366   4                          LR_status = SUM_AND_MEAN;           // sum and mean status
1367   4                      }
1368   3                  break;
1369   3      
1370   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1371   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1372   3                      LR_counter++;
1373   3                      LR_mean_value += ADC_buf[6];
1374   3                      if (LR_counter == SAMPLES_FOR_JOYSTICK_MEAN) {
1375   4                          LR_mean_value = LR_mean_value / SAMPLES_FOR_JOYSTICK_MEAN; // calc mean
1376   4                          
1377   4                          if (interrupt_flag){
1378   5                              interrupt_flag = FALSE;
1379   5                              interrupt_manager();
1380   5                          }
1381   4      
1382   4                          LR_counter = 0;               // reset counter
1383   4                          LR_status = NORMAL;           // goto normal execution
1384   4                      }
1385   3                  break;
1386   3      
1387   3                  case WAIT:
1388   3                      if(emg_1_status == NORMAL && emg_2_status == NORMAL && UD_status == NORMAL)
1389   3                          LR_status = DISCARD;
1390   3                  break;
1391   3              }
1392   2      
1393   2              if (interrupt_flag){
1394   3                  interrupt_flag = FALSE;
1395   3                  interrupt_manager();
1396   3              }
1397   2          }
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 24  

1398   1      
1399   1          else {
1400   2              emg_1_status = RESET; 
1401   2              emg_2_status = RESET;
1402   2              UD_status = RESET;
1403   2              LR_status = RESET;
1404   2      
1405   2              tension_valid = FALSE;
1406   2                  
1407   2              if (interrupt_flag){
1408   3                  interrupt_flag = FALSE;
1409   3                  interrupt_manager();
1410   3              }
1411   2              
1412   2              if (c_mem.emg_calibration_flag) {
1413   3                  if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1414   3                      (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1415   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1416   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1417   4                      g_ref.onoff = 0x00;
1418   4                      MOTOR_ON_OFF_Write(g_ref.onoff);
1419   4                  }
1420   3              }
1421   2      
1422   2              // Reset current
1423   2              g_meas.curr[0] = 0;
1424   2              g_meas.curr[1] = 0;
1425   2      
1426   2              // Reset emg
1427   2              g_meas.emg[0] = 0;
1428   2              g_meas.emg[1] = 0;
1429   2      
1430   2              //Reset Joystick
1431   2              g_meas.joystick[0] = 0;
1432   2              g_meas.joystick[1] = 0;
1433   2          }
1434   1      
1435   1          if (interrupt_flag){
1436   2              interrupt_flag = FALSE;
1437   2              interrupt_manager();
1438   2          }
1439   1      }
1440          
1441          //==============================================================================
1442          //                                                               ENCODER READING
1443          //==============================================================================
1444          
1445          void encoder_reading(const uint8 idx)
1446          {
1447   1          uint8 CYDATA index = idx;
1448   1          
1449   1          uint8 CYDATA jj;
1450   1          
1451   1          uint32 data_encoder;
1452   1          int32 value_encoder;
1453   1          int32 aux;
1454   1          uint8 sensor_index;
1455   1          int8 rot[2] = {0,0};
1456   1      
1457   1          static int32 last_value_encoder[NUM_OF_SENSORS];
1458   1          static uint8 error[NUM_OF_SENSORS];
1459   1          static CYBIT only_first_time = TRUE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 25  

1460   1          static CYDATA uint8 one_time_execute = 0;
1461   1          static CYBIT pos_reconstruct = FALSE;
1462   1      
1463   1          // static int32 l_value[NUM_OF_SENSORS];   //last value for vel
1464   1          // static int32 ll_value[NUM_OF_SENSORS];  //last last value for vel
1465   1          // static int32 lll_value[NUM_OF_SENSORS];  //last last last value for vel
1466   1      
1467   1          if (index >= NUM_OF_SENSORS)
1468   1              return;
1469   1          
1470   1          if (reset_last_value_flag) {
1471   2              for (jj = NUM_OF_SENSORS; jj--;) {
1472   3                  last_value_encoder[jj] = 0;
1473   3              }
1474   2              reset_last_value_flag = 0;
1475   2          }
1476   1      
1477   1          //======================================================     reading sensors
1478   1          if (index == 0)
1479   1                  data_encoder = (SHIFTREG_ENC_1_ReadData() >> 1) & 0x3FFFF;
1480   1          else {
1481   2              if (index == 1)
1482   2                  data_encoder = (SHIFTREG_ENC_2_ReadData() >> 1) & 0x3FFFF;
1483   2              else {
1484   3                  if (index == 2)
1485   3                      data_encoder = (SHIFTREG_ENC_3_ReadData() >> 1) & 0x3FFFF;
1486   3                  else // index == 3
1487   3                      data_encoder = (SHIFTREG_ENC_4_ReadData() >> 1) & 0x3FFFF;
1488   3              }
1489   2          }    
1490   1      
1491   1          if (check_enc_data(&data_encoder)) {
1492   2      
1493   2              value_encoder = (int16) (-(32768 - (data_encoder & 0x3FFC0) >> 2) + g_mem.m_off[index]);  
1494   2      
1495   2              // Initialize last_value_encoder
1496   2              if (only_first_time) {
1497   3                  last_value_encoder[index] = value_encoder;
1498   3                  
1499   3                  if (index == 3)
1500   3                      only_first_time = 0;
1501   3              }
1502   2      
1503   2              // Take care of rotations
1504   2              aux = value_encoder - last_value_encoder[index];
1505   2      
1506   2              // ====================== 1 TURN ======================
1507   2              // -32768                    0                    32767 -32768                   0                
             -     32767
1508   2              // |-------------------------|-------------------------|-------------------------|----------------
             ----------|
1509   2              //              |                         |      |           |      |                         |
1510   2              //           -16384                     16383    |           |   -16384                     16383
1511   2              //                                               |           |
1512   2              //                                           24575           -24576
1513   2              //                                               |___________|
1514   2              //                                                   49152
1515   2      
1516   2              // if we are in the right interval, take care of rotation
1517   2              // and update the variable only if the difference between
1518   2              // one measure and another is less than 1/4 of turn
1519   2      
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 26  

1520   2              // Considering we are sampling at 1kHz, this means that our shaft needs
1521   2              // to go slower than 1/4 turn every ms -> 1 turn every 4ms
1522   2              // equal to 250 turn/s -> 15000 RPM
1523   2      
1524   2              if (aux > 49152)
1525   2                  g_meas.rot[index]--;
1526   2              else{ 
1527   3                  if (aux < -49152)
1528   3                      g_meas.rot[index]++;
1529   3                  else{
1530   4                      if (abs(aux) > 16384) { // if two measure are too far
1531   5                          error[index]++;
1532   5                          if (error[index] < 10)
1533   5                              // Discard
1534   5                              return;
1535   5                      }
1536   4                  }
1537   3              }
1538   2              
1539   2              error[index] = 0;
1540   2              
1541   2              last_value_encoder[index] = value_encoder;
1542   2      
1543   2              value_encoder += (int32)g_meas.rot[index] << 16;
1544   2      
1545   2              if (c_mem.m_mult[index] != 1.0)
1546   2                  value_encoder *= c_mem.m_mult[index];
1547   2            
1548   2              g_meas.pos[index] = value_encoder;
1549   2          }
1550   1          
1551   1          if (pos_reconstruct == FALSE) {
1552   2              if (one_time_execute < 34) {
1553   3                  one_time_execute++;
1554   3              } else {
1555   3                  // If necessary activate motors
1556   3                  g_ref.pos[0] = g_meas.pos[0];
1557   3                  g_ref.pos[1] = g_meas.pos[2];
1558   3                  MOTOR_ON_OFF_Write(g_ref.onoff);
1559   3      
1560   3                  // Double encoder translation
1561   3                  sensor_index = (index >> 1);           // [0-1]->0, [2-3]->1
1562   3                  if (c_mem.double_encoder_on_off) 
1563   3                      g_meas.rot[(sensor_index >> 1) << 1] = calc_turns_fcn(g_meas.pos[sensor_index << 1], g_mea
             -s.pos[(sensor_index << 1) + 1]);
1564   3      
1565   3                  g_meas.pos[(sensor_index >> 1) << 1] += (int32) g_meas.rot[(sensor_index >> 1) << 1] << 16;
1566   3                  
1567   3                  g_refNew.pos[(sensor_index >> 1) << 1] = g_meas.pos[(sensor_index >> 1) << 1];
1568   3      
1569   3                  pos_reconstruct = TRUE;
1570   3              }
1571   2          }
1572   1      
1573   1          // // velocity calculation
1574   1          // switch(i) {
1575   1          //     case 0: {
1576   1          //         g_meas.vel[i] = (int16)filter_vel_1((3*value_encoder + l_value[i] - ll_value[i] - 3*lll_val
             -ue[i]) / 10);
1577   1          //         break;
1578   1          //     }
1579   1          //     case 1: {
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 27  

1580   1          //         g_meas.vel[i] = (int16)filter_vel_2((3*value_encoder + l_value[i] - ll_value[i] - 3*lll_val
             -ue[i]) / 10);
1581   1          //         break;
1582   1          //     }
1583   1          //     case 2: {
1584   1          //         g_meas.vel[i] = (int16)filter_vel_3((3*value_encoder + l_value[i] - ll_value[i] - 3*lll_val
             -ue[i]) / 10);
1585   1          //         break;
1586   1          //     }
1587   1          // }
1588   1      
1589   1          // // update old values
1590   1          // lll_value[i] = ll_value[i];
1591   1          // ll_value[i] = l_value[i];
1592   1          // l_value[i] = value_encoder;
1593   1      }
1594          
1595          //==============================================================================
1596          //                                                              PWM_LIMIT_SEARCH
1597          //==============================================================================
1598          
1599          void pwm_limit_search() {
1600   1          
1601   1          dev_pwm_limit = 100;
1602   1          /*uint8 CYDATA index;
1603   1      
1604   1          if (dev_tension > 25500)    // Max value 
1605   1              dev_pwm_limit = 0;
1606   1          else{ 
1607   1              if (dev_tension < 11500) // Min value
1608   1                  dev_pwm_limit = 100;
1609   1              else {                  
1610   1                  index = (uint8)((dev_tension - 11500) >> 9);
1611   1                  dev_pwm_limit = pwm_preload_values[index];
1612   1              }
1613   1          }*/
1614   1      }
1615          
1616          
1617          /* [] END OF FILE */
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 28  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION ISR_WATCHDOG_Handler (BEGIN)
                                           ; SOURCE LINE # 63
                                           ; SOURCE LINE # 67
0000 D200        E     SETB    watchdog_flag
                                           ; SOURCE LINE # 69
0002 32                RETI    
             ; FUNCTION ISR_WATCHDOG_Handler (END)

             ; FUNCTION ISR_RS485_RX_ExInterrupt (BEGIN)
                                           ; SOURCE LINE # 75
                                           ; SOURCE LINE # 79
0000 D200        E     SETB    interrupt_flag
                                           ; SOURCE LINE # 81
0002 32                RETI    
             ; FUNCTION ISR_RS485_RX_ExInterrupt (END)

             ; FUNCTION interrupt_manager (BEGIN)
                                           ; SOURCE LINE # 98
                                           ; SOURCE LINE # 113
0000 E4                CLR     A
0001 F500        R     MOV     package_count,A
0003         ?C0003:
                                           ; SOURCE LINE # 119
0003 120000      E     LCALL   UART_RS485_GetRxBufferSize
0006 EF                MOV     A,R7
0007 7003              JNZ     $ + 5H
0009 020000      R     LJMP    ?C0026
000C E500        R     MOV     A,package_count
000E C3                CLR     C
000F 9406              SUBB    A,#06H
0011 4003              JC      $ + 5H
0013 020000      R     LJMP    ?C0026
                                           ; SOURCE LINE # 123
0016 120000      E     LCALL   UART_RS485_GetChar
0019 8F00        R     MOV     rx_data,R7
                                           ; SOURCE LINE # 125
001B E500        R     MOV     A,state
001D 14                DEC     A
001E 6049              JZ      ?C0010
0020 14                DEC     A
0021 6060              JZ      ?C0014
0023 14                DEC     A
0024 7003              JNZ     $ + 5H
0026 020000      R     LJMP    ?C0021
0029 14                DEC     A
002A 7003              JNZ     $ + 5H
002C 020000      R     LJMP    ?C0024
002F 2404              ADD     A,#04H
0031 70D0              JNZ     ?C0003
                                           ; SOURCE LINE # 127
0033         ?C0006:
                                           ; SOURCE LINE # 129
0033 850000      R     MOV     rx_queue,rx_queue+01H
                                           ; SOURCE LINE # 130
0036 850000      R     MOV     rx_queue+01H,rx_queue+02H
                                           ; SOURCE LINE # 131
0039 850000      R     MOV     rx_queue+02H,rx_data
                                           ; SOURCE LINE # 134
003C E500        R     MOV     A,rx_queue+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 29  

003E B43A11            CJNE    A,#03AH,?C0007
0041 E500        R     MOV     A,rx_queue+02H
0043 B43A0C            CJNE    A,#03AH,?C0007
                                           ; SOURCE LINE # 135
0046 E4                CLR     A
0047 F500        R     MOV     rx_queue,A
                                           ; SOURCE LINE # 136
0049 F500        R     MOV     rx_queue+01H,A
                                           ; SOURCE LINE # 137
004B F500        R     MOV     rx_queue+02H,A
                                           ; SOURCE LINE # 138
004D 750001      R     MOV     state,#01H
                                           ; SOURCE LINE # 139
0050 80B1              SJMP    ?C0003
0052         ?C0007:
                                           ; SOURCE LINE # 140
0052 E500        R     MOV     A,rx_queue
0054 B43FAC            CJNE    A,#03FH,?C0003
0057 E500        R     MOV     A,rx_queue+01H
0059 B40DA7            CJNE    A,#0DH,?C0003
005C E500        R     MOV     A,rx_queue+02H
005E 640A              XRL     A,#0AH
0060 70A1              JNZ     ?C0003
                                           ; SOURCE LINE # 143
0062 FF                MOV     R7,A
0063 FE                MOV     R6,A
0064 120000      E     LCALL   _infoGet
                                           ; SOURCE LINE # 144
0067 809A              SJMP    ?C0003
                                           ; SOURCE LINE # 147
0069         ?C0010:
                                           ; SOURCE LINE # 150
0069 900000      E     MOV     DPTR,#c_mem+01H
006C E0                MOVX    A,@DPTR
006D 6500        R     XRL     A,rx_data
006F 6004              JZ      ?C0012
0071 E500        R     MOV     A,rx_data
0073 7004              JNZ     ?C0011
0075         ?C0012:
                                           ; SOURCE LINE # 151
0075 C200        R     CLR     rx_data_type
0077 8002              SJMP    ?C0013
0079         ?C0011:
                                           ; SOURCE LINE # 153
0079 D200        R     SETB    rx_data_type
007B         ?C0013:
                                           ; SOURCE LINE # 155
007B E4                CLR     A
007C F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 156
007E 750002      R     MOV     state,#02H
                                           ; SOURCE LINE # 157
0081 8080              SJMP    ?C0003
                                           ; SOURCE LINE # 160
0083         ?C0014:
                                           ; SOURCE LINE # 163
0083 850000      R     MOV     data_packet_length,rx_data
                                           ; SOURCE LINE # 165
0086 E500        R     MOV     A,data_packet_length
0088 D3                SETB    C
0089 9401              SUBB    A,#01H
008B 5008              JNC     ?C0015
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 30  

                                           ; SOURCE LINE # 166
008D E4                CLR     A
008E F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 167
0090 F500        R     MOV     state,A
                                           ; SOURCE LINE # 168
0092 020000      R     LJMP    ?C0003
0095         ?C0015:
0095 E500        R     MOV     A,data_packet_length
0097 D3                SETB    C
0098 9480              SUBB    A,#080H
009A 4008              JC      ?C0017
                                           ; SOURCE LINE # 169
009C E4                CLR     A
009D F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 170
009F F500        R     MOV     state,A
                                           ; SOURCE LINE # 171
00A1 020000      R     LJMP    ?C0003
00A4         ?C0017:
                                           ; SOURCE LINE # 172
00A4 E4                CLR     A
00A5 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 174
00A7 200006            JB      rx_data_type,?C0019
                                           ; SOURCE LINE # 175
00AA 750003      R     MOV     state,#03H
00AD 020000      R     LJMP    ?C0003
00B0         ?C0019:
                                           ; SOURCE LINE # 177
00B0 750004      R     MOV     state,#04H
                                           ; SOURCE LINE # 178
                                           ; SOURCE LINE # 179
00B3 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 182
00B6         ?C0021:
                                           ; SOURCE LINE # 184
00B6 7400        R     MOV     A,#LOW data_packet_buffer
00B8 2500        R     ADD     A,data_packet_index
00BA F582              MOV     DPL,A
00BC E4                CLR     A
00BD 3400        R     ADDC    A,#HIGH data_packet_buffer
00BF F583              MOV     DPH,A
00C1 E500        R     MOV     A,rx_data
00C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 185
00C4 0500        R     INC     data_packet_index
                                           ; SOURCE LINE # 188
00C6 E500        R     MOV     A,data_packet_index
00C8 C3                CLR     C
00C9 9500        R     SUBB    A,data_packet_length
00CB 5003              JNC     $ + 5H
00CD 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 190
00D0 200025            JB      rx_data_type,?C0023
                                           ; SOURCE LINE # 192
00D3 AF00        R     MOV     R7,data_packet_length
00D5 7E00              MOV     R6,#00H
00D7 7800        E     MOV     R0,#LOW g_rx
00D9 7C00        E     MOV     R4,#HIGH g_rx
00DB 7D01              MOV     R5,#01H
00DD 7B01              MOV     R3,#01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 31  

00DF 7A00        R     MOV     R2,#HIGH data_packet_buffer
00E1 7900        R     MOV     R1,#LOW data_packet_buffer
00E3 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 193
00E6 900000      E     MOV     DPTR,#g_rx+080H
00E9 E4                CLR     A
00EA F0                MOVX    @DPTR,A
00EB A3                INC     DPTR
00EC E500        R     MOV     A,data_packet_length
00EE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 194
00EF 900000      E     MOV     DPTR,#g_rx+084H
00F2 7401              MOV     A,#01H
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 195
00F5 120000      E     LCALL   commProcess
                                           ; SOURCE LINE # 196
00F8         ?C0023:
                                           ; SOURCE LINE # 198
00F8 E4                CLR     A
00F9 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 199
00FB F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 200
00FD F500        R     MOV     state,A
                                           ; SOURCE LINE # 201
00FF 0500        R     INC     package_count
                                           ; SOURCE LINE # 203
                                           ; SOURCE LINE # 204
0101 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 207
0104         ?C0024:
                                           ; SOURCE LINE # 208
0104 1500        R     DEC     data_packet_length
0106 E500        R     MOV     A,data_packet_length
0108 6003              JZ      $ + 5H
010A 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 209
010D F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 210
010F F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 211
0111 7F01              MOV     R7,#01H
0113 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 212
0116 E4                CLR     A
0117 FF                MOV     R7,A
0118 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 213
011B E4                CLR     A
011C F500        R     MOV     state,A
                                           ; SOURCE LINE # 214
011E 0500        R     INC     package_count
                                           ; SOURCE LINE # 215
                                           ; SOURCE LINE # 216
0120 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 217
                                           ; SOURCE LINE # 218
0123 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 219
0126         ?C0026:
0126 22                RET     
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 32  

             ; FUNCTION interrupt_manager (END)

             ; FUNCTION function_scheduler (BEGIN)
                                           ; SOURCE LINE # 229
                                           ; SOURCE LINE # 235
0000 120000      E     LCALL   MY_TIMER_ReadCounter
0003 900000      E     MOV     DPTR,#timer_value0
0006 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 237
0009 7F01              MOV     R7,#01H
000B 120000      E     LCALL   _ADC_SOC_Write
                                           ; SOURCE LINE # 241
000E 300005            JNB     interrupt_flag,?C0027
                                           ; SOURCE LINE # 242
0011 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 243
0013 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 244
0016         ?C0027:
                                           ; SOURCE LINE # 248
0016 E4                CLR     A
0017 FF                MOV     R7,A
0018 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 252
001B 300005            JNB     interrupt_flag,?C0028
                                           ; SOURCE LINE # 253
001E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 254
0020 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 255
0023         ?C0028:
                                           ; SOURCE LINE # 257
0023 7F01              MOV     R7,#01H
0025 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 261
0028 300005            JNB     interrupt_flag,?C0029
                                           ; SOURCE LINE # 262
002B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 263
002D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 264
0030         ?C0029:
                                           ; SOURCE LINE # 266
0030 7F02              MOV     R7,#02H
0032 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 270
0035 300005            JNB     interrupt_flag,?C0030
                                           ; SOURCE LINE # 271
0038 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 272
003A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 273
003D         ?C0030:
                                           ; SOURCE LINE # 275
003D 7F03              MOV     R7,#03H
003F 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 279
0042 300005            JNB     interrupt_flag,?C0031
                                           ; SOURCE LINE # 280
0045 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 281
0047 120000      R     LCALL   interrupt_manager
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 33  

                                           ; SOURCE LINE # 282
004A         ?C0031:
                                           ; SOURCE LINE # 286
004A E4                CLR     A
004B FF                MOV     R7,A
004C 120000      R     LCALL   _motor_control
                                           ; SOURCE LINE # 290
004F 300005            JNB     interrupt_flag,?C0032
                                           ; SOURCE LINE # 291
0052 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 292
0054 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 293
0057         ?C0032:
                                           ; SOURCE LINE # 295
0057 7F01              MOV     R7,#01H
0059 120000      R     LCALL   _motor_control
                                           ; SOURCE LINE # 299
005C 300005            JNB     interrupt_flag,?C0033
                                           ; SOURCE LINE # 300
005F C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 301
0061 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 302
0064         ?C0033:
                                           ; SOURCE LINE # 306
0064 120000      R     LCALL   analog_read_end
                                           ; SOURCE LINE # 311
0067 900000      E     MOV     DPTR,#calibration_flag
006A E0                MOVX    A,@DPTR
006B 7003              JNZ     ?C0035
006D D3                SETB    C
006E 8001              SJMP    ?C0036
0070         ?C0035:
0070 C3                CLR     C
0071         ?C0036:
0071 4024              JC      ?C0034
                                           ; SOURCE LINE # 312
0073 900000      R     MOV     DPTR,#counter_calibration
0076 E0                MOVX    A,@DPTR
0077 7004              JNZ     ?C0275
0079 A3                INC     DPTR
007A E0                MOVX    A,@DPTR
007B 6464              XRL     A,#064H
007D         ?C0275:
007D 700A              JNZ     ?C0037
                                           ; SOURCE LINE # 313
007F 120000      E     LCALL   calibration
                                           ; SOURCE LINE # 314
0082 E4                CLR     A
0083 900000      R     MOV     DPTR,#counter_calibration
0086 F0                MOVX    @DPTR,A
0087 A3                INC     DPTR
0088 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 315
0089         ?C0037:
                                           ; SOURCE LINE # 316
0089 900000      R     MOV     DPTR,#counter_calibration+01H
008C E0                MOVX    A,@DPTR
008D 04                INC     A
008E F0                MOVX    @DPTR,A
008F 7006              JNZ     ?C0276
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 34  

0091 900000      R     MOV     DPTR,#counter_calibration
0094 E0                MOVX    A,@DPTR
0095 04                INC     A
0096 F0                MOVX    @DPTR,A
0097         ?C0276:
                                           ; SOURCE LINE # 317
0097         ?C0034:
                                           ; SOURCE LINE # 320
0097 300005            JNB     interrupt_flag,?C0038
                                           ; SOURCE LINE # 321
009A C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 322
009C 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 323
009F         ?C0038:
                                           ; SOURCE LINE # 328
009F 7800        E     MOV     R0,#LOW g_measOld
00A1 7C00        E     MOV     R4,#HIGH g_measOld
00A3 7D01              MOV     R5,#01H
00A5 7B01              MOV     R3,#01H
00A7 7A00        E     MOV     R2,#HIGH g_meas
00A9 7900        E     MOV     R1,#LOW g_meas
00AB 7E00              MOV     R6,#00H
00AD 7F34              MOV     R7,#034H
00AF 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 329
00B2 7800        E     MOV     R0,#LOW g_refOld
00B4 7C00        E     MOV     R4,#HIGH g_refOld
00B6 7D01              MOV     R5,#01H
00B8 7B01              MOV     R3,#01H
00BA 7A00        E     MOV     R2,#HIGH g_ref
00BC 7900        E     MOV     R1,#LOW g_ref
00BE 7E00              MOV     R6,#00H
00C0 7F09              MOV     R7,#09H
00C2 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 332
00C5 7800        E     MOV     R0,#LOW g_ref
00C7 7C00        E     MOV     R4,#HIGH g_ref
00C9 7D01              MOV     R5,#01H
00CB 7B01              MOV     R3,#01H
00CD 7A00        E     MOV     R2,#HIGH g_refNew
00CF 7900        E     MOV     R1,#LOW g_refNew
00D1 7E00              MOV     R6,#00H
00D3 7F09              MOV     R7,#09H
00D5 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 334
00D8 300005            JNB     interrupt_flag,?C0039
                                           ; SOURCE LINE # 335
00DB C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 336
00DD 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 337
00E0         ?C0039:
                                           ; SOURCE LINE # 341
00E0 120000      E     LCALL   MY_TIMER_ReadCounter
00E3 900000      E     MOV     DPTR,#timer_value
00E6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 342
00E9 7F40              MOV     R7,#040H
00EB 7E4B              MOV     R6,#04BH
00ED 7D4C              MOV     R5,#04CH
00EF 7C00              MOV     R4,#00H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 35  

00F1 120000      E     LCALL   _MY_TIMER_WriteCounter
                                           ; SOURCE LINE # 344
00F4 22                RET     
             ; FUNCTION function_scheduler (END)

             ; FUNCTION _motor_control (BEGIN)
                                           ; SOURCE LINE # 351
;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 353
0000 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 357
0002 E4                CLR     A
0003 F500        R     MOV     pwm_input+03H,A
0005 F500        R     MOV     pwm_input+02H,A
0007 F500        R     MOV     pwm_input+01H,A
0009 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 367
000B 900000      E     MOV     DPTR,#c_mem+02H
000E E0                MOVX    A,@DPTR
000F FC                MOV     R4,A
0010 A3                INC     DPTR
0011 E0                MOVX    A,@DPTR
0012 FD                MOV     R5,A
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015 FE                MOV     R6,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 F500        R     MOV     k_p+03H,A
001A 8E00        R     MOV     k_p+02H,R6
001C 8D00        R     MOV     k_p+01H,R5
001E 8C00        R     MOV     k_p,R4
                                           ; SOURCE LINE # 368
0020 A3                INC     DPTR
0021 E0                MOVX    A,@DPTR
0022 FC                MOV     R4,A
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
0025 FD                MOV     R5,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FE                MOV     R6,A
0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B F500        R     MOV     k_i+03H,A
002D 8E00        R     MOV     k_i+02H,R6
002F 8D00        R     MOV     k_i+01H,R5
0031 8C00        R     MOV     k_i,R4
                                           ; SOURCE LINE # 369
0033 A3                INC     DPTR
0034 E0                MOVX    A,@DPTR
0035 FC                MOV     R4,A
0036 A3                INC     DPTR
0037 E0                MOVX    A,@DPTR
0038 FD                MOV     R5,A
0039 A3                INC     DPTR
003A E0                MOVX    A,@DPTR
003B FE                MOV     R6,A
003C A3                INC     DPTR
003D E0                MOVX    A,@DPTR
003E F500        R     MOV     k_d+03H,A
0040 8E00        R     MOV     k_d+02H,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 36  

0042 8D00        R     MOV     k_d+01H,R5
0044 8C00        R     MOV     k_d,R4
                                           ; SOURCE LINE # 371
0046 A3                INC     DPTR
0047 E0                MOVX    A,@DPTR
0048 FC                MOV     R4,A
0049 A3                INC     DPTR
004A E0                MOVX    A,@DPTR
004B FD                MOV     R5,A
004C A3                INC     DPTR
004D E0                MOVX    A,@DPTR
004E FE                MOV     R6,A
004F A3                INC     DPTR
0050 E0                MOVX    A,@DPTR
0051 FF                MOV     R7,A
0052 900000      R     MOV     DPTR,#k_p_c
0055 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 372
0058 900000      E     MOV     DPTR,#c_mem+012H
005B E0                MOVX    A,@DPTR
005C FC                MOV     R4,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FD                MOV     R5,A
0060 A3                INC     DPTR
0061 E0                MOVX    A,@DPTR
0062 FE                MOV     R6,A
0063 A3                INC     DPTR
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 900000      R     MOV     DPTR,#k_i_c
0069 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 373
006C 900000      E     MOV     DPTR,#c_mem+016H
006F E0                MOVX    A,@DPTR
0070 FC                MOV     R4,A
0071 A3                INC     DPTR
0072 E0                MOVX    A,@DPTR
0073 FD                MOV     R5,A
0074 A3                INC     DPTR
0075 E0                MOVX    A,@DPTR
0076 FE                MOV     R6,A
0077 A3                INC     DPTR
0078 E0                MOVX    A,@DPTR
0079 FF                MOV     R7,A
007A 900000      R     MOV     DPTR,#k_d_c
007D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 375
0080 900000      E     MOV     DPTR,#c_mem+01AH
0083 E0                MOVX    A,@DPTR
0084 FC                MOV     R4,A
0085 A3                INC     DPTR
0086 E0                MOVX    A,@DPTR
0087 FD                MOV     R5,A
0088 A3                INC     DPTR
0089 E0                MOVX    A,@DPTR
008A FE                MOV     R6,A
008B A3                INC     DPTR
008C E0                MOVX    A,@DPTR
008D FF                MOV     R7,A
008E 900000      R     MOV     DPTR,#k_p_dl
0091 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 37  

                                           ; SOURCE LINE # 376
0094 900000      E     MOV     DPTR,#c_mem+01EH
0097 E0                MOVX    A,@DPTR
0098 FC                MOV     R4,A
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B FD                MOV     R5,A
009C A3                INC     DPTR
009D E0                MOVX    A,@DPTR
009E FE                MOV     R6,A
009F A3                INC     DPTR
00A0 E0                MOVX    A,@DPTR
00A1 FF                MOV     R7,A
00A2 900000      R     MOV     DPTR,#k_i_dl
00A5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 377
00A8 900000      E     MOV     DPTR,#c_mem+022H
00AB E0                MOVX    A,@DPTR
00AC FC                MOV     R4,A
00AD A3                INC     DPTR
00AE E0                MOVX    A,@DPTR
00AF FD                MOV     R5,A
00B0 A3                INC     DPTR
00B1 E0                MOVX    A,@DPTR
00B2 FE                MOV     R6,A
00B3 A3                INC     DPTR
00B4 E0                MOVX    A,@DPTR
00B5 FF                MOV     R7,A
00B6 900000      R     MOV     DPTR,#k_d_dl
00B9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 379
00BC 900000      E     MOV     DPTR,#c_mem+026H
00BF E0                MOVX    A,@DPTR
00C0 FC                MOV     R4,A
00C1 A3                INC     DPTR
00C2 E0                MOVX    A,@DPTR
00C3 FD                MOV     R5,A
00C4 A3                INC     DPTR
00C5 E0                MOVX    A,@DPTR
00C6 FE                MOV     R6,A
00C7 A3                INC     DPTR
00C8 E0                MOVX    A,@DPTR
00C9 FF                MOV     R7,A
00CA 900000      R     MOV     DPTR,#k_p_c_dl
00CD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 380
00D0 900000      E     MOV     DPTR,#c_mem+02AH
00D3 E0                MOVX    A,@DPTR
00D4 FC                MOV     R4,A
00D5 A3                INC     DPTR
00D6 E0                MOVX    A,@DPTR
00D7 FD                MOV     R5,A
00D8 A3                INC     DPTR
00D9 E0                MOVX    A,@DPTR
00DA FE                MOV     R6,A
00DB A3                INC     DPTR
00DC E0                MOVX    A,@DPTR
00DD FF                MOV     R7,A
00DE 900000      R     MOV     DPTR,#k_i_c_dl
00E1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 381
00E4 900000      E     MOV     DPTR,#c_mem+02EH
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 38  

00E7 E0                MOVX    A,@DPTR
00E8 FC                MOV     R4,A
00E9 A3                INC     DPTR
00EA E0                MOVX    A,@DPTR
00EB FD                MOV     R5,A
00EC A3                INC     DPTR
00ED E0                MOVX    A,@DPTR
00EE FE                MOV     R6,A
00EF A3                INC     DPTR
00F0 E0                MOVX    A,@DPTR
00F1 FF                MOV     R7,A
00F2 900000      R     MOV     DPTR,#k_d_c_dl
00F5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 397
00F8 900000      E     MOV     DPTR,#c_mem+076H
00FB E0                MOVX    A,@DPTR
00FC FE                MOV     R6,A
00FD A3                INC     DPTR
00FE E0                MOVX    A,@DPTR
00FF FF                MOV     R7,A
0100 FB                MOV     R3,A
0101 AA06              MOV     R2,AR6
0103 E4                CLR     A
0104 900000      E     MOV     DPTR,#g_meas+028H
0107 E0                MOVX    A,@DPTR
0108 FC                MOV     R4,A
0109 A3                INC     DPTR
010A E0                MOVX    A,@DPTR
010B FD                MOV     R5,A
010C A3                INC     DPTR
010D E0                MOVX    A,@DPTR
010E FE                MOV     R6,A
010F A3                INC     DPTR
0110 E0                MOVX    A,@DPTR
0111 C3                CLR     C
0112 9B                SUBB    A,R3
0113 F500        R     MOV     err_emg_1+03H,A
0115 EE                MOV     A,R6
0116 9A                SUBB    A,R2
0117 F500        R     MOV     err_emg_1+02H,A
0119 ED                MOV     A,R5
011A 9400              SUBB    A,#00H
011C F500        R     MOV     err_emg_1+01H,A
011E EC                MOV     A,R4
011F 9400              SUBB    A,#00H
0121 F500        R     MOV     err_emg_1,A
                                           ; SOURCE LINE # 398
0123 900000      E     MOV     DPTR,#c_mem+078H
0126 E0                MOVX    A,@DPTR
0127 FE                MOV     R6,A
0128 A3                INC     DPTR
0129 E0                MOVX    A,@DPTR
012A FF                MOV     R7,A
012B FB                MOV     R3,A
012C AA06              MOV     R2,AR6
012E E4                CLR     A
012F 900000      E     MOV     DPTR,#g_meas+02CH
0132 E0                MOVX    A,@DPTR
0133 FC                MOV     R4,A
0134 A3                INC     DPTR
0135 E0                MOVX    A,@DPTR
0136 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 39  

0137 A3                INC     DPTR
0138 E0                MOVX    A,@DPTR
0139 FE                MOV     R6,A
013A A3                INC     DPTR
013B E0                MOVX    A,@DPTR
013C C3                CLR     C
013D 9B                SUBB    A,R3
013E F500        R     MOV     err_emg_2+03H,A
0140 EE                MOV     A,R6
0141 9A                SUBB    A,R2
0142 F500        R     MOV     err_emg_2+02H,A
0144 ED                MOV     A,R5
0145 9400              SUBB    A,#00H
0147 F500        R     MOV     err_emg_2+01H,A
0149 EC                MOV     A,R4
014A 9400              SUBB    A,#00H
014C F500        R     MOV     err_emg_2,A
                                           ; SOURCE LINE # 401
014E E500        R     MOV     A,index
0150 C3                CLR     C
0151 9402              SUBB    A,#02H
0153 4003              JC      $ + 5H
0155 020000      R     LJMP    ?C0042
0158         ?C0041:
                                           ; SOURCE LINE # 404
0158 900000      E     MOV     DPTR,#c_mem+035H
015B E0                MOVX    A,@DPTR
015C 24FA              ADD     A,#0FAH
015E 6009              JZ      ?C0049
0160 020000      R     LJMP    ?C0043
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 426
                                           ; SOURCE LINE # 428
                                           ; SOURCE LINE # 434
0163 020000      R     LJMP    ?C0043
                                           ; SOURCE LINE # 436
                                           ; SOURCE LINE # 443
                                           ; SOURCE LINE # 445
                                           ; SOURCE LINE # 481
0166 020000      R     LJMP    ?C0043
                                           ; SOURCE LINE # 483
                                           ; SOURCE LINE # 527
                                           ; SOURCE LINE # 529
0169         ?C0049:
                                           ; SOURCE LINE # 531
0169 E4                CLR     A
016A F500        R     MOV     err_joy_1+03H,A
016C F500        R     MOV     err_joy_1+02H,A
016E F500        R     MOV     err_joy_1+01H,A
0170 F500        R     MOV     err_joy_1,A
                                           ; SOURCE LINE # 532
0172 F500        R     MOV     err_joy_2+03H,A
0174 F500        R     MOV     err_joy_2+02H,A
0176 F500        R     MOV     err_joy_2+01H,A
0178 F500        R     MOV     err_joy_2,A
                                           ; SOURCE LINE # 533
017A D3                SETB    C
017B 900000      E     MOV     DPTR,#g_meas+031H
017E E0                MOVX    A,@DPTR
017F 9484              SUBB    A,#084H
0181 900000      E     MOV     DPTR,#g_meas+030H
0184 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 40  

0185 6480              XRL     A,#080H
0187 9483              SUBB    A,#083H
0189 4003              JC      ?C0051
018B D3                SETB    C
018C 8001              SJMP    ?C0052
018E         ?C0051:
018E C3                CLR     C
018F         ?C0052:
018F 5003              JNC     $ + 5H
0191 020000      R     LJMP    ?C0050
                                           ; SOURCE LINE # 534
0194 900000      E     MOV     DPTR,#g_mem+0A1H
0197 E0                MOVX    A,@DPTR
0198 FA                MOV     R2,A
0199 A3                INC     DPTR
019A E0                MOVX    A,@DPTR
019B FB                MOV     R3,A
019C 900000      E     MOV     DPTR,#g_meas+031H
019F E0                MOVX    A,@DPTR
01A0 9B                SUBB    A,R3
01A1 FF                MOV     R7,A
01A2 900000      E     MOV     DPTR,#g_meas+030H
01A5 E0                MOVX    A,@DPTR
01A6 9A                SUBB    A,R2
01A7 FE                MOV     R6,A
01A8 33                RLC     A
01A9 95E0              SUBB    A,ACC
01AB 8F00        R     MOV     err_joy_1+03H,R7
01AD 8E00        R     MOV     err_joy_1+02H,R6
01AF F500        R     MOV     err_joy_1+01H,A
01B1 F500        R     MOV     err_joy_1,A
                                           ; SOURCE LINE # 537
01B3 D3                SETB    C
01B4 A3                INC     DPTR
01B5 E0                MOVX    A,@DPTR
01B6 9B                SUBB    A,R3
01B7 EA                MOV     A,R2
01B8 6480              XRL     A,#080H
01BA F8                MOV     R0,A
01BB 900000      E     MOV     DPTR,#g_meas+030H
01BE E0                MOVX    A,@DPTR
01BF 6480              XRL     A,#080H
01C1 98                SUBB    A,R0
01C2 5003              JNC     $ + 5H
01C4 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 538
01C7 900000      E     MOV     DPTR,#g_refNew
01CA E0                MOVX    A,@DPTR
01CB F8                MOV     R0,A
01CC A3                INC     DPTR
01CD E0                MOVX    A,@DPTR
01CE F9                MOV     R1,A
01CF A3                INC     DPTR
01D0 E0                MOVX    A,@DPTR
01D1 FA                MOV     R2,A
01D2 A3                INC     DPTR
01D3 E0                MOVX    A,@DPTR
01D4 FB                MOV     R3,A
01D5 C000              PUSH    AR0
01D7 C001              PUSH    AR1
01D9 C002              PUSH    AR2
01DB C003              PUSH    AR3
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 41  

01DD 900000      E     MOV     DPTR,#g_mem+09FH
01E0 E0                MOVX    A,@DPTR
01E1 FE                MOV     R6,A
01E2 A3                INC     DPTR
01E3 E0                MOVX    A,@DPTR
01E4 FF                MOV     R7,A
01E5 E4                CLR     A
01E6 FC                MOV     R4,A
01E7 FD                MOV     R5,A
01E8 AB00        R     MOV     R3,err_joy_1+03H
01EA AA00        R     MOV     R2,err_joy_1+02H
01EC A900        R     MOV     R1,err_joy_1+01H
01EE A800        R     MOV     R0,err_joy_1
01F0 120000      E     LCALL   ?C?LMUL
01F3 C006              PUSH    AR6
01F5 C007              PUSH    AR7
01F7 900000      E     MOV     DPTR,#g_mem+0A1H
01FA E0                MOVX    A,@DPTR
01FB FE                MOV     R6,A
01FC A3                INC     DPTR
01FD E0                MOVX    A,@DPTR
01FE FF                MOV     R7,A
01FF C3                CLR     C
0200 E4                CLR     A
0201 9F                SUBB    A,R7
0202 FF                MOV     R7,A
0203 7404              MOV     A,#04H
0205 9E                SUBB    A,R6
0206 FE                MOV     R6,A
0207 AB07              MOV     R3,AR7
0209 FA                MOV     R2,A
020A 33                RLC     A
020B 95E0              SUBB    A,ACC
020D F9                MOV     R1,A
020E F8                MOV     R0,A
020F D007              POP     AR7
0211 D006              POP     AR6
0213 120000      E     LCALL   ?C?SLDIV
0216 D003              POP     AR3
0218 D002              POP     AR2
021A D001              POP     AR1
021C D000              POP     AR0
021E EB                MOV     A,R3
021F 2F                ADD     A,R7
0220 FF                MOV     R7,A
0221 EA                MOV     A,R2
0222 3E                ADDC    A,R6
0223 FE                MOV     R6,A
0224 E9                MOV     A,R1
0225 3D                ADDC    A,R5
0226 FD                MOV     R5,A
0227 E8                MOV     A,R0
0228 3C                ADDC    A,R4
0229 FC                MOV     R4,A
022A 900000      E     MOV     DPTR,#g_refNew
022D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 539
0230 900000      E     MOV     DPTR,#g_refNew+04H
0233 E0                MOVX    A,@DPTR
0234 F8                MOV     R0,A
0235 A3                INC     DPTR
0236 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 42  

0237 F9                MOV     R1,A
0238 A3                INC     DPTR
0239 E0                MOVX    A,@DPTR
023A FA                MOV     R2,A
023B A3                INC     DPTR
023C E0                MOVX    A,@DPTR
023D FB                MOV     R3,A
023E C000              PUSH    AR0
0240 C001              PUSH    AR1
0242 C002              PUSH    AR2
0244 C003              PUSH    AR3
0246 900000      E     MOV     DPTR,#g_mem+09FH
0249 E0                MOVX    A,@DPTR
024A FE                MOV     R6,A
024B A3                INC     DPTR
024C E0                MOVX    A,@DPTR
024D FF                MOV     R7,A
024E E4                CLR     A
024F FC                MOV     R4,A
0250 FD                MOV     R5,A
0251 AB00        R     MOV     R3,err_joy_1+03H
0253 AA00        R     MOV     R2,err_joy_1+02H
0255 A900        R     MOV     R1,err_joy_1+01H
0257 A800        R     MOV     R0,err_joy_1
0259 120000      E     LCALL   ?C?LMUL
025C C006              PUSH    AR6
025E C007              PUSH    AR7
0260 900000      E     MOV     DPTR,#g_mem+0A1H
0263 E0                MOVX    A,@DPTR
0264 FE                MOV     R6,A
0265 A3                INC     DPTR
0266 E0                MOVX    A,@DPTR
0267 FF                MOV     R7,A
0268 C3                CLR     C
0269 E4                CLR     A
026A 9F                SUBB    A,R7
026B FF                MOV     R7,A
026C 7404              MOV     A,#04H
026E 9E                SUBB    A,R6
026F FE                MOV     R6,A
0270 AB07              MOV     R3,AR7
0272 FA                MOV     R2,A
0273 33                RLC     A
0274 95E0              SUBB    A,ACC
0276 F9                MOV     R1,A
0277 F8                MOV     R0,A
0278 D007              POP     AR7
027A D006              POP     AR6
027C 120000      E     LCALL   ?C?SLDIV
027F D003              POP     AR3
0281 D002              POP     AR2
0283 D001              POP     AR1
0285 D000              POP     AR0
0287 EB                MOV     A,R3
0288 2F                ADD     A,R7
0289 FF                MOV     R7,A
028A EA                MOV     A,R2
028B 3E                ADDC    A,R6
028C FE                MOV     R6,A
028D E9                MOV     A,R1
028E 3D                ADDC    A,R5
028F FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 43  

0290 E8                MOV     A,R0
0291 3C                ADDC    A,R4
0292 FC                MOV     R4,A
0293 900000      E     MOV     DPTR,#g_refNew+04H
0296 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 546
0299 020000      R     LJMP    ?C0054
029C         ?C0053:
                                           ; SOURCE LINE # 547
                                           ; SOURCE LINE # 548
029C 900000      E     MOV     DPTR,#g_mem+0A1H
029F E0                MOVX    A,@DPTR
02A0 FA                MOV     R2,A
02A1 A3                INC     DPTR
02A2 E0                MOVX    A,@DPTR
02A3 FB                MOV     R3,A
02A4 900000      E     MOV     DPTR,#g_meas+031H
02A7 E0                MOVX    A,@DPTR
02A8 2B                ADD     A,R3
02A9 FF                MOV     R7,A
02AA 900000      E     MOV     DPTR,#g_meas+030H
02AD E0                MOVX    A,@DPTR
02AE 3A                ADDC    A,R2
02AF FE                MOV     R6,A
02B0 33                RLC     A
02B1 95E0              SUBB    A,ACC
02B3 8F00        R     MOV     err_joy_1+03H,R7
02B5 8E00        R     MOV     err_joy_1+02H,R6
02B7 F500        R     MOV     err_joy_1+01H,A
02B9 F500        R     MOV     err_joy_1,A
                                           ; SOURCE LINE # 550
02BB C3                CLR     C
02BC E4                CLR     A
02BD 9B                SUBB    A,R3
02BE FF                MOV     R7,A
02BF E4                CLR     A
02C0 9A                SUBB    A,R2
02C1 FE                MOV     R6,A
02C2 C3                CLR     C
02C3 A3                INC     DPTR
02C4 E0                MOVX    A,@DPTR
02C5 9F                SUBB    A,R7
02C6 EE                MOV     A,R6
02C7 6480              XRL     A,#080H
02C9 F8                MOV     R0,A
02CA 900000      E     MOV     DPTR,#g_meas+030H
02CD E0                MOVX    A,@DPTR
02CE 6480              XRL     A,#080H
02D0 98                SUBB    A,R0
02D1 4003              JC      $ + 5H
02D3 020000      R     LJMP    ?C0054
                                           ; SOURCE LINE # 551
02D6 900000      E     MOV     DPTR,#g_refNew
02D9 E0                MOVX    A,@DPTR
02DA F8                MOV     R0,A
02DB A3                INC     DPTR
02DC E0                MOVX    A,@DPTR
02DD F9                MOV     R1,A
02DE A3                INC     DPTR
02DF E0                MOVX    A,@DPTR
02E0 FA                MOV     R2,A
02E1 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 44  

02E2 E0                MOVX    A,@DPTR
02E3 FB                MOV     R3,A
02E4 C000              PUSH    AR0
02E6 C001              PUSH    AR1
02E8 C002              PUSH    AR2
02EA C003              PUSH    AR3
02EC 900000      E     MOV     DPTR,#g_mem+09FH
02EF E0                MOVX    A,@DPTR
02F0 FE                MOV     R6,A
02F1 A3                INC     DPTR
02F2 E0                MOVX    A,@DPTR
02F3 FF                MOV     R7,A
02F4 E4                CLR     A
02F5 FC                MOV     R4,A
02F6 FD                MOV     R5,A
02F7 AB00        R     MOV     R3,err_joy_1+03H
02F9 AA00        R     MOV     R2,err_joy_1+02H
02FB A900        R     MOV     R1,err_joy_1+01H
02FD A800        R     MOV     R0,err_joy_1
02FF 120000      E     LCALL   ?C?LMUL
0302 C006              PUSH    AR6
0304 C007              PUSH    AR7
0306 900000      E     MOV     DPTR,#g_mem+0A1H
0309 E0                MOVX    A,@DPTR
030A FE                MOV     R6,A
030B A3                INC     DPTR
030C E0                MOVX    A,@DPTR
030D FF                MOV     R7,A
030E C3                CLR     C
030F E4                CLR     A
0310 9F                SUBB    A,R7
0311 FF                MOV     R7,A
0312 7404              MOV     A,#04H
0314 9E                SUBB    A,R6
0315 FE                MOV     R6,A
0316 AB07              MOV     R3,AR7
0318 FA                MOV     R2,A
0319 33                RLC     A
031A 95E0              SUBB    A,ACC
031C F9                MOV     R1,A
031D F8                MOV     R0,A
031E D007              POP     AR7
0320 D006              POP     AR6
0322 120000      E     LCALL   ?C?SLDIV
0325 D003              POP     AR3
0327 D002              POP     AR2
0329 D001              POP     AR1
032B D000              POP     AR0
032D EB                MOV     A,R3
032E 2F                ADD     A,R7
032F FF                MOV     R7,A
0330 EA                MOV     A,R2
0331 3E                ADDC    A,R6
0332 FE                MOV     R6,A
0333 E9                MOV     A,R1
0334 3D                ADDC    A,R5
0335 FD                MOV     R5,A
0336 E8                MOV     A,R0
0337 3C                ADDC    A,R4
0338 FC                MOV     R4,A
0339 900000      E     MOV     DPTR,#g_refNew
033C 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 45  

                                           ; SOURCE LINE # 552
033F 900000      E     MOV     DPTR,#g_refNew+04H
0342 E0                MOVX    A,@DPTR
0343 F8                MOV     R0,A
0344 A3                INC     DPTR
0345 E0                MOVX    A,@DPTR
0346 F9                MOV     R1,A
0347 A3                INC     DPTR
0348 E0                MOVX    A,@DPTR
0349 FA                MOV     R2,A
034A A3                INC     DPTR
034B E0                MOVX    A,@DPTR
034C FB                MOV     R3,A
034D C000              PUSH    AR0
034F C001              PUSH    AR1
0351 C002              PUSH    AR2
0353 C003              PUSH    AR3
0355 900000      E     MOV     DPTR,#g_mem+09FH
0358 E0                MOVX    A,@DPTR
0359 FE                MOV     R6,A
035A A3                INC     DPTR
035B E0                MOVX    A,@DPTR
035C FF                MOV     R7,A
035D E4                CLR     A
035E FC                MOV     R4,A
035F FD                MOV     R5,A
0360 AB00        R     MOV     R3,err_joy_1+03H
0362 AA00        R     MOV     R2,err_joy_1+02H
0364 A900        R     MOV     R1,err_joy_1+01H
0366 A800        R     MOV     R0,err_joy_1
0368 120000      E     LCALL   ?C?LMUL
036B C006              PUSH    AR6
036D C007              PUSH    AR7
036F 900000      E     MOV     DPTR,#g_mem+0A1H
0372 E0                MOVX    A,@DPTR
0373 FE                MOV     R6,A
0374 A3                INC     DPTR
0375 E0                MOVX    A,@DPTR
0376 FF                MOV     R7,A
0377 C3                CLR     C
0378 E4                CLR     A
0379 9F                SUBB    A,R7
037A FF                MOV     R7,A
037B 7404              MOV     A,#04H
037D 9E                SUBB    A,R6
037E FE                MOV     R6,A
037F AB07              MOV     R3,AR7
0381 FA                MOV     R2,A
0382 33                RLC     A
0383 95E0              SUBB    A,ACC
0385 F9                MOV     R1,A
0386 F8                MOV     R0,A
0387 D007              POP     AR7
0389 D006              POP     AR6
038B 120000      E     LCALL   ?C?SLDIV
038E D003              POP     AR3
0390 D002              POP     AR2
0392 D001              POP     AR1
0394 D000              POP     AR0
0396 EB                MOV     A,R3
0397 2F                ADD     A,R7
0398 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 46  

0399 EA                MOV     A,R2
039A 3E                ADDC    A,R6
039B FE                MOV     R6,A
039C E9                MOV     A,R1
039D 3D                ADDC    A,R5
039E FD                MOV     R5,A
039F E8                MOV     A,R0
03A0 3C                ADDC    A,R4
03A1 FC                MOV     R4,A
03A2 900000      E     MOV     DPTR,#g_refNew+04H
03A5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 559
                                           ; SOURCE LINE # 560
03A8         ?C0054:
                                           ; SOURCE LINE # 562
03A8 900000      E     MOV     DPTR,#g_mem+0A1H
03AB E0                MOVX    A,@DPTR
03AC FA                MOV     R2,A
03AD A3                INC     DPTR
03AE E0                MOVX    A,@DPTR
03AF FB                MOV     R3,A
03B0 C3                CLR     C
03B1 900000      E     MOV     DPTR,#g_meas+033H
03B4 E0                MOVX    A,@DPTR
03B5 9B                SUBB    A,R3
03B6 FF                MOV     R7,A
03B7 900000      E     MOV     DPTR,#g_meas+032H
03BA E0                MOVX    A,@DPTR
03BB 9A                SUBB    A,R2
03BC FE                MOV     R6,A
03BD 33                RLC     A
03BE 95E0              SUBB    A,ACC
03C0 8F00        R     MOV     err_joy_2+03H,R7
03C2 8E00        R     MOV     err_joy_2+02H,R6
03C4 F500        R     MOV     err_joy_2+01H,A
03C6 F500        R     MOV     err_joy_2,A
                                           ; SOURCE LINE # 564
03C8 D3                SETB    C
03C9 A3                INC     DPTR
03CA E0                MOVX    A,@DPTR
03CB 9B                SUBB    A,R3
03CC EA                MOV     A,R2
03CD 6480              XRL     A,#080H
03CF F8                MOV     R0,A
03D0 900000      E     MOV     DPTR,#g_meas+032H
03D3 E0                MOVX    A,@DPTR
03D4 6480              XRL     A,#080H
03D6 98                SUBB    A,R0
03D7 5003              JNC     $ + 5H
03D9 020000      R     LJMP    ?C0056
                                           ; SOURCE LINE # 565
03DC 900000      E     MOV     DPTR,#g_refNew
03DF E0                MOVX    A,@DPTR
03E0 F8                MOV     R0,A
03E1 A3                INC     DPTR
03E2 E0                MOVX    A,@DPTR
03E3 F9                MOV     R1,A
03E4 A3                INC     DPTR
03E5 E0                MOVX    A,@DPTR
03E6 FA                MOV     R2,A
03E7 A3                INC     DPTR
03E8 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 47  

03E9 FB                MOV     R3,A
03EA C000              PUSH    AR0
03EC C001              PUSH    AR1
03EE C002              PUSH    AR2
03F0 C003              PUSH    AR3
03F2 900000      E     MOV     DPTR,#g_mem+09FH
03F5 E0                MOVX    A,@DPTR
03F6 FE                MOV     R6,A
03F7 A3                INC     DPTR
03F8 E0                MOVX    A,@DPTR
03F9 FF                MOV     R7,A
03FA E4                CLR     A
03FB FC                MOV     R4,A
03FC FD                MOV     R5,A
03FD AB00        R     MOV     R3,err_joy_2+03H
03FF AA00        R     MOV     R2,err_joy_2+02H
0401 A900        R     MOV     R1,err_joy_2+01H
0403 A800        R     MOV     R0,err_joy_2
0405 120000      E     LCALL   ?C?LMUL
0408 C006              PUSH    AR6
040A C007              PUSH    AR7
040C 900000      E     MOV     DPTR,#g_mem+0A1H
040F E0                MOVX    A,@DPTR
0410 FE                MOV     R6,A
0411 A3                INC     DPTR
0412 E0                MOVX    A,@DPTR
0413 FF                MOV     R7,A
0414 C3                CLR     C
0415 E4                CLR     A
0416 9F                SUBB    A,R7
0417 FF                MOV     R7,A
0418 7404              MOV     A,#04H
041A 9E                SUBB    A,R6
041B FE                MOV     R6,A
041C AB07              MOV     R3,AR7
041E FA                MOV     R2,A
041F 33                RLC     A
0420 95E0              SUBB    A,ACC
0422 F9                MOV     R1,A
0423 F8                MOV     R0,A
0424 D007              POP     AR7
0426 D006              POP     AR6
0428 120000      E     LCALL   ?C?SLDIV
042B D003              POP     AR3
042D D002              POP     AR2
042F D001              POP     AR1
0431 D000              POP     AR0
0433 EB                MOV     A,R3
0434 2F                ADD     A,R7
0435 FF                MOV     R7,A
0436 EA                MOV     A,R2
0437 3E                ADDC    A,R6
0438 FE                MOV     R6,A
0439 E9                MOV     A,R1
043A 3D                ADDC    A,R5
043B FD                MOV     R5,A
043C E8                MOV     A,R0
043D 3C                ADDC    A,R4
043E FC                MOV     R4,A
043F 900000      E     MOV     DPTR,#g_refNew
0442 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 566
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 48  

0445 900000      E     MOV     DPTR,#g_refNew+04H
0448 E0                MOVX    A,@DPTR
0449 FC                MOV     R4,A
044A A3                INC     DPTR
044B E0                MOVX    A,@DPTR
044C FD                MOV     R5,A
044D A3                INC     DPTR
044E E0                MOVX    A,@DPTR
044F FE                MOV     R6,A
0450 A3                INC     DPTR
0451 E0                MOVX    A,@DPTR
0452 FF                MOV     R7,A
0453 C004              PUSH    AR4
0455 C005              PUSH    AR5
0457 C006              PUSH    AR6
0459 C007              PUSH    AR7
045B 900000      E     MOV     DPTR,#g_mem+09FH
045E E0                MOVX    A,@DPTR
045F FE                MOV     R6,A
0460 A3                INC     DPTR
0461 E0                MOVX    A,@DPTR
0462 FF                MOV     R7,A
0463 E4                CLR     A
0464 FC                MOV     R4,A
0465 FD                MOV     R5,A
0466 AB00        R     MOV     R3,err_joy_2+03H
0468 AA00        R     MOV     R2,err_joy_2+02H
046A A900        R     MOV     R1,err_joy_2+01H
046C A800        R     MOV     R0,err_joy_2
046E 120000      E     LCALL   ?C?LMUL
0471 C006              PUSH    AR6
0473 C007              PUSH    AR7
0475 900000      E     MOV     DPTR,#g_mem+0A1H
0478 E0                MOVX    A,@DPTR
0479 FE                MOV     R6,A
047A A3                INC     DPTR
047B E0                MOVX    A,@DPTR
047C FF                MOV     R7,A
047D C3                CLR     C
047E E4                CLR     A
047F 9F                SUBB    A,R7
0480 FF                MOV     R7,A
0481 7404              MOV     A,#04H
0483 9E                SUBB    A,R6
0484 FE                MOV     R6,A
0485 AB07              MOV     R3,AR7
0487 FA                MOV     R2,A
0488 33                RLC     A
0489 95E0              SUBB    A,ACC
048B F9                MOV     R1,A
048C F8                MOV     R0,A
048D D007              POP     AR7
048F D006              POP     AR6
0491 120000      E     LCALL   ?C?SLDIV
0494 A804              MOV     R0,AR4
0496 A905              MOV     R1,AR5
0498 AA06              MOV     R2,AR6
049A AB07              MOV     R3,AR7
049C D007              POP     AR7
049E D006              POP     AR6
04A0 D005              POP     AR5
04A2 D004              POP     AR4
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 49  

04A4 C3                CLR     C
04A5 EF                MOV     A,R7
04A6 9B                SUBB    A,R3
04A7 FF                MOV     R7,A
04A8 EE                MOV     A,R6
04A9 9A                SUBB    A,R2
04AA FE                MOV     R6,A
04AB ED                MOV     A,R5
04AC 99                SUBB    A,R1
04AD FD                MOV     R5,A
04AE EC                MOV     A,R4
04AF 98                SUBB    A,R0
04B0 FC                MOV     R4,A
04B1 900000      E     MOV     DPTR,#g_refNew+04H
04B4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 573
04B7 020000      R     LJMP    ?C0043
04BA         ?C0056:
                                           ; SOURCE LINE # 574
                                           ; SOURCE LINE # 575
04BA 900000      E     MOV     DPTR,#g_mem+0A1H
04BD E0                MOVX    A,@DPTR
04BE FA                MOV     R2,A
04BF A3                INC     DPTR
04C0 E0                MOVX    A,@DPTR
04C1 FB                MOV     R3,A
04C2 900000      E     MOV     DPTR,#g_meas+033H
04C5 E0                MOVX    A,@DPTR
04C6 2B                ADD     A,R3
04C7 FF                MOV     R7,A
04C8 900000      E     MOV     DPTR,#g_meas+032H
04CB E0                MOVX    A,@DPTR
04CC 3A                ADDC    A,R2
04CD FE                MOV     R6,A
04CE 33                RLC     A
04CF 95E0              SUBB    A,ACC
04D1 8F00        R     MOV     err_joy_2+03H,R7
04D3 8E00        R     MOV     err_joy_2+02H,R6
04D5 F500        R     MOV     err_joy_2+01H,A
04D7 F500        R     MOV     err_joy_2,A
                                           ; SOURCE LINE # 577
04D9 C3                CLR     C
04DA E4                CLR     A
04DB 9B                SUBB    A,R3
04DC FF                MOV     R7,A
04DD E4                CLR     A
04DE 9A                SUBB    A,R2
04DF FE                MOV     R6,A
04E0 C3                CLR     C
04E1 A3                INC     DPTR
04E2 E0                MOVX    A,@DPTR
04E3 9F                SUBB    A,R7
04E4 EE                MOV     A,R6
04E5 6480              XRL     A,#080H
04E7 F8                MOV     R0,A
04E8 900000      E     MOV     DPTR,#g_meas+032H
04EB E0                MOVX    A,@DPTR
04EC 6480              XRL     A,#080H
04EE 98                SUBB    A,R0
04EF 4003              JC      $ + 5H
04F1 020000      R     LJMP    ?C0043
                                           ; SOURCE LINE # 578
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 50  

04F4 900000      E     MOV     DPTR,#g_refNew
04F7 E0                MOVX    A,@DPTR
04F8 F8                MOV     R0,A
04F9 A3                INC     DPTR
04FA E0                MOVX    A,@DPTR
04FB F9                MOV     R1,A
04FC A3                INC     DPTR
04FD E0                MOVX    A,@DPTR
04FE FA                MOV     R2,A
04FF A3                INC     DPTR
0500 E0                MOVX    A,@DPTR
0501 FB                MOV     R3,A
0502 C000              PUSH    AR0
0504 C001              PUSH    AR1
0506 C002              PUSH    AR2
0508 C003              PUSH    AR3
050A 900000      E     MOV     DPTR,#g_mem+09FH
050D E0                MOVX    A,@DPTR
050E FE                MOV     R6,A
050F A3                INC     DPTR
0510 E0                MOVX    A,@DPTR
0511 FF                MOV     R7,A
0512 E4                CLR     A
0513 FC                MOV     R4,A
0514 FD                MOV     R5,A
0515 AB00        R     MOV     R3,err_joy_2+03H
0517 AA00        R     MOV     R2,err_joy_2+02H
0519 A900        R     MOV     R1,err_joy_2+01H
051B A800        R     MOV     R0,err_joy_2
051D 120000      E     LCALL   ?C?LMUL
0520 C006              PUSH    AR6
0522 C007              PUSH    AR7
0524 900000      E     MOV     DPTR,#g_mem+0A1H
0527 E0                MOVX    A,@DPTR
0528 FE                MOV     R6,A
0529 A3                INC     DPTR
052A E0                MOVX    A,@DPTR
052B FF                MOV     R7,A
052C C3                CLR     C
052D E4                CLR     A
052E 9F                SUBB    A,R7
052F FF                MOV     R7,A
0530 7404              MOV     A,#04H
0532 9E                SUBB    A,R6
0533 FE                MOV     R6,A
0534 AB07              MOV     R3,AR7
0536 FA                MOV     R2,A
0537 33                RLC     A
0538 95E0              SUBB    A,ACC
053A F9                MOV     R1,A
053B F8                MOV     R0,A
053C D007              POP     AR7
053E D006              POP     AR6
0540 120000      E     LCALL   ?C?SLDIV
0543 D003              POP     AR3
0545 D002              POP     AR2
0547 D001              POP     AR1
0549 D000              POP     AR0
054B EB                MOV     A,R3
054C 2F                ADD     A,R7
054D FF                MOV     R7,A
054E EA                MOV     A,R2
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 51  

054F 3E                ADDC    A,R6
0550 FE                MOV     R6,A
0551 E9                MOV     A,R1
0552 3D                ADDC    A,R5
0553 FD                MOV     R5,A
0554 E8                MOV     A,R0
0555 3C                ADDC    A,R4
0556 FC                MOV     R4,A
0557 900000      E     MOV     DPTR,#g_refNew
055A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 579
055D 900000      E     MOV     DPTR,#g_refNew+04H
0560 E0                MOVX    A,@DPTR
0561 FC                MOV     R4,A
0562 A3                INC     DPTR
0563 E0                MOVX    A,@DPTR
0564 FD                MOV     R5,A
0565 A3                INC     DPTR
0566 E0                MOVX    A,@DPTR
0567 FE                MOV     R6,A
0568 A3                INC     DPTR
0569 E0                MOVX    A,@DPTR
056A FF                MOV     R7,A
056B C004              PUSH    AR4
056D C005              PUSH    AR5
056F C006              PUSH    AR6
0571 C007              PUSH    AR7
0573 900000      E     MOV     DPTR,#g_mem+09FH
0576 E0                MOVX    A,@DPTR
0577 FE                MOV     R6,A
0578 A3                INC     DPTR
0579 E0                MOVX    A,@DPTR
057A FF                MOV     R7,A
057B E4                CLR     A
057C FC                MOV     R4,A
057D FD                MOV     R5,A
057E AB00        R     MOV     R3,err_joy_2+03H
0580 AA00        R     MOV     R2,err_joy_2+02H
0582 A900        R     MOV     R1,err_joy_2+01H
0584 A800        R     MOV     R0,err_joy_2
0586 120000      E     LCALL   ?C?LMUL
0589 C006              PUSH    AR6
058B C007              PUSH    AR7
058D 900000      E     MOV     DPTR,#g_mem+0A1H
0590 E0                MOVX    A,@DPTR
0591 FE                MOV     R6,A
0592 A3                INC     DPTR
0593 E0                MOVX    A,@DPTR
0594 FF                MOV     R7,A
0595 C3                CLR     C
0596 E4                CLR     A
0597 9F                SUBB    A,R7
0598 FF                MOV     R7,A
0599 7404              MOV     A,#04H
059B 9E                SUBB    A,R6
059C FE                MOV     R6,A
059D AB07              MOV     R3,AR7
059F FA                MOV     R2,A
05A0 33                RLC     A
05A1 95E0              SUBB    A,ACC
05A3 F9                MOV     R1,A
05A4 F8                MOV     R0,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 52  

05A5 D007              POP     AR7
05A7 D006              POP     AR6
05A9 120000      E     LCALL   ?C?SLDIV
05AC A804              MOV     R0,AR4
05AE A905              MOV     R1,AR5
05B0 AA06              MOV     R2,AR6
05B2 AB07              MOV     R3,AR7
05B4 D007              POP     AR7
05B6 D006              POP     AR6
05B8 D005              POP     AR5
05BA D004              POP     AR4
05BC C3                CLR     C
05BD EF                MOV     A,R7
05BE 9B                SUBB    A,R3
05BF FF                MOV     R7,A
05C0 EE                MOV     A,R6
05C1 9A                SUBB    A,R2
05C2 FE                MOV     R6,A
05C3 ED                MOV     A,R5
05C4 99                SUBB    A,R1
05C5 FD                MOV     R5,A
05C6 EC                MOV     A,R4
05C7 98                SUBB    A,R0
05C8 FC                MOV     R4,A
05C9 900000      E     MOV     DPTR,#g_refNew+04H
05CC 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 586
                                           ; SOURCE LINE # 587
                                           ; SOURCE LINE # 588
05CF 020000      R     LJMP    ?C0043
05D2         ?C0050:
                                           ; SOURCE LINE # 590
                                           ; SOURCE LINE # 592
05D2 900000      E     MOV     DPTR,#g_meas+014H
05D5 E0                MOVX    A,@DPTR
05D6 F8                MOV     R0,A
05D7 A3                INC     DPTR
05D8 E0                MOVX    A,@DPTR
05D9 F9                MOV     R1,A
05DA A3                INC     DPTR
05DB E0                MOVX    A,@DPTR
05DC FA                MOV     R2,A
05DD A3                INC     DPTR
05DE E0                MOVX    A,@DPTR
05DF FB                MOV     R3,A
05E0 900000      E     MOV     DPTR,#g_meas+010H
05E3 E0                MOVX    A,@DPTR
05E4 FC                MOV     R4,A
05E5 A3                INC     DPTR
05E6 E0                MOVX    A,@DPTR
05E7 FD                MOV     R5,A
05E8 A3                INC     DPTR
05E9 E0                MOVX    A,@DPTR
05EA FE                MOV     R6,A
05EB A3                INC     DPTR
05EC E0                MOVX    A,@DPTR
05ED C3                CLR     C
05EE 9B                SUBB    A,R3
05EF FF                MOV     R7,A
05F0 EE                MOV     A,R6
05F1 9A                SUBB    A,R2
05F2 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 53  

05F3 ED                MOV     A,R5
05F4 99                SUBB    A,R1
05F5 FD                MOV     R5,A
05F6 EC                MOV     A,R4
05F7 98                SUBB    A,R0
05F8 FC                MOV     R4,A
05F9 900000      E     MOV     DPTR,#c_mem+037H
05FC E0                MOVX    A,@DPTR
05FD F9                MOV     R1,A
05FE F8                MOV     R0,A
05FF 120000      E     LCALL   ?C?SLSHR
0602 8F00        R     MOV     pos_diff+03H,R7
0604 8E00        R     MOV     pos_diff+02H,R6
0606 8D00        R     MOV     pos_diff+01H,R5
0608 8C00        R     MOV     pos_diff,R4
                                           ; SOURCE LINE # 593
060A 900000      E     MOV     DPTR,#g_meas+014H
060D E0                MOVX    A,@DPTR
060E FC                MOV     R4,A
060F A3                INC     DPTR
0610 E0                MOVX    A,@DPTR
0611 FD                MOV     R5,A
0612 A3                INC     DPTR
0613 E0                MOVX    A,@DPTR
0614 FE                MOV     R6,A
0615 A3                INC     DPTR
0616 E0                MOVX    A,@DPTR
0617 FF                MOV     R7,A
0618 900000      E     MOV     DPTR,#g_meas+010H
061B E0                MOVX    A,@DPTR
061C F8                MOV     R0,A
061D A3                INC     DPTR
061E E0                MOVX    A,@DPTR
061F F9                MOV     R1,A
0620 A3                INC     DPTR
0621 E0                MOVX    A,@DPTR
0622 FA                MOV     R2,A
0623 A3                INC     DPTR
0624 E0                MOVX    A,@DPTR
0625 2F                ADD     A,R7
0626 FF                MOV     R7,A
0627 EA                MOV     A,R2
0628 3E                ADDC    A,R6
0629 FE                MOV     R6,A
062A E9                MOV     A,R1
062B 3D                ADDC    A,R5
062C FD                MOV     R5,A
062D E8                MOV     A,R0
062E 3C                ADDC    A,R4
062F FC                MOV     R4,A
0630 900000      E     MOV     DPTR,#c_mem+037H
0633 E0                MOVX    A,@DPTR
0634 F9                MOV     R1,A
0635 F8                MOV     R0,A
0636 120000      E     LCALL   ?C?SLSHR
0639 8F00        R     MOV     pos_sum+03H,R7
063B 8E00        R     MOV     pos_sum+02H,R6
063D 8D00        R     MOV     pos_sum+01H,R5
063F 8C00        R     MOV     pos_sum,R4
                                           ; SOURCE LINE # 595
0641 AE00        R     MOV     R6,pos_diff+02H
0643 AF00        R     MOV     R7,pos_diff+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 54  

0645 120000      E     LCALL   _abs
0648 D3                SETB    C
0649 EF                MOV     A,R7
064A 94F4              SUBB    A,#0F4H
064C EE                MOV     A,R6
064D 6480              XRL     A,#080H
064F 9481              SUBB    A,#081H
0651 5003              JNC     $ + 5H
0653 020000      R     LJMP    ?C0060
                                           ; SOURCE LINE # 596
0656 E4                CLR     A
0657 FF                MOV     R7,A
0658 FE                MOV     R6,A
0659 FD                MOV     R5,A
065A FC                MOV     R4,A
065B AB00        R     MOV     R3,pos_diff+03H
065D AA00        R     MOV     R2,pos_diff+02H
065F A900        R     MOV     R1,pos_diff+01H
0661 A800        R     MOV     R0,pos_diff
0663 120000      E     LCALL   ?C?SLCMP
0666 4006              JC      ?C0062
0668 7E00              MOV     R6,#00H
066A 7F01              MOV     R7,#01H
066C 8004              SJMP    ?C0063
066E         ?C0062:
066E 7EFF              MOV     R6,#0FFH
0670 7FFF              MOV     R7,#0FFH
0672         ?C0063:
0672 EF                MOV     A,R7
0673 6401              XRL     A,#01H
0675 4E                ORL     A,R6
0676 7068              JNZ     ?C0061
                                           ; SOURCE LINE # 597
0678 900000      E     MOV     DPTR,#g_refNew+04H
067B E0                MOVX    A,@DPTR
067C F8                MOV     R0,A
067D A3                INC     DPTR
067E E0                MOVX    A,@DPTR
067F F9                MOV     R1,A
0680 A3                INC     DPTR
0681 E0                MOVX    A,@DPTR
0682 FA                MOV     R2,A
0683 A3                INC     DPTR
0684 E0                MOVX    A,@DPTR
0685 FB                MOV     R3,A
0686 900000      E     MOV     DPTR,#g_mem+09FH
0689 E0                MOVX    A,@DPTR
068A FE                MOV     R6,A
068B A3                INC     DPTR
068C E0                MOVX    A,@DPTR
068D FF                MOV     R7,A
068E E4                CLR     A
068F FC                MOV     R4,A
0690 FD                MOV     R5,A
0691 EB                MOV     A,R3
0692 2F                ADD     A,R7
0693 FF                MOV     R7,A
0694 EA                MOV     A,R2
0695 3E                ADDC    A,R6
0696 FE                MOV     R6,A
0697 ED                MOV     A,R5
0698 39                ADDC    A,R1
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 55  

0699 FD                MOV     R5,A
069A EC                MOV     A,R4
069B 38                ADDC    A,R0
069C FC                MOV     R4,A
069D 900000      E     MOV     DPTR,#g_refNew+04H
06A0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 598
06A3 900000      E     MOV     DPTR,#g_refNew
06A6 E0                MOVX    A,@DPTR
06A7 FC                MOV     R4,A
06A8 A3                INC     DPTR
06A9 E0                MOVX    A,@DPTR
06AA FD                MOV     R5,A
06AB A3                INC     DPTR
06AC E0                MOVX    A,@DPTR
06AD FE                MOV     R6,A
06AE A3                INC     DPTR
06AF E0                MOVX    A,@DPTR
06B0 FF                MOV     R7,A
06B1 C006              PUSH    AR6
06B3 C007              PUSH    AR7
06B5 900000      E     MOV     DPTR,#g_mem+09FH
06B8 E0                MOVX    A,@DPTR
06B9 C3                CLR     C
06BA 13                RRC     A
06BB FE                MOV     R6,A
06BC A3                INC     DPTR
06BD E0                MOVX    A,@DPTR
06BE 13                RRC     A
06BF FF                MOV     R7,A
06C0 FB                MOV     R3,A
06C1 AA06              MOV     R2,AR6
06C3 E4                CLR     A
06C4 D007              POP     AR7
06C6 D006              POP     AR6
06C8 C3                CLR     C
06C9 EF                MOV     A,R7
06CA 9B                SUBB    A,R3
06CB FF                MOV     R7,A
06CC EE                MOV     A,R6
06CD 9A                SUBB    A,R2
06CE FE                MOV     R6,A
06CF ED                MOV     A,R5
06D0 9400              SUBB    A,#00H
06D2 FD                MOV     R5,A
06D3 EC                MOV     A,R4
06D4 9400              SUBB    A,#00H
06D6 FC                MOV     R4,A
06D7 900000      E     MOV     DPTR,#g_refNew
06DA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 599
06DD 020000      R     LJMP    ?C0043
06E0         ?C0061:
                                           ; SOURCE LINE # 600
                                           ; SOURCE LINE # 601
06E0 900000      E     MOV     DPTR,#g_refNew
06E3 E0                MOVX    A,@DPTR
06E4 F8                MOV     R0,A
06E5 A3                INC     DPTR
06E6 E0                MOVX    A,@DPTR
06E7 F9                MOV     R1,A
06E8 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 56  

06E9 E0                MOVX    A,@DPTR
06EA FA                MOV     R2,A
06EB A3                INC     DPTR
06EC E0                MOVX    A,@DPTR
06ED FB                MOV     R3,A
06EE 900000      E     MOV     DPTR,#g_mem+09FH
06F1 E0                MOVX    A,@DPTR
06F2 FE                MOV     R6,A
06F3 A3                INC     DPTR
06F4 E0                MOVX    A,@DPTR
06F5 FF                MOV     R7,A
06F6 E4                CLR     A
06F7 FC                MOV     R4,A
06F8 FD                MOV     R5,A
06F9 EB                MOV     A,R3
06FA 2F                ADD     A,R7
06FB FF                MOV     R7,A
06FC EA                MOV     A,R2
06FD 3E                ADDC    A,R6
06FE FE                MOV     R6,A
06FF ED                MOV     A,R5
0700 39                ADDC    A,R1
0701 FD                MOV     R5,A
0702 EC                MOV     A,R4
0703 38                ADDC    A,R0
0704 FC                MOV     R4,A
0705 900000      E     MOV     DPTR,#g_refNew
0708 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 602
070B 900000      E     MOV     DPTR,#g_refNew+04H
070E E0                MOVX    A,@DPTR
070F FC                MOV     R4,A
0710 A3                INC     DPTR
0711 E0                MOVX    A,@DPTR
0712 FD                MOV     R5,A
0713 A3                INC     DPTR
0714 E0                MOVX    A,@DPTR
0715 FE                MOV     R6,A
0716 A3                INC     DPTR
0717 E0                MOVX    A,@DPTR
0718 FF                MOV     R7,A
0719 C006              PUSH    AR6
071B C007              PUSH    AR7
071D 900000      E     MOV     DPTR,#g_mem+09FH
0720 E0                MOVX    A,@DPTR
0721 C3                CLR     C
0722 13                RRC     A
0723 FE                MOV     R6,A
0724 A3                INC     DPTR
0725 E0                MOVX    A,@DPTR
0726 13                RRC     A
0727 FF                MOV     R7,A
0728 FB                MOV     R3,A
0729 AA06              MOV     R2,AR6
072B E4                CLR     A
072C D007              POP     AR7
072E D006              POP     AR6
0730 C3                CLR     C
0731 EF                MOV     A,R7
0732 9B                SUBB    A,R3
0733 FF                MOV     R7,A
0734 EE                MOV     A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 57  

0735 9A                SUBB    A,R2
0736 FE                MOV     R6,A
0737 ED                MOV     A,R5
0738 9400              SUBB    A,#00H
073A FD                MOV     R5,A
073B EC                MOV     A,R4
073C 9400              SUBB    A,#00H
073E FC                MOV     R4,A
073F 900000      E     MOV     DPTR,#g_refNew+04H
0742 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 603
                                           ; SOURCE LINE # 609
0745 020000      R     LJMP    ?C0043
0748         ?C0060:
                                           ; SOURCE LINE # 610
                                           ; SOURCE LINE # 611
0748 E4                CLR     A
0749 FF                MOV     R7,A
074A FE                MOV     R6,A
074B FD                MOV     R5,A
074C FC                MOV     R4,A
074D AB00        R     MOV     R3,pos_sum+03H
074F AA00        R     MOV     R2,pos_sum+02H
0751 A900        R     MOV     R1,pos_sum+01H
0753 A800        R     MOV     R0,pos_sum
0755 D3                SETB    C
0756 120000      E     LCALL   ?C?SLCMP
0759 5003              JNC     $ + 5H
075B 020000      R     LJMP    ?C0043
                                           ; SOURCE LINE # 612
075E 900000      E     MOV     DPTR,#g_refNew
0761 E0                MOVX    A,@DPTR
0762 FC                MOV     R4,A
0763 A3                INC     DPTR
0764 E0                MOVX    A,@DPTR
0765 FD                MOV     R5,A
0766 A3                INC     DPTR
0767 E0                MOVX    A,@DPTR
0768 FE                MOV     R6,A
0769 A3                INC     DPTR
076A E0                MOVX    A,@DPTR
076B FF                MOV     R7,A
076C C006              PUSH    AR6
076E C007              PUSH    AR7
0770 900000      E     MOV     DPTR,#g_mem+0A0H
0773 E0                MOVX    A,@DPTR
0774 25E0              ADD     A,ACC
0776 FF                MOV     R7,A
0777 900000      E     MOV     DPTR,#g_mem+09FH
077A E0                MOVX    A,@DPTR
077B 33                RLC     A
077C FE                MOV     R6,A
077D AB07              MOV     R3,AR7
077F FA                MOV     R2,A
0780 E4                CLR     A
0781 D007              POP     AR7
0783 D006              POP     AR6
0785 C3                CLR     C
0786 EF                MOV     A,R7
0787 9B                SUBB    A,R3
0788 FF                MOV     R7,A
0789 EE                MOV     A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 58  

078A 9A                SUBB    A,R2
078B FE                MOV     R6,A
078C ED                MOV     A,R5
078D 9400              SUBB    A,#00H
078F FD                MOV     R5,A
0790 EC                MOV     A,R4
0791 9400              SUBB    A,#00H
0793 FC                MOV     R4,A
0794 900000      E     MOV     DPTR,#g_refNew
0797 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 613
079A 900000      E     MOV     DPTR,#g_refNew+04H
079D E0                MOVX    A,@DPTR
079E FC                MOV     R4,A
079F A3                INC     DPTR
07A0 E0                MOVX    A,@DPTR
07A1 FD                MOV     R5,A
07A2 A3                INC     DPTR
07A3 E0                MOVX    A,@DPTR
07A4 FE                MOV     R6,A
07A5 A3                INC     DPTR
07A6 E0                MOVX    A,@DPTR
07A7 FF                MOV     R7,A
07A8 C006              PUSH    AR6
07AA C007              PUSH    AR7
07AC 900000      E     MOV     DPTR,#g_mem+0A0H
07AF E0                MOVX    A,@DPTR
07B0 25E0              ADD     A,ACC
07B2 FF                MOV     R7,A
07B3 900000      E     MOV     DPTR,#g_mem+09FH
07B6 E0                MOVX    A,@DPTR
07B7 33                RLC     A
07B8 FE                MOV     R6,A
07B9 AB07              MOV     R3,AR7
07BB FA                MOV     R2,A
07BC E4                CLR     A
07BD D007              POP     AR7
07BF D006              POP     AR6
07C1 C3                CLR     C
07C2 EF                MOV     A,R7
07C3 9B                SUBB    A,R3
07C4 FF                MOV     R7,A
07C5 EE                MOV     A,R6
07C6 9A                SUBB    A,R2
07C7 FE                MOV     R6,A
07C8 ED                MOV     A,R5
07C9 9400              SUBB    A,#00H
07CB FD                MOV     R5,A
07CC EC                MOV     A,R4
07CD 9400              SUBB    A,#00H
07CF FC                MOV     R4,A
07D0 900000      E     MOV     DPTR,#g_refNew+04H
07D3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 614
07D6 E4                CLR     A
07D7 FF                MOV     R7,A
07D8 FE                MOV     R6,A
07D9 FD                MOV     R5,A
07DA FC                MOV     R4,A
07DB 900000      E     MOV     DPTR,#g_refNew
07DE E0                MOVX    A,@DPTR
07DF F8                MOV     R0,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 59  

07E0 A3                INC     DPTR
07E1 E0                MOVX    A,@DPTR
07E2 F9                MOV     R1,A
07E3 A3                INC     DPTR
07E4 E0                MOVX    A,@DPTR
07E5 FA                MOV     R2,A
07E6 A3                INC     DPTR
07E7 E0                MOVX    A,@DPTR
07E8 FB                MOV     R3,A
07E9 C3                CLR     C
07EA 120000      E     LCALL   ?C?SLCMP
07ED 500B              JNC     ?C0067
                                           ; SOURCE LINE # 615
07EF E4                CLR     A
07F0 FF                MOV     R7,A
07F1 FE                MOV     R6,A
07F2 FD                MOV     R5,A
07F3 FC                MOV     R4,A
07F4 900000      E     MOV     DPTR,#g_refNew
07F7 120000      E     LCALL   ?C?LSTXDATA
07FA         ?C0067:
                                           ; SOURCE LINE # 616
07FA         ?C0068:
                                           ; SOURCE LINE # 617
07FA E4                CLR     A
07FB FF                MOV     R7,A
07FC FE                MOV     R6,A
07FD FD                MOV     R5,A
07FE FC                MOV     R4,A
07FF 900000      E     MOV     DPTR,#g_refNew+04H
0802 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 618
                                           ; SOURCE LINE # 619
                                           ; SOURCE LINE # 620
                                           ; SOURCE LINE # 622
                                           ; SOURCE LINE # 624
                                           ; SOURCE LINE # 625
                                           ; SOURCE LINE # 626
0805         ?C0043:
                                           ; SOURCE LINE # 628
0805 900000      E     MOV     DPTR,#c_mem+036H
0808 E0                MOVX    A,@DPTR
0809 14                DEC     A
080A 7003              JNZ     $ + 5H
080C 020000      R     LJMP    ?C0135
080F 14                DEC     A
0810 7003              JNZ     $ + 5H
0812 020000      R     LJMP    ?C0115
0815 14                DEC     A
0816 7003              JNZ     $ + 5H
0818 020000      R     LJMP    ?C0087
081B 2403              ADD     A,#03H
081D 6003              JZ      $ + 5H
081F 020000      R     LJMP    ?C0070
                                           ; SOURCE LINE # 629
0822         ?C0071:
                                           ; SOURCE LINE # 631
0822 E500        R     MOV     A,index
0824 25E0              ADD     A,ACC
0826 25E0              ADD     A,ACC
0828 25E0              ADD     A,ACC
082A 2400        E     ADD     A,#LOW g_meas+010H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 60  

082C F582              MOV     DPL,A
082E E4                CLR     A
082F 3400        E     ADDC    A,#HIGH g_meas+010H
0831 F583              MOV     DPH,A
0833 E0                MOVX    A,@DPTR
0834 F8                MOV     R0,A
0835 A3                INC     DPTR
0836 E0                MOVX    A,@DPTR
0837 F9                MOV     R1,A
0838 A3                INC     DPTR
0839 E0                MOVX    A,@DPTR
083A FA                MOV     R2,A
083B A3                INC     DPTR
083C E0                MOVX    A,@DPTR
083D FB                MOV     R3,A
083E E500        R     MOV     A,index
0840 25E0              ADD     A,ACC
0842 25E0              ADD     A,ACC
0844 2400        E     ADD     A,#LOW g_ref
0846 F582              MOV     DPL,A
0848 E4                CLR     A
0849 3400        E     ADDC    A,#HIGH g_ref
084B F583              MOV     DPH,A
084D E0                MOVX    A,@DPTR
084E FC                MOV     R4,A
084F A3                INC     DPTR
0850 E0                MOVX    A,@DPTR
0851 FD                MOV     R5,A
0852 A3                INC     DPTR
0853 E0                MOVX    A,@DPTR
0854 FE                MOV     R6,A
0855 A3                INC     DPTR
0856 E0                MOVX    A,@DPTR
0857 C3                CLR     C
0858 9B                SUBB    A,R3
0859 F500        R     MOV     pos_error+03H,A
085B EE                MOV     A,R6
085C 9A                SUBB    A,R2
085D F500        R     MOV     pos_error+02H,A
085F ED                MOV     A,R5
0860 99                SUBB    A,R1
0861 F500        R     MOV     pos_error+01H,A
0863 EC                MOV     A,R4
0864 98                SUBB    A,R0
0865 F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 633
0867 300005            JNB     interrupt_flag,?C0072
                                           ; SOURCE LINE # 634
086A C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 635
086C 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 636
086F         ?C0072:
                                           ; SOURCE LINE # 639
086F E500        R     MOV     A,index
0871 25E0              ADD     A,ACC
0873 25E0              ADD     A,ACC
0875 2400        R     ADD     A,#LOW pos_error_sum
0877 F582              MOV     DPL,A
0879 E4                CLR     A
087A 3400        R     ADDC    A,#HIGH pos_error_sum
087C F583              MOV     DPH,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 61  

087E C083              PUSH    DPH
0880 C082              PUSH    DPL
0882 E0                MOVX    A,@DPTR
0883 FC                MOV     R4,A
0884 A3                INC     DPTR
0885 E0                MOVX    A,@DPTR
0886 FD                MOV     R5,A
0887 A3                INC     DPTR
0888 E0                MOVX    A,@DPTR
0889 FE                MOV     R6,A
088A A3                INC     DPTR
088B E0                MOVX    A,@DPTR
088C 2500        R     ADD     A,pos_error+03H
088E FF                MOV     R7,A
088F EE                MOV     A,R6
0890 3500        R     ADDC    A,pos_error+02H
0892 FE                MOV     R6,A
0893 ED                MOV     A,R5
0894 3500        R     ADDC    A,pos_error+01H
0896 FD                MOV     R5,A
0897 EC                MOV     A,R4
0898 3500        R     ADDC    A,pos_error
089A FC                MOV     R4,A
089B D082              POP     DPL
089D D083              POP     DPH
089F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 642
08A2 E500        R     MOV     A,index
08A4 25E0              ADD     A,ACC
08A6 25E0              ADD     A,ACC
08A8 2400        R     ADD     A,#LOW pos_error_sum
08AA F582              MOV     DPL,A
08AC E4                CLR     A
08AD 3400        R     ADDC    A,#HIGH pos_error_sum
08AF F583              MOV     DPH,A
08B1 E0                MOVX    A,@DPTR
08B2 FC                MOV     R4,A
08B3 A3                INC     DPTR
08B4 E0                MOVX    A,@DPTR
08B5 FD                MOV     R5,A
08B6 A3                INC     DPTR
08B7 E0                MOVX    A,@DPTR
08B8 FE                MOV     R6,A
08B9 A3                INC     DPTR
08BA E0                MOVX    A,@DPTR
08BB FF                MOV     R7,A
08BC E4                CLR     A
08BD 7BE8              MOV     R3,#0E8H
08BF 7A03              MOV     R2,#03H
08C1 F9                MOV     R1,A
08C2 F8                MOV     R0,A
08C3 C3                CLR     C
08C4 120000      E     LCALL   ?C?SLCMP
08C7 501B              JNC     ?C0073
                                           ; SOURCE LINE # 643
08C9 E4                CLR     A
08CA 7FE8              MOV     R7,#0E8H
08CC 7E03              MOV     R6,#03H
08CE FD                MOV     R5,A
08CF FC                MOV     R4,A
08D0 E500        R     MOV     A,index
08D2 25E0              ADD     A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 62  

08D4 25E0              ADD     A,ACC
08D6 2400        R     ADD     A,#LOW pos_error_sum
08D8 F582              MOV     DPL,A
08DA E4                CLR     A
08DB 3400        R     ADDC    A,#HIGH pos_error_sum
08DD F583              MOV     DPH,A
08DF 120000      E     LCALL   ?C?LSTXDATA
08E2 8042              SJMP    ?C0074
08E4         ?C0073:
                                           ; SOURCE LINE # 644
                                           ; SOURCE LINE # 645
08E4 E500        R     MOV     A,index
08E6 25E0              ADD     A,ACC
08E8 25E0              ADD     A,ACC
08EA 2400        R     ADD     A,#LOW pos_error_sum
08EC F582              MOV     DPL,A
08EE E4                CLR     A
08EF 3400        R     ADDC    A,#HIGH pos_error_sum
08F1 F583              MOV     DPH,A
08F3 E0                MOVX    A,@DPTR
08F4 FC                MOV     R4,A
08F5 A3                INC     DPTR
08F6 E0                MOVX    A,@DPTR
08F7 FD                MOV     R5,A
08F8 A3                INC     DPTR
08F9 E0                MOVX    A,@DPTR
08FA FE                MOV     R6,A
08FB A3                INC     DPTR
08FC E0                MOVX    A,@DPTR
08FD FF                MOV     R7,A
08FE 7B18              MOV     R3,#018H
0900 7AFC              MOV     R2,#0FCH
0902 79FF              MOV     R1,#0FFH
0904 78FF              MOV     R0,#0FFH
0906 D3                SETB    C
0907 120000      E     LCALL   ?C?SLCMP
090A 401A              JC      ?C0074
                                           ; SOURCE LINE # 646
090C 7F18              MOV     R7,#018H
090E 7EFC              MOV     R6,#0FCH
0910 7DFF              MOV     R5,#0FFH
0912 7CFF              MOV     R4,#0FFH
0914 E500        R     MOV     A,index
0916 25E0              ADD     A,ACC
0918 25E0              ADD     A,ACC
091A 2400        R     ADD     A,#LOW pos_error_sum
091C F582              MOV     DPL,A
091E E4                CLR     A
091F 3400        R     ADDC    A,#HIGH pos_error_sum
0921 F583              MOV     DPH,A
0923 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 647
0926         ?C0074:
                                           ; SOURCE LINE # 649
0926 300005            JNB     interrupt_flag,?C0076
                                           ; SOURCE LINE # 650
0929 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 651
092B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 652
092E         ?C0076:
                                           ; SOURCE LINE # 654
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 63  

092E E4                CLR     A
092F F500        R     MOV     pwm_input+03H,A
0931 F500        R     MOV     pwm_input+02H,A
0933 F500        R     MOV     pwm_input+01H,A
0935 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 656
0937 FF                MOV     R7,A
0938 FE                MOV     R6,A
0939 FD                MOV     R5,A
093A FC                MOV     R4,A
093B AB00        R     MOV     R3,k_p+03H
093D AA00        R     MOV     R2,k_p+02H
093F A900        R     MOV     R1,k_p+01H
0941 A800        R     MOV     R0,k_p
0943 C3                CLR     C
0944 120000      E     LCALL   ?C?SLCMP
0947 601A              JZ      ?C0077
                                           ; SOURCE LINE # 657
0949 AF00        R     MOV     R7,pos_error+03H
094B AE00        R     MOV     R6,pos_error+02H
094D AD00        R     MOV     R5,pos_error+01H
094F AC00        R     MOV     R4,pos_error
0951 A800        R     MOV     R0,k_p
0953 120000      E     LCALL   ?C?LMUL
0956 7810              MOV     R0,#010H
0958 120000      E     LCALL   ?C?SLSHR
095B 8F00        R     MOV     pwm_input+03H,R7
095D 8E00        R     MOV     pwm_input+02H,R6
095F 8D00        R     MOV     pwm_input+01H,R5
0961 8C00        R     MOV     pwm_input,R4
0963         ?C0077:
                                           ; SOURCE LINE # 660
0963 E4                CLR     A
0964 FF                MOV     R7,A
0965 FE                MOV     R6,A
0966 FD                MOV     R5,A
0967 FC                MOV     R4,A
0968 AB00        R     MOV     R3,k_i+03H
096A AA00        R     MOV     R2,k_i+02H
096C A900        R     MOV     R1,k_i+01H
096E A800        R     MOV     R0,k_i
0970 C3                CLR     C
0971 120000      E     LCALL   ?C?SLCMP
0974 6038              JZ      ?C0078
                                           ; SOURCE LINE # 661
0976 E500        R     MOV     A,index
0978 25E0              ADD     A,ACC
097A 25E0              ADD     A,ACC
097C 2400        R     ADD     A,#LOW pos_error_sum
097E F582              MOV     DPL,A
0980 E4                CLR     A
0981 3400        R     ADDC    A,#HIGH pos_error_sum
0983 F583              MOV     DPH,A
0985 E0                MOVX    A,@DPTR
0986 FC                MOV     R4,A
0987 A3                INC     DPTR
0988 E0                MOVX    A,@DPTR
0989 FD                MOV     R5,A
098A A3                INC     DPTR
098B E0                MOVX    A,@DPTR
098C FE                MOV     R6,A
098D A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 64  

098E E0                MOVX    A,@DPTR
098F FF                MOV     R7,A
0990 A800        R     MOV     R0,k_i
0992 120000      E     LCALL   ?C?LMUL
0995 7810              MOV     R0,#010H
0997 120000      E     LCALL   ?C?SLSHR
099A E500        R     MOV     A,pwm_input+03H
099C 2F                ADD     A,R7
099D F500        R     MOV     pwm_input+03H,A
099F E500        R     MOV     A,pwm_input+02H
09A1 3E                ADDC    A,R6
09A2 F500        R     MOV     pwm_input+02H,A
09A4 E500        R     MOV     A,pwm_input+01H
09A6 3D                ADDC    A,R5
09A7 F500        R     MOV     pwm_input+01H,A
09A9 E500        R     MOV     A,pwm_input
09AB 3C                ADDC    A,R4
09AC F500        R     MOV     pwm_input,A
09AE         ?C0078:
                                           ; SOURCE LINE # 664
09AE E4                CLR     A
09AF FF                MOV     R7,A
09B0 FE                MOV     R6,A
09B1 FD                MOV     R5,A
09B2 FC                MOV     R4,A
09B3 AB00        R     MOV     R3,k_d+03H
09B5 AA00        R     MOV     R2,k_d+02H
09B7 A900        R     MOV     R1,k_d+01H
09B9 A800        R     MOV     R0,k_d
09BB C3                CLR     C
09BC 120000      E     LCALL   ?C?SLCMP
09BF 604F              JZ      ?C0079
                                           ; SOURCE LINE # 665
09C1 E500        R     MOV     A,index
09C3 25E0              ADD     A,ACC
09C5 25E0              ADD     A,ACC
09C7 2400        R     ADD     A,#LOW prev_pos_err
09C9 F582              MOV     DPL,A
09CB E4                CLR     A
09CC 3400        R     ADDC    A,#HIGH prev_pos_err
09CE F583              MOV     DPH,A
09D0 E0                MOVX    A,@DPTR
09D1 F8                MOV     R0,A
09D2 A3                INC     DPTR
09D3 E0                MOVX    A,@DPTR
09D4 F9                MOV     R1,A
09D5 A3                INC     DPTR
09D6 E0                MOVX    A,@DPTR
09D7 FA                MOV     R2,A
09D8 A3                INC     DPTR
09D9 E0                MOVX    A,@DPTR
09DA FB                MOV     R3,A
09DB C3                CLR     C
09DC E500        R     MOV     A,pos_error+03H
09DE 9B                SUBB    A,R3
09DF FF                MOV     R7,A
09E0 E500        R     MOV     A,pos_error+02H
09E2 9A                SUBB    A,R2
09E3 FE                MOV     R6,A
09E4 E500        R     MOV     A,pos_error+01H
09E6 99                SUBB    A,R1
09E7 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 65  

09E8 E500        R     MOV     A,pos_error
09EA 98                SUBB    A,R0
09EB FC                MOV     R4,A
09EC AB00        R     MOV     R3,k_d+03H
09EE AA00        R     MOV     R2,k_d+02H
09F0 A900        R     MOV     R1,k_d+01H
09F2 A800        R     MOV     R0,k_d
09F4 120000      E     LCALL   ?C?LMUL
09F7 7810              MOV     R0,#010H
09F9 120000      E     LCALL   ?C?SLSHR
09FC E500        R     MOV     A,pwm_input+03H
09FE 2F                ADD     A,R7
09FF F500        R     MOV     pwm_input+03H,A
0A01 E500        R     MOV     A,pwm_input+02H
0A03 3E                ADDC    A,R6
0A04 F500        R     MOV     pwm_input+02H,A
0A06 E500        R     MOV     A,pwm_input+01H
0A08 3D                ADDC    A,R5
0A09 F500        R     MOV     pwm_input+01H,A
0A0B E500        R     MOV     A,pwm_input
0A0D 3C                ADDC    A,R4
0A0E F500        R     MOV     pwm_input,A
0A10         ?C0079:
                                           ; SOURCE LINE # 667
0A10 AF00        R     MOV     R7,pos_error+03H
0A12 AE00        R     MOV     R6,pos_error+02H
0A14 AD00        R     MOV     R5,pos_error+01H
0A16 AC00        R     MOV     R4,pos_error
0A18 E500        R     MOV     A,index
0A1A 25E0              ADD     A,ACC
0A1C 25E0              ADD     A,ACC
0A1E 2400        R     ADD     A,#LOW prev_pos_err
0A20 F582              MOV     DPL,A
0A22 E4                CLR     A
0A23 3400        R     ADDC    A,#HIGH prev_pos_err
0A25 F583              MOV     DPH,A
0A27 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 669
0A2A 300005            JNB     interrupt_flag,?C0080
                                           ; SOURCE LINE # 670
0A2D C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 671
0A2F 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 672
0A32         ?C0080:
                                           ; SOURCE LINE # 675
0A32 E500        R     MOV     A,index
0A34 701C              JNZ     ?C0081
                                           ; SOURCE LINE # 676
0A36 FF                MOV     R7,A
0A37 FE                MOV     R6,A
0A38 FD                MOV     R5,A
0A39 FC                MOV     R4,A
0A3A AB00        R     MOV     R3,pwm_input+03H
0A3C AA00        R     MOV     R2,pwm_input+02H
0A3E A900        R     MOV     R1,pwm_input+01H
0A40 A800        R     MOV     R0,pwm_input
0A42 C3                CLR     C
0A43 120000      E     LCALL   ?C?SLCMP
0A46 4005              JC      ?C0082
                                           ; SOURCE LINE # 677
0A48 D200        R     SETB    dirM0
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 66  

0A4A 020000      R     LJMP    ?C0070
0A4D         ?C0082:
                                           ; SOURCE LINE # 680
0A4D C200        R     CLR     dirM0
                                           ; SOURCE LINE # 682
0A4F 020000      R     LJMP    ?C0070
0A52         ?C0081:
                                           ; SOURCE LINE # 683
                                           ; SOURCE LINE # 684
0A52 E4                CLR     A
0A53 FF                MOV     R7,A
0A54 FE                MOV     R6,A
0A55 FD                MOV     R5,A
0A56 FC                MOV     R4,A
0A57 AB00        R     MOV     R3,pwm_input+03H
0A59 AA00        R     MOV     R2,pwm_input+02H
0A5B A900        R     MOV     R1,pwm_input+01H
0A5D A800        R     MOV     R0,pwm_input
0A5F C3                CLR     C
0A60 120000      E     LCALL   ?C?SLCMP
0A63 4005              JC      ?C0085
                                           ; SOURCE LINE # 685
0A65 D200        R     SETB    dirM1
0A67 020000      R     LJMP    ?C0070
0A6A         ?C0085:
                                           ; SOURCE LINE # 688
0A6A C200        R     CLR     dirM1
                                           ; SOURCE LINE # 690
                                           ; SOURCE LINE # 692
0A6C 020000      R     LJMP    ?C0070
                                           ; SOURCE LINE # 694
0A6F         ?C0087:
                                           ; SOURCE LINE # 696
0A6F E500        R     MOV     A,index
0A71 25E0              ADD     A,ACC
0A73 25E0              ADD     A,ACC
0A75 25E0              ADD     A,ACC
0A77 2400        E     ADD     A,#LOW g_meas+010H
0A79 F582              MOV     DPL,A
0A7B E4                CLR     A
0A7C 3400        E     ADDC    A,#HIGH g_meas+010H
0A7E F583              MOV     DPH,A
0A80 E0                MOVX    A,@DPTR
0A81 F8                MOV     R0,A
0A82 A3                INC     DPTR
0A83 E0                MOVX    A,@DPTR
0A84 F9                MOV     R1,A
0A85 A3                INC     DPTR
0A86 E0                MOVX    A,@DPTR
0A87 FA                MOV     R2,A
0A88 A3                INC     DPTR
0A89 E0                MOVX    A,@DPTR
0A8A FB                MOV     R3,A
0A8B E500        R     MOV     A,index
0A8D 25E0              ADD     A,ACC
0A8F 25E0              ADD     A,ACC
0A91 2400        E     ADD     A,#LOW g_ref
0A93 F582              MOV     DPL,A
0A95 E4                CLR     A
0A96 3400        E     ADDC    A,#HIGH g_ref
0A98 F583              MOV     DPH,A
0A9A E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 67  

0A9B FC                MOV     R4,A
0A9C A3                INC     DPTR
0A9D E0                MOVX    A,@DPTR
0A9E FD                MOV     R5,A
0A9F A3                INC     DPTR
0AA0 E0                MOVX    A,@DPTR
0AA1 FE                MOV     R6,A
0AA2 A3                INC     DPTR
0AA3 E0                MOVX    A,@DPTR
0AA4 C3                CLR     C
0AA5 9B                SUBB    A,R3
0AA6 F500        R     MOV     pos_error+03H,A
0AA8 EE                MOV     A,R6
0AA9 9A                SUBB    A,R2
0AAA F500        R     MOV     pos_error+02H,A
0AAC ED                MOV     A,R5
0AAD 99                SUBB    A,R1
0AAE F500        R     MOV     pos_error+01H,A
0AB0 EC                MOV     A,R4
0AB1 98                SUBB    A,R0
0AB2 F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 698
0AB4 E500        R     MOV     A,index
0AB6 25E0              ADD     A,ACC
0AB8 25E0              ADD     A,ACC
0ABA 2400        R     ADD     A,#LOW pos_error_sum
0ABC F582              MOV     DPL,A
0ABE E4                CLR     A
0ABF 3400        R     ADDC    A,#HIGH pos_error_sum
0AC1 F583              MOV     DPH,A
0AC3 C083              PUSH    DPH
0AC5 C082              PUSH    DPL
0AC7 E0                MOVX    A,@DPTR
0AC8 FC                MOV     R4,A
0AC9 A3                INC     DPTR
0ACA E0                MOVX    A,@DPTR
0ACB FD                MOV     R5,A
0ACC A3                INC     DPTR
0ACD E0                MOVX    A,@DPTR
0ACE FE                MOV     R6,A
0ACF A3                INC     DPTR
0AD0 E0                MOVX    A,@DPTR
0AD1 2500        R     ADD     A,pos_error+03H
0AD3 FF                MOV     R7,A
0AD4 EE                MOV     A,R6
0AD5 3500        R     ADDC    A,pos_error+02H
0AD7 FE                MOV     R6,A
0AD8 ED                MOV     A,R5
0AD9 3500        R     ADDC    A,pos_error+01H
0ADB FD                MOV     R5,A
0ADC EC                MOV     A,R4
0ADD 3500        R     ADDC    A,pos_error
0ADF FC                MOV     R4,A
0AE0 D082              POP     DPL
0AE2 D083              POP     DPH
0AE4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 700
0AE7 300005            JNB     interrupt_flag,?C0088
                                           ; SOURCE LINE # 701
0AEA C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 702
0AEC 120000      R     LCALL   interrupt_manager
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 68  

                                           ; SOURCE LINE # 703
0AEF         ?C0088:
                                           ; SOURCE LINE # 706
0AEF E500        R     MOV     A,index
0AF1 25E0              ADD     A,ACC
0AF3 25E0              ADD     A,ACC
0AF5 2400        R     ADD     A,#LOW pos_error_sum
0AF7 F582              MOV     DPL,A
0AF9 E4                CLR     A
0AFA 3400        R     ADDC    A,#HIGH pos_error_sum
0AFC F583              MOV     DPH,A
0AFE E0                MOVX    A,@DPTR
0AFF FC                MOV     R4,A
0B00 A3                INC     DPTR
0B01 E0                MOVX    A,@DPTR
0B02 FD                MOV     R5,A
0B03 A3                INC     DPTR
0B04 E0                MOVX    A,@DPTR
0B05 FE                MOV     R6,A
0B06 A3                INC     DPTR
0B07 E0                MOVX    A,@DPTR
0B08 FF                MOV     R7,A
0B09 7B80              MOV     R3,#080H
0B0B 7AF0              MOV     R2,#0F0H
0B0D 79FA              MOV     R1,#0FAH
0B0F 7802              MOV     R0,#02H
0B11 C3                CLR     C
0B12 120000      E     LCALL   ?C?SLCMP
0B15 501C              JNC     ?C0089
                                           ; SOURCE LINE # 707
0B17 7F80              MOV     R7,#080H
0B19 7EF0              MOV     R6,#0F0H
0B1B 7DFA              MOV     R5,#0FAH
0B1D 7C02              MOV     R4,#02H
0B1F E500        R     MOV     A,index
0B21 25E0              ADD     A,ACC
0B23 25E0              ADD     A,ACC
0B25 2400        R     ADD     A,#LOW pos_error_sum
0B27 F582              MOV     DPL,A
0B29 E4                CLR     A
0B2A 3400        R     ADDC    A,#HIGH pos_error_sum
0B2C F583              MOV     DPH,A
0B2E 120000      E     LCALL   ?C?LSTXDATA
0B31 8042              SJMP    ?C0090
0B33         ?C0089:
                                           ; SOURCE LINE # 708
                                           ; SOURCE LINE # 709
0B33 E500        R     MOV     A,index
0B35 25E0              ADD     A,ACC
0B37 25E0              ADD     A,ACC
0B39 2400        R     ADD     A,#LOW pos_error_sum
0B3B F582              MOV     DPL,A
0B3D E4                CLR     A
0B3E 3400        R     ADDC    A,#HIGH pos_error_sum
0B40 F583              MOV     DPH,A
0B42 E0                MOVX    A,@DPTR
0B43 FC                MOV     R4,A
0B44 A3                INC     DPTR
0B45 E0                MOVX    A,@DPTR
0B46 FD                MOV     R5,A
0B47 A3                INC     DPTR
0B48 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 69  

0B49 FE                MOV     R6,A
0B4A A3                INC     DPTR
0B4B E0                MOVX    A,@DPTR
0B4C FF                MOV     R7,A
0B4D 7B80              MOV     R3,#080H
0B4F 7A0F              MOV     R2,#0FH
0B51 7905              MOV     R1,#05H
0B53 78FD              MOV     R0,#0FDH
0B55 D3                SETB    C
0B56 120000      E     LCALL   ?C?SLCMP
0B59 401A              JC      ?C0090
                                           ; SOURCE LINE # 710
0B5B 7F80              MOV     R7,#080H
0B5D 7E0F              MOV     R6,#0FH
0B5F 7D05              MOV     R5,#05H
0B61 7CFD              MOV     R4,#0FDH
0B63 E500        R     MOV     A,index
0B65 25E0              ADD     A,ACC
0B67 25E0              ADD     A,ACC
0B69 2400        R     ADD     A,#LOW pos_error_sum
0B6B F582              MOV     DPL,A
0B6D E4                CLR     A
0B6E 3400        R     ADDC    A,#HIGH pos_error_sum
0B70 F583              MOV     DPH,A
0B72 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 711
0B75         ?C0090:
                                           ; SOURCE LINE # 714
0B75 E4                CLR     A
0B76 F500        R     MOV     curr_ref+03H,A
0B78 F500        R     MOV     curr_ref+02H,A
0B7A F500        R     MOV     curr_ref+01H,A
0B7C F500        R     MOV     curr_ref,A
                                           ; SOURCE LINE # 716
0B7E 300005            JNB     interrupt_flag,?C0092
                                           ; SOURCE LINE # 717
0B81 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 718
0B83 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 719
0B86         ?C0092:
                                           ; SOURCE LINE # 722
0B86 E4                CLR     A
0B87 FF                MOV     R7,A
0B88 FE                MOV     R6,A
0B89 FD                MOV     R5,A
0B8A FC                MOV     R4,A
0B8B 900000      R     MOV     DPTR,#k_p_dl
0B8E E0                MOVX    A,@DPTR
0B8F F8                MOV     R0,A
0B90 A3                INC     DPTR
0B91 E0                MOVX    A,@DPTR
0B92 F9                MOV     R1,A
0B93 A3                INC     DPTR
0B94 E0                MOVX    A,@DPTR
0B95 FA                MOV     R2,A
0B96 A3                INC     DPTR
0B97 E0                MOVX    A,@DPTR
0B98 FB                MOV     R3,A
0B99 C3                CLR     C
0B9A 120000      E     LCALL   ?C?SLCMP
0B9D 602F              JZ      ?C0093
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 70  

                                           ; SOURCE LINE # 723
0B9F AF00        R     MOV     R7,pos_error+03H
0BA1 AE00        R     MOV     R6,pos_error+02H
0BA3 AD00        R     MOV     R5,pos_error+01H
0BA5 AC00        R     MOV     R4,pos_error
0BA7 900000      R     MOV     DPTR,#k_p_dl
0BAA E0                MOVX    A,@DPTR
0BAB F8                MOV     R0,A
0BAC A3                INC     DPTR
0BAD E0                MOVX    A,@DPTR
0BAE A3                INC     DPTR
0BAF E0                MOVX    A,@DPTR
0BB0 A3                INC     DPTR
0BB1 E0                MOVX    A,@DPTR
0BB2 120000      E     LCALL   ?C?LMUL
0BB5 7810              MOV     R0,#010H
0BB7 120000      E     LCALL   ?C?SLSHR
0BBA E500        R     MOV     A,curr_ref+03H
0BBC 2F                ADD     A,R7
0BBD F500        R     MOV     curr_ref+03H,A
0BBF E500        R     MOV     A,curr_ref+02H
0BC1 3E                ADDC    A,R6
0BC2 F500        R     MOV     curr_ref+02H,A
0BC4 E500        R     MOV     A,curr_ref+01H
0BC6 3D                ADDC    A,R5
0BC7 F500        R     MOV     curr_ref+01H,A
0BC9 E500        R     MOV     A,curr_ref
0BCB 3C                ADDC    A,R4
0BCC F500        R     MOV     curr_ref,A
0BCE         ?C0093:
                                           ; SOURCE LINE # 726
0BCE E4                CLR     A
0BCF FF                MOV     R7,A
0BD0 FE                MOV     R6,A
0BD1 FD                MOV     R5,A
0BD2 FC                MOV     R4,A
0BD3 900000      R     MOV     DPTR,#k_i_dl
0BD6 E0                MOVX    A,@DPTR
0BD7 F8                MOV     R0,A
0BD8 A3                INC     DPTR
0BD9 E0                MOVX    A,@DPTR
0BDA F9                MOV     R1,A
0BDB A3                INC     DPTR
0BDC E0                MOVX    A,@DPTR
0BDD FA                MOV     R2,A
0BDE A3                INC     DPTR
0BDF E0                MOVX    A,@DPTR
0BE0 FB                MOV     R3,A
0BE1 C3                CLR     C
0BE2 120000      E     LCALL   ?C?SLCMP
0BE5 6041              JZ      ?C0094
                                           ; SOURCE LINE # 727
0BE7 E500        R     MOV     A,index
0BE9 25E0              ADD     A,ACC
0BEB 25E0              ADD     A,ACC
0BED 2400        R     ADD     A,#LOW pos_error_sum
0BEF F582              MOV     DPL,A
0BF1 E4                CLR     A
0BF2 3400        R     ADDC    A,#HIGH pos_error_sum
0BF4 F583              MOV     DPH,A
0BF6 E0                MOVX    A,@DPTR
0BF7 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 71  

0BF8 A3                INC     DPTR
0BF9 E0                MOVX    A,@DPTR
0BFA FD                MOV     R5,A
0BFB A3                INC     DPTR
0BFC E0                MOVX    A,@DPTR
0BFD FE                MOV     R6,A
0BFE A3                INC     DPTR
0BFF E0                MOVX    A,@DPTR
0C00 FF                MOV     R7,A
0C01 900000      R     MOV     DPTR,#k_i_dl
0C04 E0                MOVX    A,@DPTR
0C05 F8                MOV     R0,A
0C06 A3                INC     DPTR
0C07 E0                MOVX    A,@DPTR
0C08 A3                INC     DPTR
0C09 E0                MOVX    A,@DPTR
0C0A A3                INC     DPTR
0C0B E0                MOVX    A,@DPTR
0C0C 120000      E     LCALL   ?C?LMUL
0C0F 7810              MOV     R0,#010H
0C11 120000      E     LCALL   ?C?SLSHR
0C14 E500        R     MOV     A,curr_ref+03H
0C16 2F                ADD     A,R7
0C17 F500        R     MOV     curr_ref+03H,A
0C19 E500        R     MOV     A,curr_ref+02H
0C1B 3E                ADDC    A,R6
0C1C F500        R     MOV     curr_ref+02H,A
0C1E E500        R     MOV     A,curr_ref+01H
0C20 3D                ADDC    A,R5
0C21 F500        R     MOV     curr_ref+01H,A
0C23 E500        R     MOV     A,curr_ref
0C25 3C                ADDC    A,R4
0C26 F500        R     MOV     curr_ref,A
0C28         ?C0094:
                                           ; SOURCE LINE # 730
0C28 E4                CLR     A
0C29 FF                MOV     R7,A
0C2A FE                MOV     R6,A
0C2B FD                MOV     R5,A
0C2C FC                MOV     R4,A
0C2D 900000      R     MOV     DPTR,#k_d_dl
0C30 E0                MOVX    A,@DPTR
0C31 F8                MOV     R0,A
0C32 A3                INC     DPTR
0C33 E0                MOVX    A,@DPTR
0C34 F9                MOV     R1,A
0C35 A3                INC     DPTR
0C36 E0                MOVX    A,@DPTR
0C37 FA                MOV     R2,A
0C38 A3                INC     DPTR
0C39 E0                MOVX    A,@DPTR
0C3A FB                MOV     R3,A
0C3B C3                CLR     C
0C3C 120000      E     LCALL   ?C?SLCMP
0C3F 6055              JZ      ?C0095
                                           ; SOURCE LINE # 731
0C41 E500        R     MOV     A,index
0C43 25E0              ADD     A,ACC
0C45 25E0              ADD     A,ACC
0C47 2400        R     ADD     A,#LOW prev_pos_err
0C49 F582              MOV     DPL,A
0C4B E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 72  

0C4C 3400        R     ADDC    A,#HIGH prev_pos_err
0C4E F583              MOV     DPH,A
0C50 E0                MOVX    A,@DPTR
0C51 F8                MOV     R0,A
0C52 A3                INC     DPTR
0C53 E0                MOVX    A,@DPTR
0C54 F9                MOV     R1,A
0C55 A3                INC     DPTR
0C56 E0                MOVX    A,@DPTR
0C57 FA                MOV     R2,A
0C58 A3                INC     DPTR
0C59 E0                MOVX    A,@DPTR
0C5A FB                MOV     R3,A
0C5B C3                CLR     C
0C5C E500        R     MOV     A,pos_error+03H
0C5E 9B                SUBB    A,R3
0C5F FF                MOV     R7,A
0C60 E500        R     MOV     A,pos_error+02H
0C62 9A                SUBB    A,R2
0C63 FE                MOV     R6,A
0C64 E500        R     MOV     A,pos_error+01H
0C66 99                SUBB    A,R1
0C67 FD                MOV     R5,A
0C68 E500        R     MOV     A,pos_error
0C6A 98                SUBB    A,R0
0C6B FC                MOV     R4,A
0C6C 900000      R     MOV     DPTR,#k_d_dl
0C6F E0                MOVX    A,@DPTR
0C70 F8                MOV     R0,A
0C71 A3                INC     DPTR
0C72 E0                MOVX    A,@DPTR
0C73 F9                MOV     R1,A
0C74 A3                INC     DPTR
0C75 E0                MOVX    A,@DPTR
0C76 FA                MOV     R2,A
0C77 A3                INC     DPTR
0C78 E0                MOVX    A,@DPTR
0C79 FB                MOV     R3,A
0C7A 120000      E     LCALL   ?C?LMUL
0C7D 7810              MOV     R0,#010H
0C7F 120000      E     LCALL   ?C?SLSHR
0C82 E500        R     MOV     A,curr_ref+03H
0C84 2F                ADD     A,R7
0C85 F500        R     MOV     curr_ref+03H,A
0C87 E500        R     MOV     A,curr_ref+02H
0C89 3E                ADDC    A,R6
0C8A F500        R     MOV     curr_ref+02H,A
0C8C E500        R     MOV     A,curr_ref+01H
0C8E 3D                ADDC    A,R5
0C8F F500        R     MOV     curr_ref+01H,A
0C91 E500        R     MOV     A,curr_ref
0C93 3C                ADDC    A,R4
0C94 F500        R     MOV     curr_ref,A
0C96         ?C0095:
                                           ; SOURCE LINE # 733
0C96 AF00        R     MOV     R7,pos_error+03H
0C98 AE00        R     MOV     R6,pos_error+02H
0C9A AD00        R     MOV     R5,pos_error+01H
0C9C AC00        R     MOV     R4,pos_error
0C9E E500        R     MOV     A,index
0CA0 25E0              ADD     A,ACC
0CA2 25E0              ADD     A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 73  

0CA4 2400        R     ADD     A,#LOW prev_pos_err
0CA6 F582              MOV     DPL,A
0CA8 E4                CLR     A
0CA9 3400        R     ADDC    A,#HIGH prev_pos_err
0CAB F583              MOV     DPH,A
0CAD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 735
0CB0 300005            JNB     interrupt_flag,?C0096
                                           ; SOURCE LINE # 736
0CB3 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 737
0CB5 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 738
0CB8         ?C0096:
                                           ; SOURCE LINE # 741
0CB8 900000      E     MOV     DPTR,#c_mem+032H
0CBB E0                MOVX    A,@DPTR
0CBC FE                MOV     R6,A
0CBD A3                INC     DPTR
0CBE E0                MOVX    A,@DPTR
0CBF FF                MOV     R7,A
0CC0 EE                MOV     A,R6
0CC1 33                RLC     A
0CC2 95E0              SUBB    A,ACC
0CC4 FD                MOV     R5,A
0CC5 FC                MOV     R4,A
0CC6 AB00        R     MOV     R3,curr_ref+03H
0CC8 AA00        R     MOV     R2,curr_ref+02H
0CCA A900        R     MOV     R1,curr_ref+01H
0CCC A800        R     MOV     R0,curr_ref
0CCE D3                SETB    C
0CCF 120000      E     LCALL   ?C?SLCMP
0CD2 4016              JC      ?C0097
                                           ; SOURCE LINE # 742
0CD4 900000      E     MOV     DPTR,#c_mem+032H
0CD7 E0                MOVX    A,@DPTR
0CD8 FE                MOV     R6,A
0CD9 A3                INC     DPTR
0CDA E0                MOVX    A,@DPTR
0CDB FF                MOV     R7,A
0CDC EE                MOV     A,R6
0CDD 33                RLC     A
0CDE 95E0              SUBB    A,ACC
0CE0 8F00        R     MOV     curr_ref+03H,R7
0CE2 8E00        R     MOV     curr_ref+02H,R6
0CE4 F500        R     MOV     curr_ref+01H,A
0CE6 F500        R     MOV     curr_ref,A
0CE8 803C              SJMP    ?C0098
0CEA         ?C0097:
                                           ; SOURCE LINE # 743
                                           ; SOURCE LINE # 744
0CEA 900000      E     MOV     DPTR,#c_mem+032H
0CED E0                MOVX    A,@DPTR
0CEE FE                MOV     R6,A
0CEF A3                INC     DPTR
0CF0 E0                MOVX    A,@DPTR
0CF1 FF                MOV     R7,A
0CF2 C3                CLR     C
0CF3 E4                CLR     A
0CF4 9F                SUBB    A,R7
0CF5 FF                MOV     R7,A
0CF6 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 74  

0CF7 9E                SUBB    A,R6
0CF8 FE                MOV     R6,A
0CF9 33                RLC     A
0CFA 95E0              SUBB    A,ACC
0CFC FD                MOV     R5,A
0CFD FC                MOV     R4,A
0CFE AB00        R     MOV     R3,curr_ref+03H
0D00 AA00        R     MOV     R2,curr_ref+02H
0D02 A900        R     MOV     R1,curr_ref+01H
0D04 A800        R     MOV     R0,curr_ref
0D06 C3                CLR     C
0D07 120000      E     LCALL   ?C?SLCMP
0D0A 501A              JNC     ?C0098
                                           ; SOURCE LINE # 745
0D0C 900000      E     MOV     DPTR,#c_mem+032H
0D0F E0                MOVX    A,@DPTR
0D10 FE                MOV     R6,A
0D11 A3                INC     DPTR
0D12 E0                MOVX    A,@DPTR
0D13 FF                MOV     R7,A
0D14 C3                CLR     C
0D15 E4                CLR     A
0D16 9F                SUBB    A,R7
0D17 FF                MOV     R7,A
0D18 E4                CLR     A
0D19 9E                SUBB    A,R6
0D1A FE                MOV     R6,A
0D1B 33                RLC     A
0D1C 95E0              SUBB    A,ACC
0D1E 8F00        R     MOV     curr_ref+03H,R7
0D20 8E00        R     MOV     curr_ref+02H,R6
0D22 F500        R     MOV     curr_ref+01H,A
0D24 F500        R     MOV     curr_ref,A
                                           ; SOURCE LINE # 746
0D26         ?C0098:
                                           ; SOURCE LINE # 748
0D26 300005            JNB     interrupt_flag,?C0100
                                           ; SOURCE LINE # 749
0D29 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 750
0D2B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 751
0D2E         ?C0100:
                                           ; SOURCE LINE # 754
0D2E E500        R     MOV     A,index
0D30 25E0              ADD     A,ACC
0D32 25E0              ADD     A,ACC
0D34 2400        E     ADD     A,#LOW g_meas+08H
0D36 F582              MOV     DPL,A
0D38 E4                CLR     A
0D39 3400        E     ADDC    A,#HIGH g_meas+08H
0D3B F583              MOV     DPH,A
0D3D E0                MOVX    A,@DPTR
0D3E F8                MOV     R0,A
0D3F A3                INC     DPTR
0D40 E0                MOVX    A,@DPTR
0D41 F9                MOV     R1,A
0D42 A3                INC     DPTR
0D43 E0                MOVX    A,@DPTR
0D44 FA                MOV     R2,A
0D45 A3                INC     DPTR
0D46 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 75  

0D47 FB                MOV     R3,A
0D48 C3                CLR     C
0D49 E500        R     MOV     A,curr_ref+03H
0D4B 9B                SUBB    A,R3
0D4C F500        R     MOV     curr_error+03H,A
0D4E E500        R     MOV     A,curr_ref+02H
0D50 9A                SUBB    A,R2
0D51 F500        R     MOV     curr_error+02H,A
0D53 E500        R     MOV     A,curr_ref+01H
0D55 99                SUBB    A,R1
0D56 F500        R     MOV     curr_error+01H,A
0D58 E500        R     MOV     A,curr_ref
0D5A 98                SUBB    A,R0
0D5B F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 755
0D5D E500        R     MOV     A,index
0D5F 25E0              ADD     A,ACC
0D61 25E0              ADD     A,ACC
0D63 2400        R     ADD     A,#LOW curr_error_sum
0D65 F582              MOV     DPL,A
0D67 E4                CLR     A
0D68 3400        R     ADDC    A,#HIGH curr_error_sum
0D6A F583              MOV     DPH,A
0D6C C083              PUSH    DPH
0D6E C082              PUSH    DPL
0D70 E0                MOVX    A,@DPTR
0D71 FC                MOV     R4,A
0D72 A3                INC     DPTR
0D73 E0                MOVX    A,@DPTR
0D74 FD                MOV     R5,A
0D75 A3                INC     DPTR
0D76 E0                MOVX    A,@DPTR
0D77 FE                MOV     R6,A
0D78 A3                INC     DPTR
0D79 E0                MOVX    A,@DPTR
0D7A 2500        R     ADD     A,curr_error+03H
0D7C FF                MOV     R7,A
0D7D EE                MOV     A,R6
0D7E 3500        R     ADDC    A,curr_error+02H
0D80 FE                MOV     R6,A
0D81 ED                MOV     A,R5
0D82 3500        R     ADDC    A,curr_error+01H
0D84 FD                MOV     R5,A
0D85 EC                MOV     A,R4
0D86 3500        R     ADDC    A,curr_error
0D88 FC                MOV     R4,A
0D89 D082              POP     DPL
0D8B D083              POP     DPH
0D8D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 757
0D90 E500        R     MOV     A,index
0D92 25E0              ADD     A,ACC
0D94 25E0              ADD     A,ACC
0D96 2400        R     ADD     A,#LOW curr_error_sum
0D98 F582              MOV     DPL,A
0D9A E4                CLR     A
0D9B 3400        R     ADDC    A,#HIGH curr_error_sum
0D9D F583              MOV     DPH,A
0D9F E0                MOVX    A,@DPTR
0DA0 FC                MOV     R4,A
0DA1 A3                INC     DPTR
0DA2 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 76  

0DA3 FD                MOV     R5,A
0DA4 A3                INC     DPTR
0DA5 E0                MOVX    A,@DPTR
0DA6 FE                MOV     R6,A
0DA7 A3                INC     DPTR
0DA8 E0                MOVX    A,@DPTR
0DA9 FF                MOV     R7,A
0DAA 7BA0              MOV     R3,#0A0H
0DAC 7A86              MOV     R2,#086H
0DAE 7901              MOV     R1,#01H
0DB0 7800              MOV     R0,#00H
0DB2 C3                CLR     C
0DB3 120000      E     LCALL   ?C?SLCMP
0DB6 501C              JNC     ?C0101
                                           ; SOURCE LINE # 758
0DB8 7FA0              MOV     R7,#0A0H
0DBA 7E86              MOV     R6,#086H
0DBC 7D01              MOV     R5,#01H
0DBE 7C00              MOV     R4,#00H
0DC0 E500        R     MOV     A,index
0DC2 25E0              ADD     A,ACC
0DC4 25E0              ADD     A,ACC
0DC6 2400        R     ADD     A,#LOW curr_error_sum
0DC8 F582              MOV     DPL,A
0DCA E4                CLR     A
0DCB 3400        R     ADDC    A,#HIGH curr_error_sum
0DCD F583              MOV     DPH,A
0DCF 120000      E     LCALL   ?C?LSTXDATA
0DD2 8042              SJMP    ?C0102
0DD4         ?C0101:
                                           ; SOURCE LINE # 759
                                           ; SOURCE LINE # 760
0DD4 E500        R     MOV     A,index
0DD6 25E0              ADD     A,ACC
0DD8 25E0              ADD     A,ACC
0DDA 2400        R     ADD     A,#LOW curr_error_sum
0DDC F582              MOV     DPL,A
0DDE E4                CLR     A
0DDF 3400        R     ADDC    A,#HIGH curr_error_sum
0DE1 F583              MOV     DPH,A
0DE3 E0                MOVX    A,@DPTR
0DE4 FC                MOV     R4,A
0DE5 A3                INC     DPTR
0DE6 E0                MOVX    A,@DPTR
0DE7 FD                MOV     R5,A
0DE8 A3                INC     DPTR
0DE9 E0                MOVX    A,@DPTR
0DEA FE                MOV     R6,A
0DEB A3                INC     DPTR
0DEC E0                MOVX    A,@DPTR
0DED FF                MOV     R7,A
0DEE 7B60              MOV     R3,#060H
0DF0 7A79              MOV     R2,#079H
0DF2 79FE              MOV     R1,#0FEH
0DF4 78FF              MOV     R0,#0FFH
0DF6 D3                SETB    C
0DF7 120000      E     LCALL   ?C?SLCMP
0DFA 401A              JC      ?C0102
                                           ; SOURCE LINE # 761
0DFC 7F60              MOV     R7,#060H
0DFE 7E79              MOV     R6,#079H
0E00 7DFE              MOV     R5,#0FEH
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 77  

0E02 7CFF              MOV     R4,#0FFH
0E04 E500        R     MOV     A,index
0E06 25E0              ADD     A,ACC
0E08 25E0              ADD     A,ACC
0E0A 2400        R     ADD     A,#LOW curr_error_sum
0E0C F582              MOV     DPL,A
0E0E E4                CLR     A
0E0F 3400        R     ADDC    A,#HIGH curr_error_sum
0E11 F583              MOV     DPH,A
0E13 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 762
0E16         ?C0102:
                                           ; SOURCE LINE # 764
0E16 300005            JNB     interrupt_flag,?C0104
                                           ; SOURCE LINE # 765
0E19 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 766
0E1B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 767
0E1E         ?C0104:
                                           ; SOURCE LINE # 771
0E1E E4                CLR     A
0E1F F500        R     MOV     pwm_input+03H,A
0E21 F500        R     MOV     pwm_input+02H,A
0E23 F500        R     MOV     pwm_input+01H,A
0E25 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 774
0E27 FF                MOV     R7,A
0E28 FE                MOV     R6,A
0E29 FD                MOV     R5,A
0E2A FC                MOV     R4,A
0E2B 900000      R     MOV     DPTR,#k_p_c_dl
0E2E E0                MOVX    A,@DPTR
0E2F F8                MOV     R0,A
0E30 A3                INC     DPTR
0E31 E0                MOVX    A,@DPTR
0E32 F9                MOV     R1,A
0E33 A3                INC     DPTR
0E34 E0                MOVX    A,@DPTR
0E35 FA                MOV     R2,A
0E36 A3                INC     DPTR
0E37 E0                MOVX    A,@DPTR
0E38 FB                MOV     R3,A
0E39 C3                CLR     C
0E3A 120000      E     LCALL   ?C?SLCMP
0E3D 602F              JZ      ?C0105
                                           ; SOURCE LINE # 775
0E3F AF00        R     MOV     R7,curr_error+03H
0E41 AE00        R     MOV     R6,curr_error+02H
0E43 AD00        R     MOV     R5,curr_error+01H
0E45 AC00        R     MOV     R4,curr_error
0E47 900000      R     MOV     DPTR,#k_p_c_dl
0E4A E0                MOVX    A,@DPTR
0E4B F8                MOV     R0,A
0E4C A3                INC     DPTR
0E4D E0                MOVX    A,@DPTR
0E4E A3                INC     DPTR
0E4F E0                MOVX    A,@DPTR
0E50 A3                INC     DPTR
0E51 E0                MOVX    A,@DPTR
0E52 120000      E     LCALL   ?C?LMUL
0E55 7810              MOV     R0,#010H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 78  

0E57 120000      E     LCALL   ?C?SLSHR
0E5A E500        R     MOV     A,pwm_input+03H
0E5C 2F                ADD     A,R7
0E5D F500        R     MOV     pwm_input+03H,A
0E5F E500        R     MOV     A,pwm_input+02H
0E61 3E                ADDC    A,R6
0E62 F500        R     MOV     pwm_input+02H,A
0E64 E500        R     MOV     A,pwm_input+01H
0E66 3D                ADDC    A,R5
0E67 F500        R     MOV     pwm_input+01H,A
0E69 E500        R     MOV     A,pwm_input
0E6B 3C                ADDC    A,R4
0E6C F500        R     MOV     pwm_input,A
0E6E         ?C0105:
                                           ; SOURCE LINE # 778
0E6E E4                CLR     A
0E6F FF                MOV     R7,A
0E70 FE                MOV     R6,A
0E71 FD                MOV     R5,A
0E72 FC                MOV     R4,A
0E73 900000      R     MOV     DPTR,#k_i_c_dl
0E76 E0                MOVX    A,@DPTR
0E77 F8                MOV     R0,A
0E78 A3                INC     DPTR
0E79 E0                MOVX    A,@DPTR
0E7A F9                MOV     R1,A
0E7B A3                INC     DPTR
0E7C E0                MOVX    A,@DPTR
0E7D FA                MOV     R2,A
0E7E A3                INC     DPTR
0E7F E0                MOVX    A,@DPTR
0E80 FB                MOV     R3,A
0E81 C3                CLR     C
0E82 120000      E     LCALL   ?C?SLCMP
0E85 6041              JZ      ?C0106
                                           ; SOURCE LINE # 779
0E87 E500        R     MOV     A,index
0E89 25E0              ADD     A,ACC
0E8B 25E0              ADD     A,ACC
0E8D 2400        R     ADD     A,#LOW curr_error_sum
0E8F F582              MOV     DPL,A
0E91 E4                CLR     A
0E92 3400        R     ADDC    A,#HIGH curr_error_sum
0E94 F583              MOV     DPH,A
0E96 E0                MOVX    A,@DPTR
0E97 FC                MOV     R4,A
0E98 A3                INC     DPTR
0E99 E0                MOVX    A,@DPTR
0E9A FD                MOV     R5,A
0E9B A3                INC     DPTR
0E9C E0                MOVX    A,@DPTR
0E9D FE                MOV     R6,A
0E9E A3                INC     DPTR
0E9F E0                MOVX    A,@DPTR
0EA0 FF                MOV     R7,A
0EA1 900000      R     MOV     DPTR,#k_i_c_dl
0EA4 E0                MOVX    A,@DPTR
0EA5 F8                MOV     R0,A
0EA6 A3                INC     DPTR
0EA7 E0                MOVX    A,@DPTR
0EA8 A3                INC     DPTR
0EA9 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 79  

0EAA A3                INC     DPTR
0EAB E0                MOVX    A,@DPTR
0EAC 120000      E     LCALL   ?C?LMUL
0EAF 7810              MOV     R0,#010H
0EB1 120000      E     LCALL   ?C?SLSHR
0EB4 E500        R     MOV     A,pwm_input+03H
0EB6 2F                ADD     A,R7
0EB7 F500        R     MOV     pwm_input+03H,A
0EB9 E500        R     MOV     A,pwm_input+02H
0EBB 3E                ADDC    A,R6
0EBC F500        R     MOV     pwm_input+02H,A
0EBE E500        R     MOV     A,pwm_input+01H
0EC0 3D                ADDC    A,R5
0EC1 F500        R     MOV     pwm_input+01H,A
0EC3 E500        R     MOV     A,pwm_input
0EC5 3C                ADDC    A,R4
0EC6 F500        R     MOV     pwm_input,A
0EC8         ?C0106:
                                           ; SOURCE LINE # 782
0EC8 E4                CLR     A
0EC9 FF                MOV     R7,A
0ECA FE                MOV     R6,A
0ECB FD                MOV     R5,A
0ECC FC                MOV     R4,A
0ECD 900000      R     MOV     DPTR,#k_d_c_dl
0ED0 E0                MOVX    A,@DPTR
0ED1 F8                MOV     R0,A
0ED2 A3                INC     DPTR
0ED3 E0                MOVX    A,@DPTR
0ED4 F9                MOV     R1,A
0ED5 A3                INC     DPTR
0ED6 E0                MOVX    A,@DPTR
0ED7 FA                MOV     R2,A
0ED8 A3                INC     DPTR
0ED9 E0                MOVX    A,@DPTR
0EDA FB                MOV     R3,A
0EDB C3                CLR     C
0EDC 120000      E     LCALL   ?C?SLCMP
0EDF 6055              JZ      ?C0107
                                           ; SOURCE LINE # 783
0EE1 E500        R     MOV     A,index
0EE3 25E0              ADD     A,ACC
0EE5 25E0              ADD     A,ACC
0EE7 2400        R     ADD     A,#LOW prev_curr_err
0EE9 F582              MOV     DPL,A
0EEB E4                CLR     A
0EEC 3400        R     ADDC    A,#HIGH prev_curr_err
0EEE F583              MOV     DPH,A
0EF0 E0                MOVX    A,@DPTR
0EF1 F8                MOV     R0,A
0EF2 A3                INC     DPTR
0EF3 E0                MOVX    A,@DPTR
0EF4 F9                MOV     R1,A
0EF5 A3                INC     DPTR
0EF6 E0                MOVX    A,@DPTR
0EF7 FA                MOV     R2,A
0EF8 A3                INC     DPTR
0EF9 E0                MOVX    A,@DPTR
0EFA FB                MOV     R3,A
0EFB C3                CLR     C
0EFC E500        R     MOV     A,curr_error+03H
0EFE 9B                SUBB    A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 80  

0EFF FF                MOV     R7,A
0F00 E500        R     MOV     A,curr_error+02H
0F02 9A                SUBB    A,R2
0F03 FE                MOV     R6,A
0F04 E500        R     MOV     A,curr_error+01H
0F06 99                SUBB    A,R1
0F07 FD                MOV     R5,A
0F08 E500        R     MOV     A,curr_error
0F0A 98                SUBB    A,R0
0F0B FC                MOV     R4,A
0F0C 900000      R     MOV     DPTR,#k_d_c_dl
0F0F E0                MOVX    A,@DPTR
0F10 F8                MOV     R0,A
0F11 A3                INC     DPTR
0F12 E0                MOVX    A,@DPTR
0F13 F9                MOV     R1,A
0F14 A3                INC     DPTR
0F15 E0                MOVX    A,@DPTR
0F16 FA                MOV     R2,A
0F17 A3                INC     DPTR
0F18 E0                MOVX    A,@DPTR
0F19 FB                MOV     R3,A
0F1A 120000      E     LCALL   ?C?LMUL
0F1D 7810              MOV     R0,#010H
0F1F 120000      E     LCALL   ?C?SLSHR
0F22 E500        R     MOV     A,pwm_input+03H
0F24 2F                ADD     A,R7
0F25 F500        R     MOV     pwm_input+03H,A
0F27 E500        R     MOV     A,pwm_input+02H
0F29 3E                ADDC    A,R6
0F2A F500        R     MOV     pwm_input+02H,A
0F2C E500        R     MOV     A,pwm_input+01H
0F2E 3D                ADDC    A,R5
0F2F F500        R     MOV     pwm_input+01H,A
0F31 E500        R     MOV     A,pwm_input
0F33 3C                ADDC    A,R4
0F34 F500        R     MOV     pwm_input,A
0F36         ?C0107:
                                           ; SOURCE LINE # 785
0F36 AF00        R     MOV     R7,curr_error+03H
0F38 AE00        R     MOV     R6,curr_error+02H
0F3A AD00        R     MOV     R5,curr_error+01H
0F3C AC00        R     MOV     R4,curr_error
0F3E E500        R     MOV     A,index
0F40 25E0              ADD     A,ACC
0F42 25E0              ADD     A,ACC
0F44 2400        R     ADD     A,#LOW prev_curr_err
0F46 F582              MOV     DPL,A
0F48 E4                CLR     A
0F49 3400        R     ADDC    A,#HIGH prev_curr_err
0F4B F583              MOV     DPH,A
0F4D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 787
0F50 300005            JNB     interrupt_flag,?C0108
                                           ; SOURCE LINE # 788
0F53 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 789
0F55 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 790
0F58         ?C0108:
                                           ; SOURCE LINE # 792
0F58 E500        R     MOV     A,index
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 81  

0F5A 701C              JNZ     ?C0109
                                           ; SOURCE LINE # 793
0F5C FF                MOV     R7,A
0F5D FE                MOV     R6,A
0F5E FD                MOV     R5,A
0F5F FC                MOV     R4,A
0F60 AB00        R     MOV     R3,pwm_input+03H
0F62 AA00        R     MOV     R2,pwm_input+02H
0F64 A900        R     MOV     R1,pwm_input+01H
0F66 A800        R     MOV     R0,pwm_input
0F68 C3                CLR     C
0F69 120000      E     LCALL   ?C?SLCMP
0F6C 4005              JC      ?C0110
                                           ; SOURCE LINE # 794
0F6E D200        R     SETB    dirM0
0F70 020000      R     LJMP    ?C0070
0F73         ?C0110:
                                           ; SOURCE LINE # 797
0F73 C200        R     CLR     dirM0
                                           ; SOURCE LINE # 799
0F75 020000      R     LJMP    ?C0070
0F78         ?C0109:
                                           ; SOURCE LINE # 800
                                           ; SOURCE LINE # 801
0F78 E4                CLR     A
0F79 FF                MOV     R7,A
0F7A FE                MOV     R6,A
0F7B FD                MOV     R5,A
0F7C FC                MOV     R4,A
0F7D AB00        R     MOV     R3,pwm_input+03H
0F7F AA00        R     MOV     R2,pwm_input+02H
0F81 A900        R     MOV     R1,pwm_input+01H
0F83 A800        R     MOV     R0,pwm_input
0F85 C3                CLR     C
0F86 120000      E     LCALL   ?C?SLCMP
0F89 4005              JC      ?C0113
                                           ; SOURCE LINE # 802
0F8B D200        R     SETB    dirM1
0F8D 020000      R     LJMP    ?C0070
0F90         ?C0113:
                                           ; SOURCE LINE # 805
0F90 C200        R     CLR     dirM1
                                           ; SOURCE LINE # 807
                                           ; SOURCE LINE # 809
0F92 020000      R     LJMP    ?C0070
                                           ; SOURCE LINE # 811
0F95         ?C0115:
                                           ; SOURCE LINE # 812
0F95 900000      E     MOV     DPTR,#g_ref+08H
0F98 E0                MOVX    A,@DPTR
0F99 7003              JNZ     $ + 5H
0F9B 020000      R     LJMP    ?C0070
0F9E 200003      E     JB      tension_valid,$ + 6H
0FA1 020000      R     LJMP    ?C0070
                                           ; SOURCE LINE # 814
0FA4 E500        R     MOV     A,index
0FA6 25E0              ADD     A,ACC
0FA8 25E0              ADD     A,ACC
0FAA 2400        E     ADD     A,#LOW g_ref
0FAC F582              MOV     DPL,A
0FAE E4                CLR     A
0FAF 3400        E     ADDC    A,#HIGH g_ref
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 82  

0FB1 F583              MOV     DPH,A
0FB3 E0                MOVX    A,@DPTR
0FB4 FC                MOV     R4,A
0FB5 A3                INC     DPTR
0FB6 E0                MOVX    A,@DPTR
0FB7 FD                MOV     R5,A
0FB8 A3                INC     DPTR
0FB9 E0                MOVX    A,@DPTR
0FBA FE                MOV     R6,A
0FBB A3                INC     DPTR
0FBC E0                MOVX    A,@DPTR
0FBD FF                MOV     R7,A
0FBE 7400        E     MOV     A,#LOW g_mem+037H
0FC0 2500        R     ADD     A,index
0FC2 F582              MOV     DPL,A
0FC4 E4                CLR     A
0FC5 3400        E     ADDC    A,#HIGH g_mem+037H
0FC7 F583              MOV     DPH,A
0FC9 E0                MOVX    A,@DPTR
0FCA F9                MOV     R1,A
0FCB F8                MOV     R0,A
0FCC 120000      E     LCALL   ?C?SLSHR
0FCF 8F00        R     MOV     curr_ref+03H,R7
0FD1 8E00        R     MOV     curr_ref+02H,R6
0FD3 8D00        R     MOV     curr_ref+01H,R5
0FD5 8C00        R     MOV     curr_ref,R4
                                           ; SOURCE LINE # 817
0FD7 900000      E     MOV     DPTR,#c_mem+032H
0FDA E0                MOVX    A,@DPTR
0FDB FE                MOV     R6,A
0FDC A3                INC     DPTR
0FDD E0                MOVX    A,@DPTR
0FDE FF                MOV     R7,A
0FDF EE                MOV     A,R6
0FE0 33                RLC     A
0FE1 95E0              SUBB    A,ACC
0FE3 FD                MOV     R5,A
0FE4 FC                MOV     R4,A
0FE5 AB00        R     MOV     R3,curr_ref+03H
0FE7 AA00        R     MOV     R2,curr_ref+02H
0FE9 A900        R     MOV     R1,curr_ref+01H
0FEB A800        R     MOV     R0,curr_ref
0FED D3                SETB    C
0FEE 120000      E     LCALL   ?C?SLCMP
0FF1 4016              JC      ?C0117
                                           ; SOURCE LINE # 818
0FF3 900000      E     MOV     DPTR,#c_mem+032H
0FF6 E0                MOVX    A,@DPTR
0FF7 FE                MOV     R6,A
0FF8 A3                INC     DPTR
0FF9 E0                MOVX    A,@DPTR
0FFA FF                MOV     R7,A
0FFB EE                MOV     A,R6
0FFC 33                RLC     A
0FFD 95E0              SUBB    A,ACC
0FFF 8F00        R     MOV     curr_ref+03H,R7
1001 8E00        R     MOV     curr_ref+02H,R6
1003 F500        R     MOV     curr_ref+01H,A
1005 F500        R     MOV     curr_ref,A
1007 803C              SJMP    ?C0118
1009         ?C0117:
                                           ; SOURCE LINE # 819
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 83  

                                           ; SOURCE LINE # 820
1009 900000      E     MOV     DPTR,#c_mem+032H
100C E0                MOVX    A,@DPTR
100D FE                MOV     R6,A
100E A3                INC     DPTR
100F E0                MOVX    A,@DPTR
1010 FF                MOV     R7,A
1011 C3                CLR     C
1012 E4                CLR     A
1013 9F                SUBB    A,R7
1014 FF                MOV     R7,A
1015 E4                CLR     A
1016 9E                SUBB    A,R6
1017 FE                MOV     R6,A
1018 33                RLC     A
1019 95E0              SUBB    A,ACC
101B FD                MOV     R5,A
101C FC                MOV     R4,A
101D AB00        R     MOV     R3,curr_ref+03H
101F AA00        R     MOV     R2,curr_ref+02H
1021 A900        R     MOV     R1,curr_ref+01H
1023 A800        R     MOV     R0,curr_ref
1025 C3                CLR     C
1026 120000      E     LCALL   ?C?SLCMP
1029 501A              JNC     ?C0118
                                           ; SOURCE LINE # 821
102B 900000      E     MOV     DPTR,#c_mem+032H
102E E0                MOVX    A,@DPTR
102F FE                MOV     R6,A
1030 A3                INC     DPTR
1031 E0                MOVX    A,@DPTR
1032 FF                MOV     R7,A
1033 C3                CLR     C
1034 E4                CLR     A
1035 9F                SUBB    A,R7
1036 FF                MOV     R7,A
1037 E4                CLR     A
1038 9E                SUBB    A,R6
1039 FE                MOV     R6,A
103A 33                RLC     A
103B 95E0              SUBB    A,ACC
103D 8F00        R     MOV     curr_ref+03H,R7
103F 8E00        R     MOV     curr_ref+02H,R6
1041 F500        R     MOV     curr_ref+01H,A
1043 F500        R     MOV     curr_ref,A
                                           ; SOURCE LINE # 822
1045         ?C0118:
                                           ; SOURCE LINE # 824
1045 E500        R     MOV     A,index
1047 25E0              ADD     A,ACC
1049 25E0              ADD     A,ACC
104B 2400        E     ADD     A,#LOW g_meas+08H
104D F582              MOV     DPL,A
104F E4                CLR     A
1050 3400        E     ADDC    A,#HIGH g_meas+08H
1052 F583              MOV     DPH,A
1054 E0                MOVX    A,@DPTR
1055 F8                MOV     R0,A
1056 A3                INC     DPTR
1057 E0                MOVX    A,@DPTR
1058 F9                MOV     R1,A
1059 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 84  

105A E0                MOVX    A,@DPTR
105B FA                MOV     R2,A
105C A3                INC     DPTR
105D E0                MOVX    A,@DPTR
105E FB                MOV     R3,A
105F C3                CLR     C
1060 E500        R     MOV     A,curr_ref+03H
1062 9B                SUBB    A,R3
1063 F500        R     MOV     curr_error+03H,A
1065 E500        R     MOV     A,curr_ref+02H
1067 9A                SUBB    A,R2
1068 F500        R     MOV     curr_error+02H,A
106A E500        R     MOV     A,curr_ref+01H
106C 99                SUBB    A,R1
106D F500        R     MOV     curr_error+01H,A
106F E500        R     MOV     A,curr_ref
1071 98                SUBB    A,R0
1072 F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 827
1074 E500        R     MOV     A,index
1076 25E0              ADD     A,ACC
1078 25E0              ADD     A,ACC
107A 2400        R     ADD     A,#LOW curr_error_sum
107C F582              MOV     DPL,A
107E E4                CLR     A
107F 3400        R     ADDC    A,#HIGH curr_error_sum
1081 F583              MOV     DPH,A
1083 C083              PUSH    DPH
1085 C082              PUSH    DPL
1087 E0                MOVX    A,@DPTR
1088 FC                MOV     R4,A
1089 A3                INC     DPTR
108A E0                MOVX    A,@DPTR
108B FD                MOV     R5,A
108C A3                INC     DPTR
108D E0                MOVX    A,@DPTR
108E FE                MOV     R6,A
108F A3                INC     DPTR
1090 E0                MOVX    A,@DPTR
1091 2500        R     ADD     A,curr_error+03H
1093 FF                MOV     R7,A
1094 EE                MOV     A,R6
1095 3500        R     ADDC    A,curr_error+02H
1097 FE                MOV     R6,A
1098 ED                MOV     A,R5
1099 3500        R     ADDC    A,curr_error+01H
109B FD                MOV     R5,A
109C EC                MOV     A,R4
109D 3500        R     ADDC    A,curr_error
109F FC                MOV     R4,A
10A0 D082              POP     DPL
10A2 D083              POP     DPH
10A4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 830
10A7 E500        R     MOV     A,index
10A9 25E0              ADD     A,ACC
10AB 25E0              ADD     A,ACC
10AD 2400        R     ADD     A,#LOW curr_error_sum
10AF F582              MOV     DPL,A
10B1 E4                CLR     A
10B2 3400        R     ADDC    A,#HIGH curr_error_sum
10B4 F583              MOV     DPH,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 85  

10B6 E0                MOVX    A,@DPTR
10B7 FC                MOV     R4,A
10B8 A3                INC     DPTR
10B9 E0                MOVX    A,@DPTR
10BA FD                MOV     R5,A
10BB A3                INC     DPTR
10BC E0                MOVX    A,@DPTR
10BD FE                MOV     R6,A
10BE A3                INC     DPTR
10BF E0                MOVX    A,@DPTR
10C0 FF                MOV     R7,A
10C1 7BA0              MOV     R3,#0A0H
10C3 7A86              MOV     R2,#086H
10C5 7901              MOV     R1,#01H
10C7 7800              MOV     R0,#00H
10C9 C3                CLR     C
10CA 120000      E     LCALL   ?C?SLCMP
10CD 501C              JNC     ?C0120
                                           ; SOURCE LINE # 831
10CF 7FA0              MOV     R7,#0A0H
10D1 7E86              MOV     R6,#086H
10D3 7D01              MOV     R5,#01H
10D5 7C00              MOV     R4,#00H
10D7 E500        R     MOV     A,index
10D9 25E0              ADD     A,ACC
10DB 25E0              ADD     A,ACC
10DD 2400        R     ADD     A,#LOW curr_error_sum
10DF F582              MOV     DPL,A
10E1 E4                CLR     A
10E2 3400        R     ADDC    A,#HIGH curr_error_sum
10E4 F583              MOV     DPH,A
10E6 120000      E     LCALL   ?C?LSTXDATA
10E9 8042              SJMP    ?C0121
10EB         ?C0120:
                                           ; SOURCE LINE # 832
                                           ; SOURCE LINE # 833
10EB E500        R     MOV     A,index
10ED 25E0              ADD     A,ACC
10EF 25E0              ADD     A,ACC
10F1 2400        R     ADD     A,#LOW curr_error_sum
10F3 F582              MOV     DPL,A
10F5 E4                CLR     A
10F6 3400        R     ADDC    A,#HIGH curr_error_sum
10F8 F583              MOV     DPH,A
10FA E0                MOVX    A,@DPTR
10FB FC                MOV     R4,A
10FC A3                INC     DPTR
10FD E0                MOVX    A,@DPTR
10FE FD                MOV     R5,A
10FF A3                INC     DPTR
1100 E0                MOVX    A,@DPTR
1101 FE                MOV     R6,A
1102 A3                INC     DPTR
1103 E0                MOVX    A,@DPTR
1104 FF                MOV     R7,A
1105 7B60              MOV     R3,#060H
1107 7A79              MOV     R2,#079H
1109 79FE              MOV     R1,#0FEH
110B 78FF              MOV     R0,#0FFH
110D D3                SETB    C
110E 120000      E     LCALL   ?C?SLCMP
1111 401A              JC      ?C0121
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 86  

                                           ; SOURCE LINE # 834
1113 7F60              MOV     R7,#060H
1115 7E79              MOV     R6,#079H
1117 7DFE              MOV     R5,#0FEH
1119 7CFF              MOV     R4,#0FFH
111B E500        R     MOV     A,index
111D 25E0              ADD     A,ACC
111F 25E0              ADD     A,ACC
1121 2400        R     ADD     A,#LOW curr_error_sum
1123 F582              MOV     DPL,A
1125 E4                CLR     A
1126 3400        R     ADDC    A,#HIGH curr_error_sum
1128 F583              MOV     DPH,A
112A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 835
112D         ?C0121:
                                           ; SOURCE LINE # 837
112D 300005            JNB     interrupt_flag,?C0123
                                           ; SOURCE LINE # 838
1130 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 839
1132 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 840
1135         ?C0123:
                                           ; SOURCE LINE # 843
1135 E4                CLR     A
1136 F500        R     MOV     pwm_input+03H,A
1138 F500        R     MOV     pwm_input+02H,A
113A F500        R     MOV     pwm_input+01H,A
113C F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 846
113E FF                MOV     R7,A
113F FE                MOV     R6,A
1140 FD                MOV     R5,A
1141 FC                MOV     R4,A
1142 900000      R     MOV     DPTR,#k_p_c
1145 E0                MOVX    A,@DPTR
1146 F8                MOV     R0,A
1147 A3                INC     DPTR
1148 E0                MOVX    A,@DPTR
1149 F9                MOV     R1,A
114A A3                INC     DPTR
114B E0                MOVX    A,@DPTR
114C FA                MOV     R2,A
114D A3                INC     DPTR
114E E0                MOVX    A,@DPTR
114F FB                MOV     R3,A
1150 C3                CLR     C
1151 120000      E     LCALL   ?C?SLCMP
1154 602C              JZ      ?C0124
                                           ; SOURCE LINE # 847
1156 AF00        R     MOV     R7,curr_error+03H
1158 AE00        R     MOV     R6,curr_error+02H
115A AD00        R     MOV     R5,curr_error+01H
115C AC00        R     MOV     R4,curr_error
115E AB00        R     MOV     R3,k_p+03H
1160 AA00        R     MOV     R2,k_p+02H
1162 A900        R     MOV     R1,k_p+01H
1164 A800        R     MOV     R0,k_p
1166 120000      E     LCALL   ?C?LMUL
1169 7810              MOV     R0,#010H
116B 120000      E     LCALL   ?C?SLSHR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 87  

116E E500        R     MOV     A,pwm_input+03H
1170 2F                ADD     A,R7
1171 F500        R     MOV     pwm_input+03H,A
1173 E500        R     MOV     A,pwm_input+02H
1175 3E                ADDC    A,R6
1176 F500        R     MOV     pwm_input+02H,A
1178 E500        R     MOV     A,pwm_input+01H
117A 3D                ADDC    A,R5
117B F500        R     MOV     pwm_input+01H,A
117D E500        R     MOV     A,pwm_input
117F 3C                ADDC    A,R4
1180 F500        R     MOV     pwm_input,A
1182         ?C0124:
                                           ; SOURCE LINE # 850
1182 E4                CLR     A
1183 FF                MOV     R7,A
1184 FE                MOV     R6,A
1185 FD                MOV     R5,A
1186 FC                MOV     R4,A
1187 900000      R     MOV     DPTR,#k_i_c
118A E0                MOVX    A,@DPTR
118B F8                MOV     R0,A
118C A3                INC     DPTR
118D E0                MOVX    A,@DPTR
118E F9                MOV     R1,A
118F A3                INC     DPTR
1190 E0                MOVX    A,@DPTR
1191 FA                MOV     R2,A
1192 A3                INC     DPTR
1193 E0                MOVX    A,@DPTR
1194 FB                MOV     R3,A
1195 C3                CLR     C
1196 120000      E     LCALL   ?C?SLCMP
1199 6046              JZ      ?C0125
                                           ; SOURCE LINE # 851
119B E500        R     MOV     A,index
119D 25E0              ADD     A,ACC
119F 25E0              ADD     A,ACC
11A1 2400        R     ADD     A,#LOW curr_error_sum
11A3 F582              MOV     DPL,A
11A5 E4                CLR     A
11A6 3400        R     ADDC    A,#HIGH curr_error_sum
11A8 F583              MOV     DPH,A
11AA E0                MOVX    A,@DPTR
11AB FC                MOV     R4,A
11AC A3                INC     DPTR
11AD E0                MOVX    A,@DPTR
11AE FD                MOV     R5,A
11AF A3                INC     DPTR
11B0 E0                MOVX    A,@DPTR
11B1 FE                MOV     R6,A
11B2 A3                INC     DPTR
11B3 E0                MOVX    A,@DPTR
11B4 FF                MOV     R7,A
11B5 7806              MOV     R0,#06H
11B7 120000      E     LCALL   ?C?SLSHR
11BA 900000      R     MOV     DPTR,#k_i_c
11BD E0                MOVX    A,@DPTR
11BE F8                MOV     R0,A
11BF A3                INC     DPTR
11C0 E0                MOVX    A,@DPTR
11C1 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 88  

11C2 E0                MOVX    A,@DPTR
11C3 A3                INC     DPTR
11C4 E0                MOVX    A,@DPTR
11C5 120000      E     LCALL   ?C?LMUL
11C8 780A              MOV     R0,#0AH
11CA 120000      E     LCALL   ?C?SLSHR
11CD E500        R     MOV     A,pwm_input+03H
11CF 2F                ADD     A,R7
11D0 F500        R     MOV     pwm_input+03H,A
11D2 E500        R     MOV     A,pwm_input+02H
11D4 3E                ADDC    A,R6
11D5 F500        R     MOV     pwm_input+02H,A
11D7 E500        R     MOV     A,pwm_input+01H
11D9 3D                ADDC    A,R5
11DA F500        R     MOV     pwm_input+01H,A
11DC E500        R     MOV     A,pwm_input
11DE 3C                ADDC    A,R4
11DF F500        R     MOV     pwm_input,A
11E1         ?C0125:
                                           ; SOURCE LINE # 854
11E1 E4                CLR     A
11E2 FF                MOV     R7,A
11E3 FE                MOV     R6,A
11E4 FD                MOV     R5,A
11E5 FC                MOV     R4,A
11E6 900000      R     MOV     DPTR,#k_d_c
11E9 E0                MOVX    A,@DPTR
11EA F8                MOV     R0,A
11EB A3                INC     DPTR
11EC E0                MOVX    A,@DPTR
11ED F9                MOV     R1,A
11EE A3                INC     DPTR
11EF E0                MOVX    A,@DPTR
11F0 FA                MOV     R2,A
11F1 A3                INC     DPTR
11F2 E0                MOVX    A,@DPTR
11F3 FB                MOV     R3,A
11F4 C3                CLR     C
11F5 120000      E     LCALL   ?C?SLCMP
11F8 6055              JZ      ?C0126
                                           ; SOURCE LINE # 855
11FA E500        R     MOV     A,index
11FC 25E0              ADD     A,ACC
11FE 25E0              ADD     A,ACC
1200 2400        R     ADD     A,#LOW prev_curr_err
1202 F582              MOV     DPL,A
1204 E4                CLR     A
1205 3400        R     ADDC    A,#HIGH prev_curr_err
1207 F583              MOV     DPH,A
1209 E0                MOVX    A,@DPTR
120A F8                MOV     R0,A
120B A3                INC     DPTR
120C E0                MOVX    A,@DPTR
120D F9                MOV     R1,A
120E A3                INC     DPTR
120F E0                MOVX    A,@DPTR
1210 FA                MOV     R2,A
1211 A3                INC     DPTR
1212 E0                MOVX    A,@DPTR
1213 FB                MOV     R3,A
1214 C3                CLR     C
1215 E500        R     MOV     A,curr_error+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 89  

1217 9B                SUBB    A,R3
1218 FF                MOV     R7,A
1219 E500        R     MOV     A,curr_error+02H
121B 9A                SUBB    A,R2
121C FE                MOV     R6,A
121D E500        R     MOV     A,curr_error+01H
121F 99                SUBB    A,R1
1220 FD                MOV     R5,A
1221 E500        R     MOV     A,curr_error
1223 98                SUBB    A,R0
1224 FC                MOV     R4,A
1225 900000      R     MOV     DPTR,#k_d_c
1228 E0                MOVX    A,@DPTR
1229 F8                MOV     R0,A
122A A3                INC     DPTR
122B E0                MOVX    A,@DPTR
122C F9                MOV     R1,A
122D A3                INC     DPTR
122E E0                MOVX    A,@DPTR
122F FA                MOV     R2,A
1230 A3                INC     DPTR
1231 E0                MOVX    A,@DPTR
1232 FB                MOV     R3,A
1233 120000      E     LCALL   ?C?LMUL
1236 7810              MOV     R0,#010H
1238 120000      E     LCALL   ?C?SLSHR
123B E500        R     MOV     A,pwm_input+03H
123D 2F                ADD     A,R7
123E F500        R     MOV     pwm_input+03H,A
1240 E500        R     MOV     A,pwm_input+02H
1242 3E                ADDC    A,R6
1243 F500        R     MOV     pwm_input+02H,A
1245 E500        R     MOV     A,pwm_input+01H
1247 3D                ADDC    A,R5
1248 F500        R     MOV     pwm_input+01H,A
124A E500        R     MOV     A,pwm_input
124C 3C                ADDC    A,R4
124D F500        R     MOV     pwm_input,A
124F         ?C0126:
                                           ; SOURCE LINE # 857
124F 300005            JNB     interrupt_flag,?C0127
                                           ; SOURCE LINE # 858
1252 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 859
1254 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 860
1257         ?C0127:
                                           ; SOURCE LINE # 863
1257 AF00        R     MOV     R7,curr_error+03H
1259 AE00        R     MOV     R6,curr_error+02H
125B AD00        R     MOV     R5,curr_error+01H
125D AC00        R     MOV     R4,curr_error
125F E500        R     MOV     A,index
1261 25E0              ADD     A,ACC
1263 25E0              ADD     A,ACC
1265 2400        R     ADD     A,#LOW prev_curr_err
1267 F582              MOV     DPL,A
1269 E4                CLR     A
126A 3400        R     ADDC    A,#HIGH prev_curr_err
126C F583              MOV     DPH,A
126E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 865
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 90  

1271 E500        R     MOV     A,index
1273 701A              JNZ     ?C0128
                                           ; SOURCE LINE # 866
1275 FF                MOV     R7,A
1276 FE                MOV     R6,A
1277 FD                MOV     R5,A
1278 FC                MOV     R4,A
1279 AB00        R     MOV     R3,pwm_input+03H
127B AA00        R     MOV     R2,pwm_input+02H
127D A900        R     MOV     R1,pwm_input+01H
127F A800        R     MOV     R0,pwm_input
1281 C3                CLR     C
1282 120000      E     LCALL   ?C?SLCMP
1285 4004              JC      ?C0129
                                           ; SOURCE LINE # 867
1287 D200        R     SETB    dirM0
1289 801D              SJMP    ?C0131
128B         ?C0129:
                                           ; SOURCE LINE # 870
128B C200        R     CLR     dirM0
                                           ; SOURCE LINE # 872
128D 8019              SJMP    ?C0131
128F         ?C0128:
                                           ; SOURCE LINE # 873
                                           ; SOURCE LINE # 874
128F E4                CLR     A
1290 FF                MOV     R7,A
1291 FE                MOV     R6,A
1292 FD                MOV     R5,A
1293 FC                MOV     R4,A
1294 AB00        R     MOV     R3,pwm_input+03H
1296 AA00        R     MOV     R2,pwm_input+02H
1298 A900        R     MOV     R1,pwm_input+01H
129A A800        R     MOV     R0,pwm_input
129C C3                CLR     C
129D 120000      E     LCALL   ?C?SLCMP
12A0 4004              JC      ?C0132
                                           ; SOURCE LINE # 875
12A2 D200        R     SETB    dirM1
12A4 8002              SJMP    ?C0131
12A6         ?C0132:
                                           ; SOURCE LINE # 878
12A6 C200        R     CLR     dirM1
                                           ; SOURCE LINE # 880
12A8         ?C0131:
                                           ; SOURCE LINE # 882
12A8 300071            JNB     interrupt_flag,?C0070
                                           ; SOURCE LINE # 883
12AB C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 884
12AD 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 885
                                           ; SOURCE LINE # 886
                                           ; SOURCE LINE # 888
12B0 806A              SJMP    ?C0070
                                           ; SOURCE LINE # 890
12B2         ?C0135:
                                           ; SOURCE LINE # 892
12B2 E500        R     MOV     A,index
12B4 25E0              ADD     A,ACC
12B6 25E0              ADD     A,ACC
12B8 2400        E     ADD     A,#LOW g_ref
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 91  

12BA F582              MOV     DPL,A
12BC E4                CLR     A
12BD 3400        E     ADDC    A,#HIGH g_ref
12BF F583              MOV     DPH,A
12C1 E0                MOVX    A,@DPTR
12C2 FC                MOV     R4,A
12C3 A3                INC     DPTR
12C4 E0                MOVX    A,@DPTR
12C5 FD                MOV     R5,A
12C6 A3                INC     DPTR
12C7 E0                MOVX    A,@DPTR
12C8 FE                MOV     R6,A
12C9 A3                INC     DPTR
12CA E0                MOVX    A,@DPTR
12CB FF                MOV     R7,A
12CC 7400        E     MOV     A,#LOW g_mem+037H
12CE 2500        R     ADD     A,index
12D0 F582              MOV     DPL,A
12D2 E4                CLR     A
12D3 3400        E     ADDC    A,#HIGH g_mem+037H
12D5 F583              MOV     DPH,A
12D7 E0                MOVX    A,@DPTR
12D8 F9                MOV     R1,A
12D9 F8                MOV     R0,A
12DA 120000      E     LCALL   ?C?SLSHR
12DD 8F00        R     MOV     pwm_input+03H,R7
12DF 8E00        R     MOV     pwm_input+02H,R6
12E1 8D00        R     MOV     pwm_input+01H,R5
12E3 8C00        R     MOV     pwm_input,R4
                                           ; SOURCE LINE # 894
12E5 E500        R     MOV     A,index
12E7 701A              JNZ     ?C0136
                                           ; SOURCE LINE # 895
12E9 FF                MOV     R7,A
12EA FE                MOV     R6,A
12EB FD                MOV     R5,A
12EC FC                MOV     R4,A
12ED AB00        R     MOV     R3,pwm_input+03H
12EF AA00        R     MOV     R2,pwm_input+02H
12F1 A900        R     MOV     R1,pwm_input+01H
12F3 A800        R     MOV     R0,pwm_input
12F5 C3                CLR     C
12F6 120000      E     LCALL   ?C?SLCMP
12F9 4004              JC      ?C0137
                                           ; SOURCE LINE # 896
12FB D200        R     SETB    dirM0
12FD 801D              SJMP    ?C0070
12FF         ?C0137:
                                           ; SOURCE LINE # 899
12FF C200        R     CLR     dirM0
                                           ; SOURCE LINE # 901
1301 8019              SJMP    ?C0070
1303         ?C0136:
                                           ; SOURCE LINE # 902
                                           ; SOURCE LINE # 903
1303 E4                CLR     A
1304 FF                MOV     R7,A
1305 FE                MOV     R6,A
1306 FD                MOV     R5,A
1307 FC                MOV     R4,A
1308 AB00        R     MOV     R3,pwm_input+03H
130A AA00        R     MOV     R2,pwm_input+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 92  

130C A900        R     MOV     R1,pwm_input+01H
130E A800        R     MOV     R0,pwm_input
1310 C3                CLR     C
1311 120000      E     LCALL   ?C?SLCMP
1314 4004              JC      ?C0140
                                           ; SOURCE LINE # 904
1316 D200        R     SETB    dirM1
1318 8002              SJMP    ?C0070
131A         ?C0140:
                                           ; SOURCE LINE # 907
131A C200        R     CLR     dirM1
                                           ; SOURCE LINE # 909
                                           ; SOURCE LINE # 911
                                           ; SOURCE LINE # 913
                                           ; SOURCE LINE # 914
                                           ; SOURCE LINE # 915
131C         ?C0070:
                                           ; SOURCE LINE # 917
131C 300005            JNB     interrupt_flag,?C0143
                                           ; SOURCE LINE # 918
131F C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 919
1321 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 920
1324         ?C0143:
                                           ; SOURCE LINE # 923
1324 E4                CLR     A
1325 7F64              MOV     R7,#064H
1327 FE                MOV     R6,A
1328 FD                MOV     R5,A
1329 FC                MOV     R4,A
132A AB00        R     MOV     R3,pwm_input+03H
132C AA00        R     MOV     R2,pwm_input+02H
132E A900        R     MOV     R1,pwm_input+01H
1330 A800        R     MOV     R0,pwm_input
1332 D3                SETB    C
1333 120000      E     LCALL   ?C?SLCMP
1336 400A              JC      ?C0144
                                           ; SOURCE LINE # 924
1338 E4                CLR     A
1339 750064      R     MOV     pwm_input+03H,#064H
133C F500        R     MOV     pwm_input+02H,A
133E F500        R     MOV     pwm_input+01H,A
1340 F500        R     MOV     pwm_input,A
1342         ?C0144:
                                           ; SOURCE LINE # 925
1342 74FF              MOV     A,#0FFH
1344 7F9C              MOV     R7,#09CH
1346 FE                MOV     R6,A
1347 FD                MOV     R5,A
1348 FC                MOV     R4,A
1349 AB00        R     MOV     R3,pwm_input+03H
134B AA00        R     MOV     R2,pwm_input+02H
134D A900        R     MOV     R1,pwm_input+01H
134F A800        R     MOV     R0,pwm_input
1351 C3                CLR     C
1352 120000      E     LCALL   ?C?SLCMP
1355 500B              JNC     ?C0145
                                           ; SOURCE LINE # 926
1357 74FF              MOV     A,#0FFH
1359 75009C      R     MOV     pwm_input+03H,#09CH
135C F500        R     MOV     pwm_input+02H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 93  

135E F500        R     MOV     pwm_input+01H,A
1360 F500        R     MOV     pwm_input,A
1362         ?C0145:
                                           ; SOURCE LINE # 928
1362 300005            JNB     interrupt_flag,?C0146
                                           ; SOURCE LINE # 929
1365 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 930
1367 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 931
136A         ?C0146:
                                           ; SOURCE LINE # 934
136A 900000      E     MOV     DPTR,#c_mem+036H
136D E0                MOVX    A,@DPTR
136E 6401              XRL     A,#01H
1370 6037              JZ      ?C0147
                                           ; SOURCE LINE # 935
1372 AF00        R     MOV     R7,pwm_input+03H
1374 AE00        R     MOV     R6,pwm_input+02H
1376 AD00        R     MOV     R5,pwm_input+01H
1378 AC00        R     MOV     R4,pwm_input
137A 780A              MOV     R0,#0AH
137C 120000      E     LCALL   ?C?LSHL
137F E4                CLR     A
1380 7B64              MOV     R3,#064H
1382 FA                MOV     R2,A
1383 F9                MOV     R1,A
1384 F8                MOV     R0,A
1385 120000      E     LCALL   ?C?SLDIV
1388 A804              MOV     R0,AR4
138A A905              MOV     R1,AR5
138C AA06              MOV     R2,AR6
138E AB07              MOV     R3,AR7
1390 900000      E     MOV     DPTR,#dev_pwm_limit
1393 E0                MOVX    A,@DPTR
1394 FF                MOV     R7,A
1395 E4                CLR     A
1396 FC                MOV     R4,A
1397 FD                MOV     R5,A
1398 FE                MOV     R6,A
1399 120000      E     LCALL   ?C?LMUL
139C 780A              MOV     R0,#0AH
139E 120000      E     LCALL   ?C?SLSHR
13A1 8F00        R     MOV     pwm_input+03H,R7
13A3 8E00        R     MOV     pwm_input+02H,R6
13A5 8D00        R     MOV     pwm_input+01H,R5
13A7 8C00        R     MOV     pwm_input,R4
13A9         ?C0147:
                                           ; SOURCE LINE # 939
13A9 300011            JNB     dirM0,?C0148
                                           ; SOURCE LINE # 940
13AC 300007            JNB     dirM1,?C0149
                                           ; SOURCE LINE # 941
13AF 7F03              MOV     R7,#03H
13B1 120000      E     LCALL   _MOTOR_DIR_Write
13B4 8016              SJMP    ?C0151
13B6         ?C0149:
                                           ; SOURCE LINE # 943
13B6 7F01              MOV     R7,#01H
13B8 120000      E     LCALL   _MOTOR_DIR_Write
                                           ; SOURCE LINE # 944
13BB 800F              SJMP    ?C0151
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 94  

13BD         ?C0148:
                                           ; SOURCE LINE # 945
                                           ; SOURCE LINE # 946
13BD 300007            JNB     dirM1,?C0152
                                           ; SOURCE LINE # 947
13C0 7F02              MOV     R7,#02H
13C2 120000      E     LCALL   _MOTOR_DIR_Write
13C5 8005              SJMP    ?C0151
13C7         ?C0152:
                                           ; SOURCE LINE # 949
13C7 E4                CLR     A
13C8 FF                MOV     R7,A
13C9 120000      E     LCALL   _MOTOR_DIR_Write
                                           ; SOURCE LINE # 950
13CC         ?C0151:
                                           ; SOURCE LINE # 952
13CC 300005            JNB     interrupt_flag,?C0154
                                           ; SOURCE LINE # 953
13CF C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 954
13D1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 955
13D4         ?C0154:
                                           ; SOURCE LINE # 957
13D4 E500        R     MOV     A,index
13D6 7029              JNZ     ?C0155
                                           ; SOURCE LINE # 958
13D8 FF                MOV     R7,A
13D9 FE                MOV     R6,A
13DA FD                MOV     R5,A
13DB FC                MOV     R4,A
13DC AB00        R     MOV     R3,pwm_input+03H
13DE AA00        R     MOV     R2,pwm_input+02H
13E0 A900        R     MOV     R1,pwm_input+01H
13E2 A800        R     MOV     R0,pwm_input
13E4 C3                CLR     C
13E5 120000      E     LCALL   ?C?SLCMP
13E8 4004              JC      ?C0156
13EA 7F01              MOV     R7,#01H
13EC 8002              SJMP    ?C0157
13EE         ?C0156:
13EE 7FFF              MOV     R7,#0FFH
13F0         ?C0157:
13F0 900000      E     MOV     DPTR,#pwm_sign
13F3 EF                MOV     A,R7
13F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 959
13F5 AE00        R     MOV     R6,pwm_input+02H
13F7 AF00        R     MOV     R7,pwm_input+03H
13F9 120000      E     LCALL   _abs
13FC 120000      E     LCALL   _PWM_MOTORS_WriteCompare1
                                           ; SOURCE LINE # 960
13FF 8028              SJMP    ?C0158
1401         ?C0155:
                                           ; SOURCE LINE # 961
                                           ; SOURCE LINE # 962
1401 E4                CLR     A
1402 FF                MOV     R7,A
1403 FE                MOV     R6,A
1404 FD                MOV     R5,A
1405 FC                MOV     R4,A
1406 AB00        R     MOV     R3,pwm_input+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 95  

1408 AA00        R     MOV     R2,pwm_input+02H
140A A900        R     MOV     R1,pwm_input+01H
140C A800        R     MOV     R0,pwm_input
140E C3                CLR     C
140F 120000      E     LCALL   ?C?SLCMP
1412 4004              JC      ?C0159
1414 7F01              MOV     R7,#01H
1416 8002              SJMP    ?C0160
1418         ?C0159:
1418 7FFF              MOV     R7,#0FFH
141A         ?C0160:
141A 900000      E     MOV     DPTR,#pwm_sign+01H
141D EF                MOV     A,R7
141E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 963
141F AE00        R     MOV     R6,pwm_input+02H
1421 AF00        R     MOV     R7,pwm_input+03H
1423 120000      E     LCALL   _abs
1426 120000      E     LCALL   _PWM_MOTORS_WriteCompare2
                                           ; SOURCE LINE # 964
1429         ?C0158:
                                           ; SOURCE LINE # 966
1429 300005            JNB     interrupt_flag,?C0042
                                           ; SOURCE LINE # 967
142C C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 968
142E 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 969
                                           ; SOURCE LINE # 970
1431         ?C0042:
1431 22                RET     
             ; FUNCTION _motor_control (END)

             ; FUNCTION analog_read_end (BEGIN)
                                           ; SOURCE LINE # 976
0000         ?C0162:
                                           ; SOURCE LINE # 1014
0000 120000      E     LCALL   ADC_STATUS_Read
0003 EF                MOV     A,R7
0004 700A              JNZ     ?C0163
                                           ; SOURCE LINE # 1015
0006 3000F7            JNB     interrupt_flag,?C0162
                                           ; SOURCE LINE # 1016
0009 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1017
000B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1018
                                           ; SOURCE LINE # 1019
000E 80F0              SJMP    ?C0162
0010         ?C0163:
                                           ; SOURCE LINE # 1022
0010 900000      E     MOV     DPTR,#ADC_buf+01H
0013 E0                MOVX    A,@DPTR
0014 249A              ADD     A,#09AH
0016 FF                MOV     R7,A
0017 900000      E     MOV     DPTR,#ADC_buf
001A E0                MOVX    A,@DPTR
001B 34F9              ADDC    A,#0F9H
001D FE                MOV     R6,A
001E 33                RLC     A
001F 95E0              SUBB    A,ACC
0021 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 96  

0022 FC                MOV     R4,A
0023 E4                CLR     A
0024 7BA0              MOV     R3,#0A0H
0026 7A07              MOV     R2,#07H
0028 F9                MOV     R1,A
0029 F8                MOV     R0,A
002A 120000      E     LCALL   ?C?LMUL
002D 7807              MOV     R0,#07H
002F 120000      E     LCALL   ?C?SLSHR
0032 900000      E     MOV     DPTR,#dev_tension
0035 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1024
0038 300005            JNB     interrupt_flag,?C0165
                                           ; SOURCE LINE # 1025
003B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1026
003D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1027
0040         ?C0165:
                                           ; SOURCE LINE # 1031
0040 E4                CLR     A
0041 FF                MOV     R7,A
0042 FE                MOV     R6,A
0043 FD                MOV     R5,A
0044 FC                MOV     R4,A
0045 900000      E     MOV     DPTR,#dev_tension
0048 E0                MOVX    A,@DPTR
0049 F8                MOV     R0,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C F9                MOV     R1,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FA                MOV     R2,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FB                MOV     R3,A
0053 D3                SETB    C
0054 120000      E     LCALL   ?C?SLCMP
0057 5003              JNC     $ + 5H
0059 020000      R     LJMP    ?C0166
                                           ; SOURCE LINE # 1034
005C 120000      R     LCALL   pwm_limit_search
                                           ; SOURCE LINE # 1038
005F 300005            JNB     interrupt_flag,?C0167
                                           ; SOURCE LINE # 1039
0062 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1040
0064 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1041
0067         ?C0167:
                                           ; SOURCE LINE # 1044
0067 900000      E     MOV     DPTR,#ADC_buf+03H
006A E0                MOVX    A,@DPTR
006B 249A              ADD     A,#09AH
006D FF                MOV     R7,A
006E 900000      E     MOV     DPTR,#ADC_buf+02H
0071 E0                MOVX    A,@DPTR
0072 34F9              ADDC    A,#0F9H
0074 FE                MOV     R6,A
0075 33                RLC     A
0076 95E0              SUBB    A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 97  

0078 FD                MOV     R5,A
0079 FC                MOV     R4,A
007A E4                CLR     A
007B 7BAB              MOV     R3,#0ABH
007D 7A64              MOV     R2,#064H
007F F9                MOV     R1,A
0080 F8                MOV     R0,A
0081 120000      E     LCALL   ?C?LMUL
0084 780D              MOV     R0,#0DH
0086 120000      E     LCALL   ?C?SLSHR
0089 A804              MOV     R0,AR4
008B A905              MOV     R1,AR5
008D AA06              MOV     R2,AR6
008F AB07              MOV     R3,AR7
0091 900000      E     MOV     DPTR,#pwm_sign
0094 E0                MOVX    A,@DPTR
0095 FF                MOV     R7,A
0096 33                RLC     A
0097 95E0              SUBB    A,ACC
0099 FE                MOV     R6,A
009A FD                MOV     R5,A
009B FC                MOV     R4,A
009C 120000      E     LCALL   ?C?LMUL
009F 120000      E     LCALL   _filter_i1
00A2 900000      E     MOV     DPTR,#g_meas+08H
00A5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1048
00A8 300005            JNB     interrupt_flag,?C0168
                                           ; SOURCE LINE # 1049
00AB C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1050
00AD 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1051
00B0         ?C0168:
                                           ; SOURCE LINE # 1052
00B0 900000      E     MOV     DPTR,#ADC_buf+05H
00B3 E0                MOVX    A,@DPTR
00B4 249A              ADD     A,#09AH
00B6 FF                MOV     R7,A
00B7 900000      E     MOV     DPTR,#ADC_buf+04H
00BA E0                MOVX    A,@DPTR
00BB 34F9              ADDC    A,#0F9H
00BD FE                MOV     R6,A
00BE 33                RLC     A
00BF 95E0              SUBB    A,ACC
00C1 FD                MOV     R5,A
00C2 FC                MOV     R4,A
00C3 E4                CLR     A
00C4 7BAB              MOV     R3,#0ABH
00C6 7A64              MOV     R2,#064H
00C8 F9                MOV     R1,A
00C9 F8                MOV     R0,A
00CA 120000      E     LCALL   ?C?LMUL
00CD 780D              MOV     R0,#0DH
00CF 120000      E     LCALL   ?C?SLSHR
00D2 A804              MOV     R0,AR4
00D4 A905              MOV     R1,AR5
00D6 AA06              MOV     R2,AR6
00D8 AB07              MOV     R3,AR7
00DA 900000      E     MOV     DPTR,#pwm_sign+01H
00DD E0                MOVX    A,@DPTR
00DE FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 98  

00DF 33                RLC     A
00E0 95E0              SUBB    A,ACC
00E2 FE                MOV     R6,A
00E3 FD                MOV     R5,A
00E4 FC                MOV     R4,A
00E5 120000      E     LCALL   ?C?LMUL
00E8 120000      E     LCALL   _filter_i2
00EB 900000      E     MOV     DPTR,#g_meas+0CH
00EE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1056
00F1 300005            JNB     interrupt_flag,?C0169
                                           ; SOURCE LINE # 1057
00F4 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1058
00F6 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1059
00F9         ?C0169:
                                           ; SOURCE LINE # 1061
00F9 900000      E     MOV     DPTR,#g_mem+07AH
00FC E0                MOVX    A,@DPTR
00FD 7004              JNZ     ?C0170
                                           ; SOURCE LINE # 1062
00FF F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1063
0101 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1064
0103         ?C0170:
                                           ; SOURCE LINE # 1069
0103 E500        R     MOV     A,emg_1_status
0105 14                DEC     A
0106 7003              JNZ     $ + 5H
0108 020000      R     LJMP    ?C0178
010B 14                DEC     A
010C 7003              JNZ     $ + 5H
010E 020000      R     LJMP    ?C0179
0111 14                DEC     A
0112 7003              JNZ     $ + 5H
0114 020000      R     LJMP    ?C0182
0117 2403              ADD     A,#03H
0119 6003              JZ      $ + 5H
011B 020000      R     LJMP    ?C0171
                                           ; SOURCE LINE # 1070
011E         ?C0172:
                                           ; SOURCE LINE # 1071
011E 900000      E     MOV     DPTR,#ADC_buf+06H
0121 E0                MOVX    A,@DPTR
0122 FE                MOV     R6,A
0123 A3                INC     DPTR
0124 E0                MOVX    A,@DPTR
0125 FF                MOV     R7,A
0126 EE                MOV     A,R6
0127 33                RLC     A
0128 95E0              SUBB    A,ACC
012A FD                MOV     R5,A
012B FC                MOV     R4,A
012C 120000      E     LCALL   _filter_ch1
012F 8E00        R     MOV     i_aux,R6
0131 8F00        R     MOV     i_aux+01H,R7
                                           ; SOURCE LINE # 1072
0133 E500        R     MOV     A,i_aux+01H
0135 7F00              MOV     R7,#00H
0137 25E0              ADD     A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 99  

0139 25E0              ADD     A,ACC
013B FE                MOV     R6,A
013C 33                RLC     A
013D 95E0              SUBB    A,ACC
013F FD                MOV     R5,A
0140 FC                MOV     R4,A
0141 900000      E     MOV     DPTR,#g_mem+07BH
0144 E0                MOVX    A,@DPTR
0145 F8                MOV     R0,A
0146 A3                INC     DPTR
0147 E0                MOVX    A,@DPTR
0148 F9                MOV     R1,A
0149 A3                INC     DPTR
014A E0                MOVX    A,@DPTR
014B FA                MOV     R2,A
014C A3                INC     DPTR
014D E0                MOVX    A,@DPTR
014E FB                MOV     R3,A
014F 120000      E     LCALL   ?C?ULDIV
0152 8E00        R     MOV     i_aux,R6
0154 8F00        R     MOV     i_aux+01H,R7
                                           ; SOURCE LINE # 1074
0156 300005            JNB     interrupt_flag,?C0173
                                           ; SOURCE LINE # 1075
0159 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1076
015B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1077
015E         ?C0173:
                                           ; SOURCE LINE # 1079
015E C3                CLR     C
015F E500        R     MOV     A,i_aux
0161 6480              XRL     A,#080H
0163 9480              SUBB    A,#080H
0165 5007              JNC     ?C0174
                                           ; SOURCE LINE # 1080
0167 E4                CLR     A
0168 F500        R     MOV     i_aux,A
016A F500        R     MOV     i_aux+01H,A
016C 8013              SJMP    ?C0175
016E         ?C0174:
                                           ; SOURCE LINE # 1082
016E D3                SETB    C
016F E500        R     MOV     A,i_aux+01H
0171 9400              SUBB    A,#00H
0173 E500        R     MOV     A,i_aux
0175 6480              XRL     A,#080H
0177 9484              SUBB    A,#084H
0179 4006              JC      ?C0175
                                           ; SOURCE LINE # 1083
017B 750004      R     MOV     i_aux,#04H
017E 750000      R     MOV     i_aux+01H,#00H
0181         ?C0175:
                                           ; SOURCE LINE # 1085
0181 AE00        R     MOV     R6,i_aux
0183 AF00        R     MOV     R7,i_aux+01H
0185 EE                MOV     A,R6
0186 33                RLC     A
0187 95E0              SUBB    A,ACC
0189 FD                MOV     R5,A
018A FC                MOV     R4,A
018B 900000      E     MOV     DPTR,#g_meas+028H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 100 

018E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1087
0191 200003      E     JB      interrupt_flag,$ + 6H
0194 020000      R     LJMP    ?C0171
                                           ; SOURCE LINE # 1088
0197 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1089
0199 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1090
                                           ; SOURCE LINE # 1092
019C 020000      R     LJMP    ?C0171
                                           ; SOURCE LINE # 1094
019F         ?C0178:
                                           ; SOURCE LINE # 1095
019F E4                CLR     A
01A0 900000      R     MOV     DPTR,#emg_counter_1
01A3 F0                MOVX    @DPTR,A
01A4 A3                INC     DPTR
01A5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1096
01A6 FF                MOV     R7,A
01A7 FE                MOV     R6,A
01A8 FD                MOV     R5,A
01A9 FC                MOV     R4,A
01AA 900000      E     MOV     DPTR,#g_mem+07BH
01AD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1097
01B0 750002      R     MOV     emg_1_status,#02H
                                           ; SOURCE LINE # 1099
01B3 020000      R     LJMP    ?C0171
                                           ; SOURCE LINE # 1101
01B6         ?C0179:
                                           ; SOURCE LINE # 1102
01B6 900000      R     MOV     DPTR,#emg_counter_1+01H
01B9 E0                MOVX    A,@DPTR
01BA 04                INC     A
01BB F0                MOVX    @DPTR,A
01BC 7006              JNZ     ?C0277
01BE 900000      R     MOV     DPTR,#emg_counter_1
01C1 E0                MOVX    A,@DPTR
01C2 04                INC     A
01C3 F0                MOVX    @DPTR,A
01C4         ?C0277:
                                           ; SOURCE LINE # 1103
01C4 900000      R     MOV     DPTR,#emg_counter_1
01C7 E0                MOVX    A,@DPTR
01C8 6401              XRL     A,#01H
01CA 7004              JNZ     ?C0278
01CC A3                INC     DPTR
01CD E0                MOVX    A,@DPTR
01CE 64F4              XRL     A,#0F4H
01D0         ?C0278:
01D0 6003              JZ      $ + 5H
01D2 020000      R     LJMP    ?C0171
                                           ; SOURCE LINE # 1104
01D5 900000      R     MOV     DPTR,#emg_counter_1
01D8 F0                MOVX    @DPTR,A
01D9 A3                INC     DPTR
01DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1105
01DB 7F01              MOV     R7,#01H
01DD 120000      E     LCALL   _LED_REG_Write
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 101 

                                           ; SOURCE LINE # 1107
01E0 300005            JNB     interrupt_flag,?C0181
                                           ; SOURCE LINE # 1108
01E3 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1109
01E5 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1110
01E8         ?C0181:
                                           ; SOURCE LINE # 1112
01E8 750003      R     MOV     emg_1_status,#03H
                                           ; SOURCE LINE # 1113
                                           ; SOURCE LINE # 1114
01EB 020000      R     LJMP    ?C0171
                                           ; SOURCE LINE # 1116
01EE         ?C0182:
                                           ; SOURCE LINE # 1118
01EE 900000      R     MOV     DPTR,#emg_counter_1+01H
01F1 E0                MOVX    A,@DPTR
01F2 04                INC     A
01F3 F0                MOVX    @DPTR,A
01F4 7006              JNZ     ?C0279
01F6 900000      R     MOV     DPTR,#emg_counter_1
01F9 E0                MOVX    A,@DPTR
01FA 04                INC     A
01FB F0                MOVX    @DPTR,A
01FC         ?C0279:
                                           ; SOURCE LINE # 1119
01FC 900000      E     MOV     DPTR,#g_mem+07BH
01FF E0                MOVX    A,@DPTR
0200 F8                MOV     R0,A
0201 A3                INC     DPTR
0202 E0                MOVX    A,@DPTR
0203 F9                MOV     R1,A
0204 A3                INC     DPTR
0205 E0                MOVX    A,@DPTR
0206 FA                MOV     R2,A
0207 A3                INC     DPTR
0208 E0                MOVX    A,@DPTR
0209 FB                MOV     R3,A
020A C000              PUSH    AR0
020C C001              PUSH    AR1
020E C002              PUSH    AR2
0210 C003              PUSH    AR3
0212 900000      E     MOV     DPTR,#ADC_buf+06H
0215 E0                MOVX    A,@DPTR
0216 FE                MOV     R6,A
0217 A3                INC     DPTR
0218 E0                MOVX    A,@DPTR
0219 FF                MOV     R7,A
021A EE                MOV     A,R6
021B 33                RLC     A
021C 95E0              SUBB    A,ACC
021E FD                MOV     R5,A
021F FC                MOV     R4,A
0220 120000      E     LCALL   _filter_ch1
0223 D003              POP     AR3
0225 D002              POP     AR2
0227 D001              POP     AR1
0229 D000              POP     AR0
022B EB                MOV     A,R3
022C 2F                ADD     A,R7
022D FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 102 

022E EA                MOV     A,R2
022F 3E                ADDC    A,R6
0230 FE                MOV     R6,A
0231 E9                MOV     A,R1
0232 3D                ADDC    A,R5
0233 FD                MOV     R5,A
0234 E8                MOV     A,R0
0235 3C                ADDC    A,R4
0236 FC                MOV     R4,A
0237 900000      E     MOV     DPTR,#g_mem+07BH
023A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1121
023D 300005            JNB     interrupt_flag,?C0183
                                           ; SOURCE LINE # 1122
0240 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1123
0242 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1124
0245         ?C0183:
                                           ; SOURCE LINE # 1126
0245 900000      R     MOV     DPTR,#emg_counter_1
0248 E0                MOVX    A,@DPTR
0249 B40339            CJNE    A,#03H,?C0171
024C A3                INC     DPTR
024D E0                MOVX    A,@DPTR
024E B4E834            CJNE    A,#0E8H,?C0171
                                           ; SOURCE LINE # 1127
0251 900000      E     MOV     DPTR,#g_mem+07BH
0254 E0                MOVX    A,@DPTR
0255 FC                MOV     R4,A
0256 A3                INC     DPTR
0257 E0                MOVX    A,@DPTR
0258 FD                MOV     R5,A
0259 A3                INC     DPTR
025A E0                MOVX    A,@DPTR
025B FE                MOV     R6,A
025C A3                INC     DPTR
025D E0                MOVX    A,@DPTR
025E FF                MOV     R7,A
025F E4                CLR     A
0260 7BE8              MOV     R3,#0E8H
0262 7A03              MOV     R2,#03H
0264 F9                MOV     R1,A
0265 F8                MOV     R0,A
0266 120000      E     LCALL   ?C?ULDIV
0269 900000      E     MOV     DPTR,#g_mem+07BH
026C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1129
026F 300005            JNB     interrupt_flag,?C0185
                                           ; SOURCE LINE # 1130
0272 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1131
0274 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1132
0277         ?C0185:
                                           ; SOURCE LINE # 1134
0277 E4                CLR     A
0278 FF                MOV     R7,A
0279 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1135
027C E4                CLR     A
027D 900000      R     MOV     DPTR,#emg_counter_1
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 103 

0280 F0                MOVX    @DPTR,A
0281 A3                INC     DPTR
0282 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1137
0283 F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1138
                                           ; SOURCE LINE # 1139
                                           ; SOURCE LINE # 1141
                                           ; SOURCE LINE # 1142
                                           ; SOURCE LINE # 1143
0285         ?C0171:
                                           ; SOURCE LINE # 1145
0285 300005            JNB     interrupt_flag,?C0187
                                           ; SOURCE LINE # 1146
0288 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1147
028A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1148
028D         ?C0187:
                                           ; SOURCE LINE # 1150
028D E500        R     MOV     A,emg_2_status
028F 14                DEC     A
0290 7003              JNZ     $ + 5H
0292 020000      R     LJMP    ?C0194
0295 14                DEC     A
0296 7003              JNZ     $ + 5H
0298 020000      R     LJMP    ?C0196
029B 14                DEC     A
029C 7003              JNZ     $ + 5H
029E 020000      R     LJMP    ?C0199
02A1 14                DEC     A
02A2 7003              JNZ     $ + 5H
02A4 020000      R     LJMP    ?C0206
02A7 2404              ADD     A,#04H
02A9 6003              JZ      $ + 5H
02AB 020000      R     LJMP    ?C0188
                                           ; SOURCE LINE # 1151
02AE         ?C0189:
                                           ; SOURCE LINE # 1152
02AE 900000      E     MOV     DPTR,#ADC_buf+08H
02B1 E0                MOVX    A,@DPTR
02B2 FE                MOV     R6,A
02B3 A3                INC     DPTR
02B4 E0                MOVX    A,@DPTR
02B5 FF                MOV     R7,A
02B6 EE                MOV     A,R6
02B7 33                RLC     A
02B8 95E0              SUBB    A,ACC
02BA FD                MOV     R5,A
02BB FC                MOV     R4,A
02BC 120000      E     LCALL   _filter_ch2
02BF 8E00        R     MOV     i_aux,R6
02C1 8F00        R     MOV     i_aux+01H,R7
                                           ; SOURCE LINE # 1153
02C3 E500        R     MOV     A,i_aux+01H
02C5 7F00              MOV     R7,#00H
02C7 25E0              ADD     A,ACC
02C9 25E0              ADD     A,ACC
02CB FE                MOV     R6,A
02CC 33                RLC     A
02CD 95E0              SUBB    A,ACC
02CF FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 104 

02D0 FC                MOV     R4,A
02D1 900000      E     MOV     DPTR,#g_mem+07FH
02D4 E0                MOVX    A,@DPTR
02D5 F8                MOV     R0,A
02D6 A3                INC     DPTR
02D7 E0                MOVX    A,@DPTR
02D8 F9                MOV     R1,A
02D9 A3                INC     DPTR
02DA E0                MOVX    A,@DPTR
02DB FA                MOV     R2,A
02DC A3                INC     DPTR
02DD E0                MOVX    A,@DPTR
02DE FB                MOV     R3,A
02DF 120000      E     LCALL   ?C?ULDIV
02E2 8E00        R     MOV     i_aux,R6
02E4 8F00        R     MOV     i_aux+01H,R7
                                           ; SOURCE LINE # 1155
02E6 300005            JNB     interrupt_flag,?C0190
                                           ; SOURCE LINE # 1156
02E9 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1157
02EB 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1158
02EE         ?C0190:
                                           ; SOURCE LINE # 1160
02EE C3                CLR     C
02EF E500        R     MOV     A,i_aux
02F1 6480              XRL     A,#080H
02F3 9480              SUBB    A,#080H
02F5 5007              JNC     ?C0191
                                           ; SOURCE LINE # 1161
02F7 E4                CLR     A
02F8 F500        R     MOV     i_aux,A
02FA F500        R     MOV     i_aux+01H,A
02FC 8013              SJMP    ?C0192
02FE         ?C0191:
                                           ; SOURCE LINE # 1163
02FE D3                SETB    C
02FF E500        R     MOV     A,i_aux+01H
0301 9400              SUBB    A,#00H
0303 E500        R     MOV     A,i_aux
0305 6480              XRL     A,#080H
0307 9484              SUBB    A,#084H
0309 4006              JC      ?C0192
                                           ; SOURCE LINE # 1164
030B 750004      R     MOV     i_aux,#04H
030E 750000      R     MOV     i_aux+01H,#00H
0311         ?C0192:
                                           ; SOURCE LINE # 1166
0311 AE00        R     MOV     R6,i_aux
0313 AF00        R     MOV     R7,i_aux+01H
0315 EE                MOV     A,R6
0316 33                RLC     A
0317 95E0              SUBB    A,ACC
0319 FD                MOV     R5,A
031A FC                MOV     R4,A
031B 900000      E     MOV     DPTR,#g_meas+02CH
031E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1168
0321 020000      R     LJMP    ?C0188
                                           ; SOURCE LINE # 1170
0324         ?C0194:
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 105 

                                           ; SOURCE LINE # 1171
0324 E4                CLR     A
0325 900000      R     MOV     DPTR,#emg_counter_2
0328 F0                MOVX    @DPTR,A
0329 A3                INC     DPTR
032A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1172
032B FF                MOV     R7,A
032C FE                MOV     R6,A
032D FD                MOV     R5,A
032E FC                MOV     R4,A
032F 900000      E     MOV     DPTR,#g_mem+07FH
0332 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1174
0335 300005            JNB     interrupt_flag,?C0195
                                           ; SOURCE LINE # 1175
0338 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1176
033A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1177
033D         ?C0195:
                                           ; SOURCE LINE # 1179
033D 750004      R     MOV     emg_2_status,#04H
                                           ; SOURCE LINE # 1180
0340 020000      R     LJMP    ?C0188
                                           ; SOURCE LINE # 1182
0343         ?C0196:
                                           ; SOURCE LINE # 1183
0343 900000      R     MOV     DPTR,#emg_counter_2+01H
0346 E0                MOVX    A,@DPTR
0347 04                INC     A
0348 F0                MOVX    @DPTR,A
0349 7006              JNZ     ?C0281
034B 900000      R     MOV     DPTR,#emg_counter_2
034E E0                MOVX    A,@DPTR
034F 04                INC     A
0350 F0                MOVX    @DPTR,A
0351         ?C0281:
                                           ; SOURCE LINE # 1184
0351 900000      R     MOV     DPTR,#emg_counter_2
0354 E0                MOVX    A,@DPTR
0355 6401              XRL     A,#01H
0357 7004              JNZ     ?C0282
0359 A3                INC     DPTR
035A E0                MOVX    A,@DPTR
035B 64F4              XRL     A,#0F4H
035D         ?C0282:
035D 6003              JZ      $ + 5H
035F 020000      R     LJMP    ?C0188
                                           ; SOURCE LINE # 1185
0362 900000      R     MOV     DPTR,#emg_counter_2
0365 F0                MOVX    @DPTR,A
0366 A3                INC     DPTR
0367 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1186
0368 7F01              MOV     R7,#01H
036A 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1188
036D 300005            JNB     interrupt_flag,?C0198
                                           ; SOURCE LINE # 1189
0370 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1190
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 106 

0372 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1191
0375         ?C0198:
                                           ; SOURCE LINE # 1193
0375 750003      R     MOV     emg_2_status,#03H
                                           ; SOURCE LINE # 1194
                                           ; SOURCE LINE # 1195
0378 020000      R     LJMP    ?C0188
                                           ; SOURCE LINE # 1197
037B         ?C0199:
                                           ; SOURCE LINE # 1199
037B 900000      R     MOV     DPTR,#emg_counter_2+01H
037E E0                MOVX    A,@DPTR
037F 04                INC     A
0380 F0                MOVX    @DPTR,A
0381 7006              JNZ     ?C0283
0383 900000      R     MOV     DPTR,#emg_counter_2
0386 E0                MOVX    A,@DPTR
0387 04                INC     A
0388 F0                MOVX    @DPTR,A
0389         ?C0283:
                                           ; SOURCE LINE # 1200
0389 900000      E     MOV     DPTR,#g_mem+07FH
038C E0                MOVX    A,@DPTR
038D F8                MOV     R0,A
038E A3                INC     DPTR
038F E0                MOVX    A,@DPTR
0390 F9                MOV     R1,A
0391 A3                INC     DPTR
0392 E0                MOVX    A,@DPTR
0393 FA                MOV     R2,A
0394 A3                INC     DPTR
0395 E0                MOVX    A,@DPTR
0396 FB                MOV     R3,A
0397 C000              PUSH    AR0
0399 C001              PUSH    AR1
039B C002              PUSH    AR2
039D C003              PUSH    AR3
039F 900000      E     MOV     DPTR,#ADC_buf+08H
03A2 E0                MOVX    A,@DPTR
03A3 FE                MOV     R6,A
03A4 A3                INC     DPTR
03A5 E0                MOVX    A,@DPTR
03A6 FF                MOV     R7,A
03A7 EE                MOV     A,R6
03A8 33                RLC     A
03A9 95E0              SUBB    A,ACC
03AB FD                MOV     R5,A
03AC FC                MOV     R4,A
03AD 120000      E     LCALL   _filter_ch2
03B0 D003              POP     AR3
03B2 D002              POP     AR2
03B4 D001              POP     AR1
03B6 D000              POP     AR0
03B8 EB                MOV     A,R3
03B9 2F                ADD     A,R7
03BA FF                MOV     R7,A
03BB EA                MOV     A,R2
03BC 3E                ADDC    A,R6
03BD FE                MOV     R6,A
03BE E9                MOV     A,R1
03BF 3D                ADDC    A,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 107 

03C0 FD                MOV     R5,A
03C1 E8                MOV     A,R0
03C2 3C                ADDC    A,R4
03C3 FC                MOV     R4,A
03C4 900000      E     MOV     DPTR,#g_mem+07FH
03C7 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1202
03CA 300005            JNB     interrupt_flag,?C0200
                                           ; SOURCE LINE # 1203
03CD C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1204
03CF 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1205
03D2         ?C0200:
                                           ; SOURCE LINE # 1207
03D2 900000      R     MOV     DPTR,#emg_counter_2
03D5 E0                MOVX    A,@DPTR
03D6 6403              XRL     A,#03H
03D8 7004              JNZ     ?C0284
03DA A3                INC     DPTR
03DB E0                MOVX    A,@DPTR
03DC 64E8              XRL     A,#0E8H
03DE         ?C0284:
03DE 6003              JZ      $ + 5H
03E0 020000      R     LJMP    ?C0188
                                           ; SOURCE LINE # 1208
03E3 900000      E     MOV     DPTR,#g_mem+07FH
03E6 E0                MOVX    A,@DPTR
03E7 FC                MOV     R4,A
03E8 A3                INC     DPTR
03E9 E0                MOVX    A,@DPTR
03EA FD                MOV     R5,A
03EB A3                INC     DPTR
03EC E0                MOVX    A,@DPTR
03ED FE                MOV     R6,A
03EE A3                INC     DPTR
03EF E0                MOVX    A,@DPTR
03F0 FF                MOV     R7,A
03F1 E4                CLR     A
03F2 7BE8              MOV     R3,#0E8H
03F4 7A03              MOV     R2,#03H
03F6 F9                MOV     R1,A
03F7 F8                MOV     R0,A
03F8 120000      E     LCALL   ?C?ULDIV
03FB 900000      E     MOV     DPTR,#g_mem+07FH
03FE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1209
0401 E4                CLR     A
0402 FF                MOV     R7,A
0403 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1210
0406 E4                CLR     A
0407 900000      R     MOV     DPTR,#emg_counter_2
040A F0                MOVX    @DPTR,A
040B A3                INC     DPTR
040C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1212
040D 300005            JNB     interrupt_flag,?C0202
                                           ; SOURCE LINE # 1213
0410 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1214
0412 120000      R     LCALL   interrupt_manager
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 108 

                                           ; SOURCE LINE # 1215
0415         ?C0202:
                                           ; SOURCE LINE # 1218
0415 900000      E     MOV     DPTR,#c_mem+035H
0418 E0                MOVX    A,@DPTR
0419 FF                MOV     R7,A
041A 6402              XRL     A,#02H
041C 600E              JZ      ?C0204
041E EF                MOV     A,R7
041F 6403              XRL     A,#03H
0421 6009              JZ      ?C0204
0423 EF                MOV     A,R7
0424 6404              XRL     A,#04H
0426 6004              JZ      ?C0204
0428 EF                MOV     A,R7
0429 B4053A            CJNE    A,#05H,?C0203
042C         ?C0204:
                                           ; SOURCE LINE # 1221
                                           ; SOURCE LINE # 1222
042C 900000      E     MOV     DPTR,#c_mem+036H
042F E0                MOVX    A,@DPTR
0430 7028              JNZ     ?C0205
                                           ; SOURCE LINE # 1223
0432 900000      E     MOV     DPTR,#g_meas+010H
0435 E0                MOVX    A,@DPTR
0436 FC                MOV     R4,A
0437 A3                INC     DPTR
0438 E0                MOVX    A,@DPTR
0439 FD                MOV     R5,A
043A A3                INC     DPTR
043B E0                MOVX    A,@DPTR
043C FE                MOV     R6,A
043D A3                INC     DPTR
043E E0                MOVX    A,@DPTR
043F FF                MOV     R7,A
0440 900000      E     MOV     DPTR,#g_ref
0443 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1224
0446 900000      E     MOV     DPTR,#g_meas+014H
0449 E0                MOVX    A,@DPTR
044A FC                MOV     R4,A
044B A3                INC     DPTR
044C E0                MOVX    A,@DPTR
044D FD                MOV     R5,A
044E A3                INC     DPTR
044F E0                MOVX    A,@DPTR
0450 FE                MOV     R6,A
0451 A3                INC     DPTR
0452 E0                MOVX    A,@DPTR
0453 FF                MOV     R7,A
0454 900000      E     MOV     DPTR,#g_ref+04H
0457 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1225
045A         ?C0205:
                                           ; SOURCE LINE # 1226
045A 900000      E     MOV     DPTR,#c_mem+034H
045D E0                MOVX    A,@DPTR
045E FF                MOV     R7,A
045F 900000      E     MOV     DPTR,#g_ref+08H
0462 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1227
0463 120000      E     LCALL   _MOTOR_ON_OFF_Write
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 109 

                                           ; SOURCE LINE # 1228
0466         ?C0203:
                                           ; SOURCE LINE # 1229
0466 E4                CLR     A
0467 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1230
                                           ; SOURCE LINE # 1231
0469 8007              SJMP    ?C0188
                                           ; SOURCE LINE # 1233
046B         ?C0206:
                                           ; SOURCE LINE # 1234
046B E500        R     MOV     A,emg_1_status
046D 7003              JNZ     ?C0188
                                           ; SOURCE LINE # 1235
046F 750002      R     MOV     emg_2_status,#02H
                                           ; SOURCE LINE # 1236
                                           ; SOURCE LINE # 1238
                                           ; SOURCE LINE # 1239
                                           ; SOURCE LINE # 1240
0472         ?C0188:
                                           ; SOURCE LINE # 1242
0472 300005            JNB     interrupt_flag,?C0209
                                           ; SOURCE LINE # 1243
0475 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1244
0477 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1245
047A         ?C0209:
                                           ; SOURCE LINE # 1247
047A E500        R     MOV     A,UD_status
047C 14                DEC     A
047D 7003              JNZ     $ + 5H
047F 020000      R     LJMP    ?C0216
0482 14                DEC     A
0483 7003              JNZ     $ + 5H
0485 020000      R     LJMP    ?C0217
0488 14                DEC     A
0489 7003              JNZ     $ + 5H
048B 020000      R     LJMP    ?C0220
048E 14                DEC     A
048F 7003              JNZ     $ + 5H
0491 020000      R     LJMP    ?C0224
0494 2404              ADD     A,#04H
0496 6003              JZ      $ + 5H
0498 020000      R     LJMP    ?C0210
                                           ; SOURCE LINE # 1248
049B         ?C0211:
                                           ; SOURCE LINE # 1249
049B 900000      E     MOV     DPTR,#ADC_buf+0AH
049E E0                MOVX    A,@DPTR
049F F500        R     MOV     i_aux,A
04A1 A3                INC     DPTR
04A2 E0                MOVX    A,@DPTR
04A3 F500        R     MOV     i_aux+01H,A
                                           ; SOURCE LINE # 1251
04A5 AE00        R     MOV     R6,i_aux
04A7 EE                MOV     A,R6
04A8 33                RLC     A
04A9 95E0              SUBB    A,ACC
04AB FD                MOV     R5,A
04AC FC                MOV     R4,A
04AD 900000      R     MOV     DPTR,#UD_mean_value
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 110 

04B0 E0                MOVX    A,@DPTR
04B1 F8                MOV     R0,A
04B2 A3                INC     DPTR
04B3 E0                MOVX    A,@DPTR
04B4 F9                MOV     R1,A
04B5 A3                INC     DPTR
04B6 E0                MOVX    A,@DPTR
04B7 FA                MOV     R2,A
04B8 A3                INC     DPTR
04B9 E0                MOVX    A,@DPTR
04BA FB                MOV     R3,A
04BB C3                CLR     C
04BC E500        R     MOV     A,i_aux+01H
04BE 9B                SUBB    A,R3
04BF FF                MOV     R7,A
04C0 EE                MOV     A,R6
04C1 9A                SUBB    A,R2
04C2 FE                MOV     R6,A
04C3 ED                MOV     A,R5
04C4 99                SUBB    A,R1
04C5 FD                MOV     R5,A
04C6 EC                MOV     A,R4
04C7 98                SUBB    A,R0
04C8 FC                MOV     R4,A
04C9 120000      E     LCALL   ?C?FCASTL
04CC C004              PUSH    AR4
04CE C005              PUSH    AR5
04D0 C006              PUSH    AR6
04D2 C007              PUSH    AR7
04D4 900000      R     MOV     DPTR,#UD_mean_value
04D7 E0                MOVX    A,@DPTR
04D8 FC                MOV     R4,A
04D9 A3                INC     DPTR
04DA E0                MOVX    A,@DPTR
04DB FD                MOV     R5,A
04DC A3                INC     DPTR
04DD E0                MOVX    A,@DPTR
04DE FE                MOV     R6,A
04DF A3                INC     DPTR
04E0 E0                MOVX    A,@DPTR
04E1 FF                MOV     R7,A
04E2 EC                MOV     A,R4
04E3 120000      E     LCALL   ?C?FCASTL
04E6 A804              MOV     R0,AR4
04E8 A905              MOV     R1,AR5
04EA AA06              MOV     R2,AR6
04EC AB07              MOV     R3,AR7
04EE D007              POP     AR7
04F0 D006              POP     AR6
04F2 D005              POP     AR5
04F4 D004              POP     AR4
04F6 120000      E     LCALL   ?C?FPDIV
04F9 C004              PUSH    AR4
04FB C005              PUSH    AR5
04FD C006              PUSH    AR6
04FF C007              PUSH    AR7
0501 900000      E     MOV     DPTR,#g_mem+0A5H
0504 E0                MOVX    A,@DPTR
0505 FC                MOV     R4,A
0506 A3                INC     DPTR
0507 E0                MOVX    A,@DPTR
0508 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 111 

0509 E4                CLR     A
050A 120000      E     LCALL   ?C?FCASTI
050D D003              POP     AR3
050F D002              POP     AR2
0511 D001              POP     AR1
0513 D000              POP     AR0
0515 120000      E     LCALL   ?C?FPMUL
0518 120000      E     LCALL   ?C?CASTF
051B 8E00        R     MOV     i_aux,R6
051D 8F00        R     MOV     i_aux+01H,R7
                                           ; SOURCE LINE # 1253
051F 300005            JNB     interrupt_flag,?C0212
                                           ; SOURCE LINE # 1254
0522 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1255
0524 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1256
0527         ?C0212:
                                           ; SOURCE LINE # 1259
0527 C3                CLR     C
0528 E500        R     MOV     A,i_aux
052A 6480              XRL     A,#080H
052C 947C              SUBB    A,#07CH
052E 5006              JNC     ?C0213
                                           ; SOURCE LINE # 1260
0530 7500FC      R     MOV     i_aux,#0FCH
0533 750000      R     MOV     i_aux+01H,#00H
0536         ?C0213:
                                           ; SOURCE LINE # 1261
0536 D3                SETB    C
0537 E500        R     MOV     A,i_aux+01H
0539 9400              SUBB    A,#00H
053B E500        R     MOV     A,i_aux
053D 6480              XRL     A,#080H
053F 9484              SUBB    A,#084H
0541 4006              JC      ?C0214
                                           ; SOURCE LINE # 1262
0543 750004      R     MOV     i_aux,#04H
0546 750000      R     MOV     i_aux+01H,#00H
0549         ?C0214:
                                           ; SOURCE LINE # 1264
0549 900000      E     MOV     DPTR,#g_meas+032H
054C E500        R     MOV     A,i_aux
054E F0                MOVX    @DPTR,A
054F A3                INC     DPTR
0550 E500        R     MOV     A,i_aux+01H
0552 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1266
0553 200003      E     JB      interrupt_flag,$ + 6H
0556 020000      R     LJMP    ?C0210
                                           ; SOURCE LINE # 1267
0559 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1268
055B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1269
                                           ; SOURCE LINE # 1271
055E 020000      R     LJMP    ?C0210
                                           ; SOURCE LINE # 1273
0561         ?C0216:
                                           ; SOURCE LINE # 1274
0561 E4                CLR     A
0562 900000      R     MOV     DPTR,#UD_counter
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 112 

0565 F0                MOVX    @DPTR,A
0566 A3                INC     DPTR
0567 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1275
0568 FF                MOV     R7,A
0569 FE                MOV     R6,A
056A FD                MOV     R5,A
056B FC                MOV     R4,A
056C 900000      R     MOV     DPTR,#UD_mean_value
056F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1276
0572 750004      R     MOV     UD_status,#04H
                                           ; SOURCE LINE # 1278
0575 020000      R     LJMP    ?C0210
                                           ; SOURCE LINE # 1280
0578         ?C0217:
                                           ; SOURCE LINE # 1281
0578 900000      R     MOV     DPTR,#UD_counter+01H
057B E0                MOVX    A,@DPTR
057C 04                INC     A
057D F0                MOVX    @DPTR,A
057E 7006              JNZ     ?C0285
0580 900000      R     MOV     DPTR,#UD_counter
0583 E0                MOVX    A,@DPTR
0584 04                INC     A
0585 F0                MOVX    @DPTR,A
0586         ?C0285:
                                           ; SOURCE LINE # 1282
0586 900000      R     MOV     DPTR,#UD_counter
0589 E0                MOVX    A,@DPTR
058A 7004              JNZ     ?C0286
058C A3                INC     DPTR
058D E0                MOVX    A,@DPTR
058E 6464              XRL     A,#064H
0590         ?C0286:
0590 6003              JZ      $ + 5H
0592 020000      R     LJMP    ?C0210
                                           ; SOURCE LINE # 1283
0595 900000      R     MOV     DPTR,#UD_counter
0598 F0                MOVX    @DPTR,A
0599 A3                INC     DPTR
059A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1285
059B 300005            JNB     interrupt_flag,?C0219
                                           ; SOURCE LINE # 1286
059E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1287
05A0 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1288
05A3         ?C0219:
                                           ; SOURCE LINE # 1290
05A3 750003      R     MOV     UD_status,#03H
                                           ; SOURCE LINE # 1291
                                           ; SOURCE LINE # 1293
05A6 020000      R     LJMP    ?C0210
                                           ; SOURCE LINE # 1295
05A9         ?C0220:
                                           ; SOURCE LINE # 1297
05A9 900000      R     MOV     DPTR,#UD_counter+01H
05AC E0                MOVX    A,@DPTR
05AD 04                INC     A
05AE F0                MOVX    @DPTR,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 113 

05AF 7006              JNZ     ?C0287
05B1 900000      R     MOV     DPTR,#UD_counter
05B4 E0                MOVX    A,@DPTR
05B5 04                INC     A
05B6 F0                MOVX    @DPTR,A
05B7         ?C0287:
                                           ; SOURCE LINE # 1298
05B7 900000      R     MOV     DPTR,#UD_mean_value
05BA E0                MOVX    A,@DPTR
05BB F8                MOV     R0,A
05BC A3                INC     DPTR
05BD E0                MOVX    A,@DPTR
05BE F9                MOV     R1,A
05BF A3                INC     DPTR
05C0 E0                MOVX    A,@DPTR
05C1 FA                MOV     R2,A
05C2 A3                INC     DPTR
05C3 E0                MOVX    A,@DPTR
05C4 FB                MOV     R3,A
05C5 900000      E     MOV     DPTR,#ADC_buf+0AH
05C8 E0                MOVX    A,@DPTR
05C9 FE                MOV     R6,A
05CA A3                INC     DPTR
05CB E0                MOVX    A,@DPTR
05CC FF                MOV     R7,A
05CD EE                MOV     A,R6
05CE 33                RLC     A
05CF 95E0              SUBB    A,ACC
05D1 FD                MOV     R5,A
05D2 FC                MOV     R4,A
05D3 EB                MOV     A,R3
05D4 2F                ADD     A,R7
05D5 FF                MOV     R7,A
05D6 EA                MOV     A,R2
05D7 3E                ADDC    A,R6
05D8 FE                MOV     R6,A
05D9 E9                MOV     A,R1
05DA 3D                ADDC    A,R5
05DB FD                MOV     R5,A
05DC E8                MOV     A,R0
05DD 3C                ADDC    A,R4
05DE FC                MOV     R4,A
05DF 900000      R     MOV     DPTR,#UD_mean_value
05E2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1300
05E5 300005            JNB     interrupt_flag,?C0221
                                           ; SOURCE LINE # 1301
05E8 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1302
05EA 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1303
05ED         ?C0221:
                                           ; SOURCE LINE # 1305
05ED 900000      R     MOV     DPTR,#UD_counter
05F0 E0                MOVX    A,@DPTR
05F1 7004              JNZ     ?C0288
05F3 A3                INC     DPTR
05F4 E0                MOVX    A,@DPTR
05F5 64C8              XRL     A,#0C8H
05F7         ?C0288:
05F7 703B              JNZ     ?C0210
                                           ; SOURCE LINE # 1306
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 114 

05F9 900000      R     MOV     DPTR,#UD_mean_value
05FC E0                MOVX    A,@DPTR
05FD FC                MOV     R4,A
05FE A3                INC     DPTR
05FF E0                MOVX    A,@DPTR
0600 FD                MOV     R5,A
0601 A3                INC     DPTR
0602 E0                MOVX    A,@DPTR
0603 FE                MOV     R6,A
0604 A3                INC     DPTR
0605 E0                MOVX    A,@DPTR
0606 FF                MOV     R7,A
0607 E4                CLR     A
0608 7BC8              MOV     R3,#0C8H
060A FA                MOV     R2,A
060B F9                MOV     R1,A
060C F8                MOV     R0,A
060D 120000      E     LCALL   ?C?SLDIV
0610 900000      R     MOV     DPTR,#UD_mean_value
0613 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1308
0616 300005            JNB     interrupt_flag,?C0223
                                           ; SOURCE LINE # 1309
0619 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1310
061B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1311
061E         ?C0223:
                                           ; SOURCE LINE # 1313
061E E4                CLR     A
061F 900000      R     MOV     DPTR,#UD_counter
0622 F0                MOVX    @DPTR,A
0623 A3                INC     DPTR
0624 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1314
0625 F500        R     MOV     UD_status,A
                                           ; SOURCE LINE # 1315
                                           ; SOURCE LINE # 1316
0627 800B              SJMP    ?C0210
                                           ; SOURCE LINE # 1318
0629         ?C0224:
                                           ; SOURCE LINE # 1319
0629 E500        R     MOV     A,emg_1_status
062B 7007              JNZ     ?C0210
062D E500        R     MOV     A,emg_2_status
062F 7003              JNZ     ?C0210
                                           ; SOURCE LINE # 1320
0631 750002      R     MOV     UD_status,#02H
                                           ; SOURCE LINE # 1321
                                           ; SOURCE LINE # 1322
0634         ?C0210:
                                           ; SOURCE LINE # 1324
0634 E500        R     MOV     A,LR_status
0636 14                DEC     A
0637 7003              JNZ     $ + 5H
0639 020000      R     LJMP    ?C0232
063C 14                DEC     A
063D 7003              JNZ     $ + 5H
063F 020000      R     LJMP    ?C0233
0642 14                DEC     A
0643 7003              JNZ     $ + 5H
0645 020000      R     LJMP    ?C0236
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 115 

0648 14                DEC     A
0649 7003              JNZ     $ + 5H
064B 020000      R     LJMP    ?C0239
064E 2404              ADD     A,#04H
0650 6003              JZ      $ + 5H
0652 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1325
0655         ?C0227:
                                           ; SOURCE LINE # 1326
0655 900000      E     MOV     DPTR,#ADC_buf+0CH
0658 E0                MOVX    A,@DPTR
0659 F500        R     MOV     i_aux,A
065B A3                INC     DPTR
065C E0                MOVX    A,@DPTR
065D F500        R     MOV     i_aux+01H,A
                                           ; SOURCE LINE # 1328
065F AE00        R     MOV     R6,i_aux
0661 EE                MOV     A,R6
0662 33                RLC     A
0663 95E0              SUBB    A,ACC
0665 FD                MOV     R5,A
0666 FC                MOV     R4,A
0667 900000      R     MOV     DPTR,#LR_mean_value
066A E0                MOVX    A,@DPTR
066B F8                MOV     R0,A
066C A3                INC     DPTR
066D E0                MOVX    A,@DPTR
066E F9                MOV     R1,A
066F A3                INC     DPTR
0670 E0                MOVX    A,@DPTR
0671 FA                MOV     R2,A
0672 A3                INC     DPTR
0673 E0                MOVX    A,@DPTR
0674 FB                MOV     R3,A
0675 C3                CLR     C
0676 E500        R     MOV     A,i_aux+01H
0678 9B                SUBB    A,R3
0679 FF                MOV     R7,A
067A EE                MOV     A,R6
067B 9A                SUBB    A,R2
067C FE                MOV     R6,A
067D ED                MOV     A,R5
067E 99                SUBB    A,R1
067F FD                MOV     R5,A
0680 EC                MOV     A,R4
0681 98                SUBB    A,R0
0682 FC                MOV     R4,A
0683 120000      E     LCALL   ?C?FCASTL
0686 C004              PUSH    AR4
0688 C005              PUSH    AR5
068A C006              PUSH    AR6
068C C007              PUSH    AR7
068E 900000      R     MOV     DPTR,#LR_mean_value
0691 E0                MOVX    A,@DPTR
0692 FC                MOV     R4,A
0693 A3                INC     DPTR
0694 E0                MOVX    A,@DPTR
0695 FD                MOV     R5,A
0696 A3                INC     DPTR
0697 E0                MOVX    A,@DPTR
0698 FE                MOV     R6,A
0699 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 116 

069A E0                MOVX    A,@DPTR
069B FF                MOV     R7,A
069C EC                MOV     A,R4
069D 120000      E     LCALL   ?C?FCASTL
06A0 A804              MOV     R0,AR4
06A2 A905              MOV     R1,AR5
06A4 AA06              MOV     R2,AR6
06A6 AB07              MOV     R3,AR7
06A8 D007              POP     AR7
06AA D006              POP     AR6
06AC D005              POP     AR5
06AE D004              POP     AR4
06B0 120000      E     LCALL   ?C?FPDIV
06B3 C004              PUSH    AR4
06B5 C005              PUSH    AR5
06B7 C006              PUSH    AR6
06B9 C007              PUSH    AR7
06BB 900000      E     MOV     DPTR,#g_mem+0A3H
06BE E0                MOVX    A,@DPTR
06BF FC                MOV     R4,A
06C0 A3                INC     DPTR
06C1 E0                MOVX    A,@DPTR
06C2 FD                MOV     R5,A
06C3 E4                CLR     A
06C4 120000      E     LCALL   ?C?FCASTI
06C7 D003              POP     AR3
06C9 D002              POP     AR2
06CB D001              POP     AR1
06CD D000              POP     AR0
06CF 120000      E     LCALL   ?C?FPMUL
06D2 120000      E     LCALL   ?C?CASTF
06D5 8E00        R     MOV     i_aux,R6
06D7 8F00        R     MOV     i_aux+01H,R7
                                           ; SOURCE LINE # 1330
06D9 300005            JNB     interrupt_flag,?C0228
                                           ; SOURCE LINE # 1331
06DC C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1332
06DE 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1333
06E1         ?C0228:
                                           ; SOURCE LINE # 1336
06E1 C3                CLR     C
06E2 E500        R     MOV     A,i_aux
06E4 6480              XRL     A,#080H
06E6 947C              SUBB    A,#07CH
06E8 5006              JNC     ?C0229
                                           ; SOURCE LINE # 1337
06EA 7500FC      R     MOV     i_aux,#0FCH
06ED 750000      R     MOV     i_aux+01H,#00H
06F0         ?C0229:
                                           ; SOURCE LINE # 1338
06F0 D3                SETB    C
06F1 E500        R     MOV     A,i_aux+01H
06F3 9400              SUBB    A,#00H
06F5 E500        R     MOV     A,i_aux
06F7 6480              XRL     A,#080H
06F9 9484              SUBB    A,#084H
06FB 4006              JC      ?C0230
                                           ; SOURCE LINE # 1339
06FD 750004      R     MOV     i_aux,#04H
0700 750000      R     MOV     i_aux+01H,#00H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 117 

0703         ?C0230:
                                           ; SOURCE LINE # 1341
0703 300005            JNB     interrupt_flag,?C0231
                                           ; SOURCE LINE # 1342
0706 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1343
0708 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1344
070B         ?C0231:
                                           ; SOURCE LINE # 1346
070B 900000      E     MOV     DPTR,#g_meas+030H
070E E500        R     MOV     A,i_aux
0710 F0                MOVX    @DPTR,A
0711 A3                INC     DPTR
0712 E500        R     MOV     A,i_aux+01H
0714 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1348
0715 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1350
0718         ?C0232:
                                           ; SOURCE LINE # 1351
0718 E4                CLR     A
0719 900000      R     MOV     DPTR,#LR_counter
071C F0                MOVX    @DPTR,A
071D A3                INC     DPTR
071E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1352
071F FF                MOV     R7,A
0720 FE                MOV     R6,A
0721 FD                MOV     R5,A
0722 FC                MOV     R4,A
0723 900000      R     MOV     DPTR,#LR_mean_value
0726 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1353
0729 750004      R     MOV     LR_status,#04H
                                           ; SOURCE LINE # 1354
072C 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1356
072F         ?C0233:
                                           ; SOURCE LINE # 1357
072F 900000      R     MOV     DPTR,#LR_counter+01H
0732 E0                MOVX    A,@DPTR
0733 04                INC     A
0734 F0                MOVX    @DPTR,A
0735 7006              JNZ     ?C0289
0737 900000      R     MOV     DPTR,#LR_counter
073A E0                MOVX    A,@DPTR
073B 04                INC     A
073C F0                MOVX    @DPTR,A
073D         ?C0289:
                                           ; SOURCE LINE # 1358
073D 900000      R     MOV     DPTR,#LR_counter
0740 E0                MOVX    A,@DPTR
0741 7004              JNZ     ?C0290
0743 A3                INC     DPTR
0744 E0                MOVX    A,@DPTR
0745 6464              XRL     A,#064H
0747         ?C0290:
0747 6003              JZ      $ + 5H
0749 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1359
074C 900000      R     MOV     DPTR,#LR_counter
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 118 

074F F0                MOVX    @DPTR,A
0750 A3                INC     DPTR
0751 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1361
0752 300005            JNB     interrupt_flag,?C0235
                                           ; SOURCE LINE # 1362
0755 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1363
0757 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1364
075A         ?C0235:
                                           ; SOURCE LINE # 1366
075A 750003      R     MOV     LR_status,#03H
                                           ; SOURCE LINE # 1367
                                           ; SOURCE LINE # 1368
075D 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1370
0760         ?C0236:
                                           ; SOURCE LINE # 1372
0760 900000      R     MOV     DPTR,#LR_counter+01H
0763 E0                MOVX    A,@DPTR
0764 04                INC     A
0765 F0                MOVX    @DPTR,A
0766 7006              JNZ     ?C0291
0768 900000      R     MOV     DPTR,#LR_counter
076B E0                MOVX    A,@DPTR
076C 04                INC     A
076D F0                MOVX    @DPTR,A
076E         ?C0291:
                                           ; SOURCE LINE # 1373
076E 900000      R     MOV     DPTR,#LR_mean_value
0771 E0                MOVX    A,@DPTR
0772 F8                MOV     R0,A
0773 A3                INC     DPTR
0774 E0                MOVX    A,@DPTR
0775 F9                MOV     R1,A
0776 A3                INC     DPTR
0777 E0                MOVX    A,@DPTR
0778 FA                MOV     R2,A
0779 A3                INC     DPTR
077A E0                MOVX    A,@DPTR
077B FB                MOV     R3,A
077C 900000      E     MOV     DPTR,#ADC_buf+0CH
077F E0                MOVX    A,@DPTR
0780 FE                MOV     R6,A
0781 A3                INC     DPTR
0782 E0                MOVX    A,@DPTR
0783 FF                MOV     R7,A
0784 EE                MOV     A,R6
0785 33                RLC     A
0786 95E0              SUBB    A,ACC
0788 FD                MOV     R5,A
0789 FC                MOV     R4,A
078A EB                MOV     A,R3
078B 2F                ADD     A,R7
078C FF                MOV     R7,A
078D EA                MOV     A,R2
078E 3E                ADDC    A,R6
078F FE                MOV     R6,A
0790 E9                MOV     A,R1
0791 3D                ADDC    A,R5
0792 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 119 

0793 E8                MOV     A,R0
0794 3C                ADDC    A,R4
0795 FC                MOV     R4,A
0796 900000      R     MOV     DPTR,#LR_mean_value
0799 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1374
079C 900000      R     MOV     DPTR,#LR_counter
079F E0                MOVX    A,@DPTR
07A0 7004              JNZ     ?C0292
07A2 A3                INC     DPTR
07A3 E0                MOVX    A,@DPTR
07A4 64C8              XRL     A,#0C8H
07A6         ?C0292:
07A6 703F              JNZ     ?C0226
                                           ; SOURCE LINE # 1375
07A8 900000      R     MOV     DPTR,#LR_mean_value
07AB E0                MOVX    A,@DPTR
07AC FC                MOV     R4,A
07AD A3                INC     DPTR
07AE E0                MOVX    A,@DPTR
07AF FD                MOV     R5,A
07B0 A3                INC     DPTR
07B1 E0                MOVX    A,@DPTR
07B2 FE                MOV     R6,A
07B3 A3                INC     DPTR
07B4 E0                MOVX    A,@DPTR
07B5 FF                MOV     R7,A
07B6 E4                CLR     A
07B7 7BC8              MOV     R3,#0C8H
07B9 FA                MOV     R2,A
07BA F9                MOV     R1,A
07BB F8                MOV     R0,A
07BC 120000      E     LCALL   ?C?SLDIV
07BF 900000      R     MOV     DPTR,#LR_mean_value
07C2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1377
07C5 300005            JNB     interrupt_flag,?C0238
                                           ; SOURCE LINE # 1378
07C8 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1379
07CA 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1380
07CD         ?C0238:
                                           ; SOURCE LINE # 1382
07CD E4                CLR     A
07CE 900000      R     MOV     DPTR,#LR_counter
07D1 F0                MOVX    @DPTR,A
07D2 A3                INC     DPTR
07D3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1383
07D4 F500        R     MOV     LR_status,A
                                           ; SOURCE LINE # 1384
                                           ; SOURCE LINE # 1385
07D6 800F              SJMP    ?C0226
                                           ; SOURCE LINE # 1387
07D8         ?C0239:
                                           ; SOURCE LINE # 1388
07D8 E500        R     MOV     A,emg_1_status
07DA 700B              JNZ     ?C0226
07DC E500        R     MOV     A,emg_2_status
07DE 7007              JNZ     ?C0226
07E0 E500        R     MOV     A,UD_status
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 120 

07E2 7003              JNZ     ?C0226
                                           ; SOURCE LINE # 1389
07E4 750002      R     MOV     LR_status,#02H
                                           ; SOURCE LINE # 1390
                                           ; SOURCE LINE # 1391
07E7         ?C0226:
                                           ; SOURCE LINE # 1393
07E7 30007A            JNB     interrupt_flag,?C0242
                                           ; SOURCE LINE # 1394
07EA C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1395
07EC 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1396
                                           ; SOURCE LINE # 1397
07EF 8073              SJMP    ?C0242
07F1         ?C0166:
                                           ; SOURCE LINE # 1399
                                           ; SOURCE LINE # 1400
07F1 750001      R     MOV     emg_1_status,#01H
                                           ; SOURCE LINE # 1401
07F4 750001      R     MOV     emg_2_status,#01H
                                           ; SOURCE LINE # 1402
07F7 750001      R     MOV     UD_status,#01H
                                           ; SOURCE LINE # 1403
07FA 750001      R     MOV     LR_status,#01H
                                           ; SOURCE LINE # 1405
07FD C200        E     CLR     tension_valid
                                           ; SOURCE LINE # 1407
07FF 300005            JNB     interrupt_flag,?C0243
                                           ; SOURCE LINE # 1408
0802 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1409
0804 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1410
0807         ?C0243:
                                           ; SOURCE LINE # 1412
0807 900000      E     MOV     DPTR,#c_mem+07AH
080A E0                MOVX    A,@DPTR
080B 6020              JZ      ?C0244
                                           ; SOURCE LINE # 1413
080D 900000      E     MOV     DPTR,#c_mem+035H
0810 E0                MOVX    A,@DPTR
0811 FF                MOV     R7,A
0812 6402              XRL     A,#02H
0814 600E              JZ      ?C0246
0816 EF                MOV     A,R7
0817 6403              XRL     A,#03H
0819 6009              JZ      ?C0246
081B EF                MOV     A,R7
081C 6404              XRL     A,#04H
081E 6004              JZ      ?C0246
0820 EF                MOV     A,R7
0821 B40509            CJNE    A,#05H,?C0244
0824         ?C0246:
                                           ; SOURCE LINE # 1416
                                           ; SOURCE LINE # 1417
0824 E4                CLR     A
0825 900000      E     MOV     DPTR,#g_ref+08H
0828 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1418
0829 FF                MOV     R7,A
082A 120000      E     LCALL   _MOTOR_ON_OFF_Write
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 121 

                                           ; SOURCE LINE # 1419
                                           ; SOURCE LINE # 1420
082D         ?C0244:
                                           ; SOURCE LINE # 1423
082D E4                CLR     A
082E FF                MOV     R7,A
082F FE                MOV     R6,A
0830 FD                MOV     R5,A
0831 FC                MOV     R4,A
0832 900000      E     MOV     DPTR,#g_meas+08H
0835 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1424
0838 E4                CLR     A
0839 FF                MOV     R7,A
083A FE                MOV     R6,A
083B FD                MOV     R5,A
083C FC                MOV     R4,A
083D 900000      E     MOV     DPTR,#g_meas+0CH
0840 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1427
0843 E4                CLR     A
0844 FF                MOV     R7,A
0845 FE                MOV     R6,A
0846 FD                MOV     R5,A
0847 FC                MOV     R4,A
0848 900000      E     MOV     DPTR,#g_meas+028H
084B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1428
084E E4                CLR     A
084F FF                MOV     R7,A
0850 FE                MOV     R6,A
0851 FD                MOV     R5,A
0852 FC                MOV     R4,A
0853 900000      E     MOV     DPTR,#g_meas+02CH
0856 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1431
0859 E4                CLR     A
085A 900000      E     MOV     DPTR,#g_meas+030H
085D F0                MOVX    @DPTR,A
085E A3                INC     DPTR
085F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1432
0860 A3                INC     DPTR
0861 F0                MOVX    @DPTR,A
0862 A3                INC     DPTR
0863 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1433
0864         ?C0242:
                                           ; SOURCE LINE # 1435
0864 300005            JNB     interrupt_flag,?C0248
                                           ; SOURCE LINE # 1436
0867 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1437
0869 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1438
                                           ; SOURCE LINE # 1439
086C         ?C0248:
086C 22                RET     
             ; FUNCTION analog_read_end (END)

             ; FUNCTION _encoder_reading (BEGIN)
                                           ; SOURCE LINE # 1445
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 122 

;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1446
                                           ; SOURCE LINE # 1447
0000 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1455
0002 7800        R     MOV     R0,#LOW rot
0004 7C00        R     MOV     R4,#HIGH rot
0006 7D01              MOV     R5,#01H
0008 7BFF              MOV     R3,#0FFH
000A 7A00        R     MOV     R2,#HIGH _?ix1000
000C 7900        R     MOV     R1,#LOW _?ix1000
000E 7E00              MOV     R6,#00H
0010 7F02              MOV     R7,#02H
0012 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 1467
0015 E500        R     MOV     A,index
0017 C3                CLR     C
0018 9404              SUBB    A,#04H
001A 4003              JC      $ + 5H
001C 020000      R     LJMP    ?C0250
001F         ?C0249:
                                           ; SOURCE LINE # 1470
001F 300025            JNB     reset_last_value_flag,?C0251
                                           ; SOURCE LINE # 1471
0022 750004      R     MOV     jj,#04H
0025         ?C0252:
0025 AF00        R     MOV     R7,jj
0027 1500        R     DEC     jj
0029 EF                MOV     A,R7
002A 6019              JZ      ?C0253
                                           ; SOURCE LINE # 1472
002C E4                CLR     A
002D FF                MOV     R7,A
002E FE                MOV     R6,A
002F FD                MOV     R5,A
0030 FC                MOV     R4,A
0031 E500        R     MOV     A,jj
0033 25E0              ADD     A,ACC
0035 25E0              ADD     A,ACC
0037 2400        R     ADD     A,#LOW last_value_encoder
0039 F582              MOV     DPL,A
003B E4                CLR     A
003C 3400        R     ADDC    A,#HIGH last_value_encoder
003E F583              MOV     DPH,A
0040 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1473
0043 80E0              SJMP    ?C0252
0045         ?C0253:
                                           ; SOURCE LINE # 1474
0045 C200        E     CLR     reset_last_value_flag
                                           ; SOURCE LINE # 1475
0047         ?C0251:
                                           ; SOURCE LINE # 1478
0047 E500        R     MOV     A,index
0049 7018              JNZ     ?C0254
                                           ; SOURCE LINE # 1479
004B 120000      E     LCALL   SHIFTREG_ENC_1_ReadData
004E 7801              MOV     R0,#01H
0050 120000      E     LCALL   ?C?ULSHR
0053 EF                MOV     A,R7
0054 EE                MOV     A,R6
0055 ED                MOV     A,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 123 

0056 5403              ANL     A,#03H
0058 FD                MOV     R5,A
0059 E4                CLR     A
005A FC                MOV     R4,A
005B 900000      R     MOV     DPTR,#data_encoder
005E 120000      E     LCALL   ?C?LSTXDATA
0061 8050              SJMP    ?C0255
0063         ?C0254:
                                           ; SOURCE LINE # 1480
                                           ; SOURCE LINE # 1481
0063 E500        R     MOV     A,index
0065 B40118            CJNE    A,#01H,?C0256
                                           ; SOURCE LINE # 1482
0068 120000      E     LCALL   SHIFTREG_ENC_2_ReadData
006B 7801              MOV     R0,#01H
006D 120000      E     LCALL   ?C?ULSHR
0070 EF                MOV     A,R7
0071 EE                MOV     A,R6
0072 ED                MOV     A,R5
0073 5403              ANL     A,#03H
0075 FD                MOV     R5,A
0076 E4                CLR     A
0077 FC                MOV     R4,A
0078 900000      R     MOV     DPTR,#data_encoder
007B 120000      E     LCALL   ?C?LSTXDATA
007E 8033              SJMP    ?C0255
0080         ?C0256:
                                           ; SOURCE LINE # 1483
                                           ; SOURCE LINE # 1484
0080 E500        R     MOV     A,index
0082 B40218            CJNE    A,#02H,?C0258
                                           ; SOURCE LINE # 1485
0085 120000      E     LCALL   SHIFTREG_ENC_3_ReadData
0088 7801              MOV     R0,#01H
008A 120000      E     LCALL   ?C?ULSHR
008D EF                MOV     A,R7
008E EE                MOV     A,R6
008F ED                MOV     A,R5
0090 5403              ANL     A,#03H
0092 FD                MOV     R5,A
0093 E4                CLR     A
0094 FC                MOV     R4,A
0095 900000      R     MOV     DPTR,#data_encoder
0098 120000      E     LCALL   ?C?LSTXDATA
009B 8016              SJMP    ?C0255
009D         ?C0258:
                                           ; SOURCE LINE # 1487
009D 120000      E     LCALL   SHIFTREG_ENC_4_ReadData
00A0 7801              MOV     R0,#01H
00A2 120000      E     LCALL   ?C?ULSHR
00A5 EF                MOV     A,R7
00A6 EE                MOV     A,R6
00A7 ED                MOV     A,R5
00A8 5403              ANL     A,#03H
00AA FD                MOV     R5,A
00AB E4                CLR     A
00AC FC                MOV     R4,A
00AD 900000      R     MOV     DPTR,#data_encoder
00B0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1488
                                           ; SOURCE LINE # 1489
00B3         ?C0255:
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 124 

                                           ; SOURCE LINE # 1491
00B3 7B01              MOV     R3,#01H
00B5 7A00        R     MOV     R2,#HIGH data_encoder
00B7 7900        R     MOV     R1,#LOW data_encoder
00B9 120000      E     LCALL   _check_enc_data
00BC 4003              JC      $ + 5H
00BE 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1493
00C1 900000      R     MOV     DPTR,#data_encoder
00C4 E0                MOVX    A,@DPTR
00C5 FC                MOV     R4,A
00C6 A3                INC     DPTR
00C7 E0                MOVX    A,@DPTR
00C8 FD                MOV     R5,A
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB FE                MOV     R6,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE 54C0              ANL     A,#0C0H
00D0 FB                MOV     R3,A
00D1 EE                MOV     A,R6
00D2 FA                MOV     R2,A
00D3 ED                MOV     A,R5
00D4 5403              ANL     A,#03H
00D6 F9                MOV     R1,A
00D7 E4                CLR     A
00D8 C3                CLR     C
00D9 9B                SUBB    A,R3
00DA FF                MOV     R7,A
00DB 7480              MOV     A,#080H
00DD 9A                SUBB    A,R2
00DE FE                MOV     R6,A
00DF E4                CLR     A
00E0 99                SUBB    A,R1
00E1 FD                MOV     R5,A
00E2 E4                CLR     A
00E3 9400              SUBB    A,#00H
00E5 FC                MOV     R4,A
00E6 7802              MOV     R0,#02H
00E8 120000      E     LCALL   ?C?ULSHR
00EB 120000      E     LCALL   ?C?LNEG
00EE AB07              MOV     R3,AR7
00F0 AA06              MOV     R2,AR6
00F2 E500        R     MOV     A,index
00F4 25E0              ADD     A,ACC
00F6 25E0              ADD     A,ACC
00F8 2400        E     ADD     A,#LOW g_mem+03BH
00FA F582              MOV     DPL,A
00FC E4                CLR     A
00FD 3400        E     ADDC    A,#HIGH g_mem+03BH
00FF F583              MOV     DPH,A
0101 E0                MOVX    A,@DPTR
0102 A3                INC     DPTR
0103 E0                MOVX    A,@DPTR
0104 A3                INC     DPTR
0105 E0                MOVX    A,@DPTR
0106 FE                MOV     R6,A
0107 A3                INC     DPTR
0108 E0                MOVX    A,@DPTR
0109 2B                ADD     A,R3
010A FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 125 

010B EA                MOV     A,R2
010C 3E                ADDC    A,R6
010D FE                MOV     R6,A
010E 33                RLC     A
010F 95E0              SUBB    A,ACC
0111 FD                MOV     R5,A
0112 FC                MOV     R4,A
0113 900000      R     MOV     DPTR,#value_encoder
0116 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1496
0119 300027            JNB     only_first_time,?C0261
                                           ; SOURCE LINE # 1497
011C 900000      R     MOV     DPTR,#value_encoder
011F E0                MOVX    A,@DPTR
0120 FC                MOV     R4,A
0121 A3                INC     DPTR
0122 E0                MOVX    A,@DPTR
0123 FD                MOV     R5,A
0124 A3                INC     DPTR
0125 E0                MOVX    A,@DPTR
0126 FE                MOV     R6,A
0127 A3                INC     DPTR
0128 E0                MOVX    A,@DPTR
0129 FF                MOV     R7,A
012A E500        R     MOV     A,index
012C 25E0              ADD     A,ACC
012E 25E0              ADD     A,ACC
0130 2400        R     ADD     A,#LOW last_value_encoder
0132 F582              MOV     DPL,A
0134 E4                CLR     A
0135 3400        R     ADDC    A,#HIGH last_value_encoder
0137 F583              MOV     DPH,A
0139 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1499
013C E500        R     MOV     A,index
013E B40302            CJNE    A,#03H,?C0261
                                           ; SOURCE LINE # 1500
0141 C200        R     CLR     only_first_time
                                           ; SOURCE LINE # 1501
0143         ?C0261:
                                           ; SOURCE LINE # 1504
0143 E500        R     MOV     A,index
0145 25E0              ADD     A,ACC
0147 25E0              ADD     A,ACC
0149 2400        R     ADD     A,#LOW last_value_encoder
014B F582              MOV     DPL,A
014D E4                CLR     A
014E 3400        R     ADDC    A,#HIGH last_value_encoder
0150 F583              MOV     DPH,A
0152 E0                MOVX    A,@DPTR
0153 F8                MOV     R0,A
0154 A3                INC     DPTR
0155 E0                MOVX    A,@DPTR
0156 F9                MOV     R1,A
0157 A3                INC     DPTR
0158 E0                MOVX    A,@DPTR
0159 FA                MOV     R2,A
015A A3                INC     DPTR
015B E0                MOVX    A,@DPTR
015C FB                MOV     R3,A
015D 900000      R     MOV     DPTR,#value_encoder
0160 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 126 

0161 FC                MOV     R4,A
0162 A3                INC     DPTR
0163 E0                MOVX    A,@DPTR
0164 FD                MOV     R5,A
0165 A3                INC     DPTR
0166 E0                MOVX    A,@DPTR
0167 FE                MOV     R6,A
0168 A3                INC     DPTR
0169 E0                MOVX    A,@DPTR
016A C3                CLR     C
016B 9B                SUBB    A,R3
016C FF                MOV     R7,A
016D EE                MOV     A,R6
016E 9A                SUBB    A,R2
016F FE                MOV     R6,A
0170 ED                MOV     A,R5
0171 99                SUBB    A,R1
0172 FD                MOV     R5,A
0173 EC                MOV     A,R4
0174 98                SUBB    A,R0
0175 FC                MOV     R4,A
0176 A3                INC     DPTR
0177 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1524
017A E4                CLR     A
017B FF                MOV     R7,A
017C 7EC0              MOV     R6,#0C0H
017E FD                MOV     R5,A
017F FC                MOV     R4,A
0180 900000      R     MOV     DPTR,#aux
0183 E0                MOVX    A,@DPTR
0184 F8                MOV     R0,A
0185 A3                INC     DPTR
0186 E0                MOVX    A,@DPTR
0187 F9                MOV     R1,A
0188 A3                INC     DPTR
0189 E0                MOVX    A,@DPTR
018A FA                MOV     R2,A
018B A3                INC     DPTR
018C E0                MOVX    A,@DPTR
018D FB                MOV     R3,A
018E D3                SETB    C
018F 120000      E     LCALL   ?C?SLCMP
0192 4016              JC      ?C0263
                                           ; SOURCE LINE # 1525
0194 E500        R     MOV     A,index
0196 25E0              ADD     A,ACC
0198 2400        E     ADD     A,#LOW g_meas+020H
019A F582              MOV     DPL,A
019C E4                CLR     A
019D 3400        E     ADDC    A,#HIGH g_meas+020H
019F F583              MOV     DPH,A
01A1 74FF              MOV     A,#0FFH
01A3 F5F0              MOV     B,A
01A5 120000      E     LCALL   ?C?IILDX
01A8 806E              SJMP    ?C0264
01AA         ?C0263:
                                           ; SOURCE LINE # 1526
                                           ; SOURCE LINE # 1527
01AA 7F00              MOV     R7,#00H
01AC 7E40              MOV     R6,#040H
01AE 7DFF              MOV     R5,#0FFH
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 127 

01B0 7CFF              MOV     R4,#0FFH
01B2 900000      R     MOV     DPTR,#aux
01B5 E0                MOVX    A,@DPTR
01B6 F8                MOV     R0,A
01B7 A3                INC     DPTR
01B8 E0                MOVX    A,@DPTR
01B9 F9                MOV     R1,A
01BA A3                INC     DPTR
01BB E0                MOVX    A,@DPTR
01BC FA                MOV     R2,A
01BD A3                INC     DPTR
01BE E0                MOVX    A,@DPTR
01BF FB                MOV     R3,A
01C0 C3                CLR     C
01C1 120000      E     LCALL   ?C?SLCMP
01C4 5016              JNC     ?C0265
                                           ; SOURCE LINE # 1528
01C6 E500        R     MOV     A,index
01C8 25E0              ADD     A,ACC
01CA 2400        E     ADD     A,#LOW g_meas+020H
01CC F582              MOV     DPL,A
01CE E4                CLR     A
01CF 3400        E     ADDC    A,#HIGH g_meas+020H
01D1 F583              MOV     DPH,A
01D3 E4                CLR     A
01D4 75F001            MOV     B,#01H
01D7 120000      E     LCALL   ?C?IILDX
01DA 803C              SJMP    ?C0264
01DC         ?C0265:
                                           ; SOURCE LINE # 1529
                                           ; SOURCE LINE # 1530
01DC 900000      R     MOV     DPTR,#aux
01DF E0                MOVX    A,@DPTR
01E0 A3                INC     DPTR
01E1 E0                MOVX    A,@DPTR
01E2 A3                INC     DPTR
01E3 E0                MOVX    A,@DPTR
01E4 FE                MOV     R6,A
01E5 A3                INC     DPTR
01E6 E0                MOVX    A,@DPTR
01E7 FF                MOV     R7,A
01E8 120000      E     LCALL   _abs
01EB D3                SETB    C
01EC EF                MOV     A,R7
01ED 9400              SUBB    A,#00H
01EF EE                MOV     A,R6
01F0 6480              XRL     A,#080H
01F2 94C0              SUBB    A,#0C0H
01F4 4022              JC      ?C0264
                                           ; SOURCE LINE # 1531
01F6 7400        R     MOV     A,#LOW error
01F8 2500        R     ADD     A,index
01FA F582              MOV     DPL,A
01FC E4                CLR     A
01FD 3400        R     ADDC    A,#HIGH error
01FF F583              MOV     DPH,A
0201 E0                MOVX    A,@DPTR
0202 04                INC     A
0203 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1532
0204 7400        R     MOV     A,#LOW error
0206 2500        R     ADD     A,index
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 128 

0208 F582              MOV     DPL,A
020A E4                CLR     A
020B 3400        R     ADDC    A,#HIGH error
020D F583              MOV     DPH,A
020F E0                MOVX    A,@DPTR
0210 C3                CLR     C
0211 940A              SUBB    A,#0AH
0213 5003              JNC     $ + 5H
0215 020000      R     LJMP    ?C0250
0218         ?C0268:
                                           ; SOURCE LINE # 1535
                                           ; SOURCE LINE # 1536
                                           ; SOURCE LINE # 1537
0218         ?C0264:
                                           ; SOURCE LINE # 1539
0218 7400        R     MOV     A,#LOW error
021A 2500        R     ADD     A,index
021C F582              MOV     DPL,A
021E E4                CLR     A
021F 3400        R     ADDC    A,#HIGH error
0221 F583              MOV     DPH,A
0223 E4                CLR     A
0224 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1541
0225 900000      R     MOV     DPTR,#value_encoder
0228 E0                MOVX    A,@DPTR
0229 FC                MOV     R4,A
022A A3                INC     DPTR
022B E0                MOVX    A,@DPTR
022C FD                MOV     R5,A
022D A3                INC     DPTR
022E E0                MOVX    A,@DPTR
022F FE                MOV     R6,A
0230 A3                INC     DPTR
0231 E0                MOVX    A,@DPTR
0232 FF                MOV     R7,A
0233 E500        R     MOV     A,index
0235 25E0              ADD     A,ACC
0237 25E0              ADD     A,ACC
0239 2400        R     ADD     A,#LOW last_value_encoder
023B F582              MOV     DPL,A
023D E4                CLR     A
023E 3400        R     ADDC    A,#HIGH last_value_encoder
0240 F583              MOV     DPH,A
0242 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1543
0245 900000      R     MOV     DPTR,#value_encoder
0248 E0                MOVX    A,@DPTR
0249 F8                MOV     R0,A
024A A3                INC     DPTR
024B E0                MOVX    A,@DPTR
024C F9                MOV     R1,A
024D A3                INC     DPTR
024E E0                MOVX    A,@DPTR
024F FA                MOV     R2,A
0250 A3                INC     DPTR
0251 E0                MOVX    A,@DPTR
0252 FB                MOV     R3,A
0253 C000              PUSH    AR0
0255 E500        R     MOV     A,index
0257 25E0              ADD     A,ACC
0259 2400        E     ADD     A,#LOW g_meas+020H
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 129 

025B F582              MOV     DPL,A
025D E4                CLR     A
025E 3400        E     ADDC    A,#HIGH g_meas+020H
0260 F583              MOV     DPH,A
0262 E0                MOVX    A,@DPTR
0263 FE                MOV     R6,A
0264 A3                INC     DPTR
0265 E0                MOVX    A,@DPTR
0266 FF                MOV     R7,A
0267 EE                MOV     A,R6
0268 33                RLC     A
0269 95E0              SUBB    A,ACC
026B FD                MOV     R5,A
026C FC                MOV     R4,A
026D 7810              MOV     R0,#010H
026F 120000      E     LCALL   ?C?LSHL
0272 D000              POP     AR0
0274 EB                MOV     A,R3
0275 2F                ADD     A,R7
0276 FF                MOV     R7,A
0277 EA                MOV     A,R2
0278 3E                ADDC    A,R6
0279 FE                MOV     R6,A
027A E9                MOV     A,R1
027B 3D                ADDC    A,R5
027C FD                MOV     R5,A
027D E8                MOV     A,R0
027E 3C                ADDC    A,R4
027F FC                MOV     R4,A
0280 900000      R     MOV     DPTR,#value_encoder
0283 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1545
0286 E500        R     MOV     A,index
0288 25E0              ADD     A,ACC
028A 25E0              ADD     A,ACC
028C 2400        E     ADD     A,#LOW c_mem+04BH
028E F582              MOV     DPL,A
0290 E4                CLR     A
0291 3400        E     ADDC    A,#HIGH c_mem+04BH
0293 F583              MOV     DPH,A
0295 E0                MOVX    A,@DPTR
0296 FC                MOV     R4,A
0297 A3                INC     DPTR
0298 E0                MOVX    A,@DPTR
0299 FD                MOV     R5,A
029A A3                INC     DPTR
029B E0                MOVX    A,@DPTR
029C FE                MOV     R6,A
029D A3                INC     DPTR
029E E0                MOVX    A,@DPTR
029F FF                MOV     R7,A
02A0 E4                CLR     A
02A1 FB                MOV     R3,A
02A2 FA                MOV     R2,A
02A3 7980              MOV     R1,#080H
02A5 783F              MOV     R0,#03FH
02A7 120000      E     LCALL   ?C?FPCMP3
02AA 6038              JZ      ?C0269
                                           ; SOURCE LINE # 1546
02AC 900000      R     MOV     DPTR,#value_encoder
02AF E0                MOVX    A,@DPTR
02B0 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 130 

02B1 A3                INC     DPTR
02B2 E0                MOVX    A,@DPTR
02B3 FD                MOV     R5,A
02B4 A3                INC     DPTR
02B5 E0                MOVX    A,@DPTR
02B6 FE                MOV     R6,A
02B7 A3                INC     DPTR
02B8 E0                MOVX    A,@DPTR
02B9 FF                MOV     R7,A
02BA EC                MOV     A,R4
02BB 120000      E     LCALL   ?C?FCASTL
02BE E500        R     MOV     A,index
02C0 25E0              ADD     A,ACC
02C2 25E0              ADD     A,ACC
02C4 2400        E     ADD     A,#LOW c_mem+04BH
02C6 F582              MOV     DPL,A
02C8 E4                CLR     A
02C9 3400        E     ADDC    A,#HIGH c_mem+04BH
02CB F583              MOV     DPH,A
02CD E0                MOVX    A,@DPTR
02CE F8                MOV     R0,A
02CF A3                INC     DPTR
02D0 E0                MOVX    A,@DPTR
02D1 F9                MOV     R1,A
02D2 A3                INC     DPTR
02D3 E0                MOVX    A,@DPTR
02D4 FA                MOV     R2,A
02D5 A3                INC     DPTR
02D6 E0                MOVX    A,@DPTR
02D7 FB                MOV     R3,A
02D8 120000      E     LCALL   ?C?FPMUL
02DB 120000      E     LCALL   ?C?CASTF
02DE 900000      R     MOV     DPTR,#value_encoder
02E1 120000      E     LCALL   ?C?LSTXDATA
02E4         ?C0269:
                                           ; SOURCE LINE # 1548
02E4 900000      R     MOV     DPTR,#value_encoder
02E7 E0                MOVX    A,@DPTR
02E8 FC                MOV     R4,A
02E9 A3                INC     DPTR
02EA E0                MOVX    A,@DPTR
02EB FD                MOV     R5,A
02EC A3                INC     DPTR
02ED E0                MOVX    A,@DPTR
02EE FE                MOV     R6,A
02EF A3                INC     DPTR
02F0 E0                MOVX    A,@DPTR
02F1 FF                MOV     R7,A
02F2 E500        R     MOV     A,index
02F4 25E0              ADD     A,ACC
02F6 25E0              ADD     A,ACC
02F8 2400        E     ADD     A,#LOW g_meas+010H
02FA F582              MOV     DPL,A
02FC E4                CLR     A
02FD 3400        E     ADDC    A,#HIGH g_meas+010H
02FF F583              MOV     DPH,A
0301 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1549
0304         ?C0260:
                                           ; SOURCE LINE # 1551
0304 300003      R     JNB     pos_reconstruct,$ + 6H
0307 020000      R     LJMP    ?C0250
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 131 

                                           ; SOURCE LINE # 1552
030A E500        R     MOV     A,one_time_execute
030C C3                CLR     C
030D 9422              SUBB    A,#022H
030F 5003              JNC     ?C0271
                                           ; SOURCE LINE # 1553
0311 0500        R     INC     one_time_execute
                                           ; SOURCE LINE # 1554
0313 22                RET     
0314         ?C0271:
                                           ; SOURCE LINE # 1556
0314 900000      E     MOV     DPTR,#g_meas+010H
0317 E0                MOVX    A,@DPTR
0318 FC                MOV     R4,A
0319 A3                INC     DPTR
031A E0                MOVX    A,@DPTR
031B FD                MOV     R5,A
031C A3                INC     DPTR
031D E0                MOVX    A,@DPTR
031E FE                MOV     R6,A
031F A3                INC     DPTR
0320 E0                MOVX    A,@DPTR
0321 FF                MOV     R7,A
0322 900000      E     MOV     DPTR,#g_ref
0325 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1557
0328 900000      E     MOV     DPTR,#g_meas+018H
032B E0                MOVX    A,@DPTR
032C FC                MOV     R4,A
032D A3                INC     DPTR
032E E0                MOVX    A,@DPTR
032F FD                MOV     R5,A
0330 A3                INC     DPTR
0331 E0                MOVX    A,@DPTR
0332 FE                MOV     R6,A
0333 A3                INC     DPTR
0334 E0                MOVX    A,@DPTR
0335 FF                MOV     R7,A
0336 900000      E     MOV     DPTR,#g_ref+04H
0339 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1558
033C 900000      E     MOV     DPTR,#g_ref+08H
033F E0                MOVX    A,@DPTR
0340 FF                MOV     R7,A
0341 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1561
0344 E500        R     MOV     A,index
0346 C3                CLR     C
0347 13                RRC     A
0348 900000      R     MOV     DPTR,#sensor_index
034B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1562
034C 900000      E     MOV     DPTR,#c_mem+084H
034F E0                MOVX    A,@DPTR
0350 6071              JZ      ?C0273
                                           ; SOURCE LINE # 1563
0352 900000      R     MOV     DPTR,#sensor_index
0355 E0                MOVX    A,@DPTR
0356 FF                MOV     R7,A
0357 25E0              ADD     A,ACC
0359 25E0              ADD     A,ACC
035B 25E0              ADD     A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 132 

035D 2400        E     ADD     A,#LOW g_meas+010H
035F F582              MOV     DPL,A
0361 E4                CLR     A
0362 3400        E     ADDC    A,#HIGH g_meas+010H
0364 F583              MOV     DPH,A
0366 E0                MOVX    A,@DPTR
0367 FC                MOV     R4,A
0368 A3                INC     DPTR
0369 E0                MOVX    A,@DPTR
036A FD                MOV     R5,A
036B A3                INC     DPTR
036C E0                MOVX    A,@DPTR
036D FE                MOV     R6,A
036E A3                INC     DPTR
036F E0                MOVX    A,@DPTR
0370 FF                MOV     R7,A
0371 C004              PUSH    AR4
0373 C005              PUSH    AR5
0375 C006              PUSH    AR6
0377 C007              PUSH    AR7
0379 900000      R     MOV     DPTR,#sensor_index
037C E0                MOVX    A,@DPTR
037D FF                MOV     R7,A
037E 25E0              ADD     A,ACC
0380 25E0              ADD     A,ACC
0382 25E0              ADD     A,ACC
0384 2400        E     ADD     A,#LOW g_meas+014H
0386 F582              MOV     DPL,A
0388 E4                CLR     A
0389 3400        E     ADDC    A,#HIGH g_meas+014H
038B F583              MOV     DPH,A
038D E0                MOVX    A,@DPTR
038E FC                MOV     R4,A
038F A3                INC     DPTR
0390 E0                MOVX    A,@DPTR
0391 FD                MOV     R5,A
0392 A3                INC     DPTR
0393 E0                MOVX    A,@DPTR
0394 FE                MOV     R6,A
0395 A3                INC     DPTR
0396 E0                MOVX    A,@DPTR
0397 FF                MOV     R7,A
0398 900000      E     MOV     DPTR,#?_calc_turns_fcn?BYTE+04H
039B 120000      E     LCALL   ?C?LSTXDATA
039E D007              POP     AR7
03A0 D006              POP     AR6
03A2 D005              POP     AR5
03A4 D004              POP     AR4
03A6 120000      E     LCALL   _calc_turns_fcn
03A9 900000      R     MOV     DPTR,#sensor_index
03AC E0                MOVX    A,@DPTR
03AD FD                MOV     R5,A
03AE C3                CLR     C
03AF 13                RRC     A
03B0 FD                MOV     R5,A
03B1 25E0              ADD     A,ACC
03B3 25E0              ADD     A,ACC
03B5 2400        E     ADD     A,#LOW g_meas+020H
03B7 F582              MOV     DPL,A
03B9 E4                CLR     A
03BA 3400        E     ADDC    A,#HIGH g_meas+020H
03BC F583              MOV     DPH,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 133 

03BE EE                MOV     A,R6
03BF F0                MOVX    @DPTR,A
03C0 A3                INC     DPTR
03C1 EF                MOV     A,R7
03C2 F0                MOVX    @DPTR,A
03C3         ?C0273:
                                           ; SOURCE LINE # 1565
03C3 900000      R     MOV     DPTR,#sensor_index
03C6 E0                MOVX    A,@DPTR
03C7 FF                MOV     R7,A
03C8 C3                CLR     C
03C9 13                RRC     A
03CA FF                MOV     R7,A
03CB 25E0              ADD     A,ACC
03CD 25E0              ADD     A,ACC
03CF 25E0              ADD     A,ACC
03D1 2400        E     ADD     A,#LOW g_meas+010H
03D3 F582              MOV     DPL,A
03D5 E4                CLR     A
03D6 3400        E     ADDC    A,#HIGH g_meas+010H
03D8 F583              MOV     DPH,A
03DA C083              PUSH    DPH
03DC C082              PUSH    DPL
03DE E0                MOVX    A,@DPTR
03DF F8                MOV     R0,A
03E0 A3                INC     DPTR
03E1 E0                MOVX    A,@DPTR
03E2 F9                MOV     R1,A
03E3 A3                INC     DPTR
03E4 E0                MOVX    A,@DPTR
03E5 FA                MOV     R2,A
03E6 A3                INC     DPTR
03E7 E0                MOVX    A,@DPTR
03E8 FB                MOV     R3,A
03E9 C000              PUSH    AR0
03EB 900000      R     MOV     DPTR,#sensor_index
03EE E0                MOVX    A,@DPTR
03EF FF                MOV     R7,A
03F0 C3                CLR     C
03F1 13                RRC     A
03F2 FF                MOV     R7,A
03F3 25E0              ADD     A,ACC
03F5 25E0              ADD     A,ACC
03F7 2400        E     ADD     A,#LOW g_meas+020H
03F9 F582              MOV     DPL,A
03FB E4                CLR     A
03FC 3400        E     ADDC    A,#HIGH g_meas+020H
03FE F583              MOV     DPH,A
0400 E0                MOVX    A,@DPTR
0401 FE                MOV     R6,A
0402 A3                INC     DPTR
0403 E0                MOVX    A,@DPTR
0404 FF                MOV     R7,A
0405 EE                MOV     A,R6
0406 33                RLC     A
0407 95E0              SUBB    A,ACC
0409 FD                MOV     R5,A
040A FC                MOV     R4,A
040B 7810              MOV     R0,#010H
040D 120000      E     LCALL   ?C?LSHL
0410 D000              POP     AR0
0412 EB                MOV     A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 134 

0413 2F                ADD     A,R7
0414 FF                MOV     R7,A
0415 EA                MOV     A,R2
0416 3E                ADDC    A,R6
0417 FE                MOV     R6,A
0418 E9                MOV     A,R1
0419 3D                ADDC    A,R5
041A FD                MOV     R5,A
041B E8                MOV     A,R0
041C 3C                ADDC    A,R4
041D FC                MOV     R4,A
041E D082              POP     DPL
0420 D083              POP     DPH
0422 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1567
0425 900000      R     MOV     DPTR,#sensor_index
0428 E0                MOVX    A,@DPTR
0429 FF                MOV     R7,A
042A C3                CLR     C
042B 13                RRC     A
042C FF                MOV     R7,A
042D 25E0              ADD     A,ACC
042F FB                MOV     R3,A
0430 25E0              ADD     A,ACC
0432 25E0              ADD     A,ACC
0434 2400        E     ADD     A,#LOW g_meas+010H
0436 F582              MOV     DPL,A
0438 E4                CLR     A
0439 3400        E     ADDC    A,#HIGH g_meas+010H
043B F583              MOV     DPH,A
043D E0                MOVX    A,@DPTR
043E FC                MOV     R4,A
043F A3                INC     DPTR
0440 E0                MOVX    A,@DPTR
0441 FD                MOV     R5,A
0442 A3                INC     DPTR
0443 E0                MOVX    A,@DPTR
0444 FE                MOV     R6,A
0445 A3                INC     DPTR
0446 E0                MOVX    A,@DPTR
0447 FF                MOV     R7,A
0448 EB                MOV     A,R3
0449 25E0              ADD     A,ACC
044B 25E0              ADD     A,ACC
044D 2400        E     ADD     A,#LOW g_refNew
044F F582              MOV     DPL,A
0451 E4                CLR     A
0452 3400        E     ADDC    A,#HIGH g_refNew
0454 F583              MOV     DPH,A
0456 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1569
0459 D200        R     SETB    pos_reconstruct
                                           ; SOURCE LINE # 1570
                                           ; SOURCE LINE # 1571
                                           ; SOURCE LINE # 1593
045B         ?C0250:
045B 22                RET     
             ; FUNCTION _encoder_reading (END)

             ; FUNCTION pwm_limit_search (BEGIN)
                                           ; SOURCE LINE # 1599
                                           ; SOURCE LINE # 1601
C51 COMPILER V9.51   INTERRUPTIONS                                                         02/07/2017 16:12:08 PAGE 135 

0000 900000      E     MOV     DPTR,#dev_pwm_limit
0003 7464              MOV     A,#064H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1614
0006 22                RET     
             ; FUNCTION pwm_limit_search (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   8996    ----
   CONSTANT SIZE    =     31    ----
   XDATA SIZE       =    199      51
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11      63
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
