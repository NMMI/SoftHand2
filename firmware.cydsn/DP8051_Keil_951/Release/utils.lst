C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE UTILS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\utils.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\4.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -utils.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP8051_Keil_95
                    -1\Release/utils.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\utils.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // -----------------------------------------------------------------------------
   2          // Copyright (C)  qbrobotics. All rights reserved.
   3          // www.qbrobotics.com
   4          // -----------------------------------------------------------------------------
   5          
   6          /**
   7          * \file         utils.h
   8          *
   9          * \brief        Definition of utility functions.
  10          * \date         Dic. 1, 2015
  11          * \author       qbrobotics
  12          * \copyright    (C)  qbrobotics. All rights reserved.
  13          */
  14          
  15          #include <utils.h>
  16          #include <math.h>
  17          
  18          //==============================================================================
  19          //                                                               CURRENT FILTERS
  20          //==============================================================================
  21          
  22          int32 filter_i1(int32 new_value) {
  23   1      
  24   1          static int32 old_value, aux;
  25   1      
  26   1          aux = (old_value * (1024 - ALPHA) + (new_value << 6) * (ALPHA)) >> 10;
  27   1      
  28   1          old_value = aux;
  29   1      
  30   1          return (aux >> 6);
  31   1      }
  32          
  33          int32 filter_i2(int32 new_value) {
  34   1      
  35   1          static int32 old_value, aux;
  36   1      
  37   1          aux = (old_value * (1024 - ALPHA) + (new_value << 6) * (ALPHA)) >> 10;
  38   1      
  39   1          old_value = aux;
  40   1      
  41   1          return (aux >> 6);
  42   1      }
  43          
  44          //==============================================================================
  45          //                                                              VELOCITY FILTERS
  46          //==============================================================================
  47          
  48          int32 filter_vel_1(int32 new_value) {
  49   1      
  50   1          static int32 old_value, aux;
  51   1      
  52   1          aux = (old_value * (1024 - GAMMA) + (new_value << 6) * (GAMMA)) / 1024;
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 2   

  53   1      
  54   1          old_value = aux;
  55   1      
  56   1          return (aux >> 6);
  57   1      }
  58          
  59          int32 filter_vel_2(int32 new_value) {
  60   1      
  61   1          static int32 old_value, aux;
  62   1      
  63   1          aux = (old_value * (1024 - GAMMA) + (new_value << 6) * (GAMMA)) / 1024;
  64   1      
  65   1          old_value = aux;
  66   1      
  67   1          return (aux >> 6);
  68   1      }
  69          
  70          int32 filter_vel_3(int32 new_value) {
  71   1      
  72   1          static int32 old_value, aux;
  73   1      
  74   1          aux = (old_value * (1024 - GAMMA) + (new_value << 6) * (GAMMA)) / 1024;
  75   1      
  76   1          old_value = aux;
  77   1      
  78   1          return (aux >> 6);
  79   1      }
  80          
  81          //==============================================================================
  82          //                                                                   Emg Filters
  83          //==============================================================================
  84          
  85          int32 filter_ch1(int32 new_value) {
  86   1      
  87   1          static int32 old_value, aux;
  88   1      
  89   1          aux = (old_value * (1024 - BETA) + new_value * (BETA)) / 1024;
  90   1      
  91   1          old_value = aux;
  92   1      
  93   1          return aux;
  94   1      }
  95          
  96          int32 filter_ch2(int32 new_value) {
  97   1      
  98   1          static int32 old_value, aux;
  99   1      
 100   1          aux = (old_value * (1024 - BETA) + new_value * (BETA)) / 1024;
 101   1      
 102   1          old_value = aux;
 103   1      
 104   1          return aux;
 105   1      }
 106          
 107          
 108          //==============================================================================
 109          //                                                                CHECK ENC DATA
 110          //==============================================================================
 111          
 112          // Returns 1 if the encoder data is correct, 0 otherwise
 113          
 114          CYBIT check_enc_data(const uint32 *value) {
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 3   

 115   1      
 116   1          const uint8* CYIDATA p = (const uint8*)value;
 117   1          uint8 CYDATA a = *p;
 118   1      
 119   1          a = a ^ *(++p);
 120   1          a = a ^ *(++p);
 121   1          a = a ^ *(++p);
 122   1          a = (a & 0x0F) ^ (a>>4);
 123   1      
 124   1          return (0x9669 >> a) & 0x01;
 125   1          //0x9669 is a bit vector representing the !(bitwise XOR) of 4bits
 126   1      }
 127          
 128          //==============================================================================
 129          //                                                                     CALIBRATE
 130          //==============================================================================
 131          
 132          void calibration(void) {
 133   1          static uint8 direction;                 //0 closing, 1 opening
 134   1          static uint16 closure_counter;          //Range [0 - 2^16]
 135   1      
 136   1      
 137   1          // closing
 138   1          if (direction == 0) {
 139   2              g_ref.pos[0] += (calib.speed << g_mem.res[0]);
 140   2              if ((g_ref.pos[0]) > g_mem.pos_lim_sup[0]) {
 141   3                  direction = 1;
 142   3              }
 143   2          } else { //opening
 144   2              g_ref.pos[0] -= (calib.speed << g_mem.res[0]);
 145   2              if (SIGN(g_ref.pos[0]) != 1) {
 146   3                  direction = 0;
 147   3                  closure_counter++;
 148   3                  if (closure_counter == calib.repetitions) {
 149   4                      closure_counter = 0;
 150   4                      calib.enabled = FALSE;
 151   4                  }
 152   3              }
 153   2          }
 154   1      }
 155          
 156          //==============================================================================
 157          //                                                                        MODULE
 158          //==============================================================================
 159          
 160          uint32 my_mod(int32 val, int32 divisor) {
 161   1      
 162   1          if (val >= 0) {
 163   2              return (int32)(val % divisor);
 164   2          } else {
 165   2              return (int32)(divisor - (-val % divisor));
 166   2          }
 167   1      }
 168          
 169          //==============================================================================
 170          //                                                      DOUBLE ENCODER CALC TURN
 171          //==============================================================================
 172          
 173          // Use this matlab function to calculate I1 and I2
 174          //
 175          // function [inv_a, inv_b] = mod_mul_inv(a, b)
 176          //     a = int32(a);
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 4   

 177          //     b = int32(b);
 178          //     if b == 0
 179          //         inv_a = 1;
 180          //         inv_b = 0;
 181          //         return
 182          //     else
 183          //         q = idivide(a,b,'floor');
 184          //         r = mod(a,b);
 185          //         [s, t] = mod_mul_inv(b, r);
 186          //     end
 187          //     inv_a = t;
 188          //     inv_b = s - q * t;
 189          // return
 190          
 191          // Number of teeth of the two wheels
 192          #define N1 28           ///< Teeth of the first encoder wheel
 193          #define N2 27           ///< Teeth of the second encoder wheel
 194          
 195          #define I1 1            ///< First wheel invariant value
 196          #define I2 (-1)         ///< Second wheel invariant value
 197          
 198          // Number of ticks per turn
 199          #define M 65536          ///< Number of encoder ticks per turn
 200          
 201          
 202          int calc_turns_fcn(const int32 pos1, const int32 pos2) {
 203   1          
 204   1          int32 x = (my_mod( - N2*pos2 - N1*pos1, M*N2) + M/2) / M;
 205   1      
 206   1          int32 aux = my_mod(x*I1, N2);
 207   1          
 208   1          return (my_mod(aux + N2/2, N2) - N2/2);
 209   1      }
 210          
 211          
 212          //==============================================================================
 213          //                                                             CHECKSUM FUNCTION
 214          //==============================================================================
 215          
 216          // Performs a XOR byte by byte on the entire vector
 217          
 218          uint8 LCRChecksum(uint8 *data_array, const uint8 data_length) {
 219   1          
 220   1          uint8 CYDATA i;
 221   1          uint8 CYDATA checksum = 0x00;
 222   1          
 223   1          for(i = 0; i < data_length; ++i)
 224   1             checksum ^= data_array[i];
 225   1        
 226   1          return checksum;
 227   1      }
 228          
 229          /* [] END OF FILE */
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 5   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION _filter_i1 (BEGIN)
                                           ; SOURCE LINE # 22
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 26
0000 7806              MOV     R0,#06H
0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B03              MOV     R3,#03H
0008 FA                MOV     R2,A
0009 F9                MOV     R1,A
000A F8                MOV     R0,A
000B 120000      E     LCALL   ?C?LMUL
000E C004              PUSH    AR4
0010 C005              PUSH    AR5
0012 C006              PUSH    AR6
0014 C007              PUSH    AR7
0016 E4                CLR     A
0017 7FFD              MOV     R7,#0FDH
0019 7E03              MOV     R6,#03H
001B FD                MOV     R5,A
001C FC                MOV     R4,A
001D 900000      R     MOV     DPTR,#old_value
0020 E0                MOVX    A,@DPTR
0021 F8                MOV     R0,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 F9                MOV     R1,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FA                MOV     R2,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FB                MOV     R3,A
002B 120000      E     LCALL   ?C?LMUL
002E D003              POP     AR3
0030 D002              POP     AR2
0032 D001              POP     AR1
0034 D000              POP     AR0
0036 EF                MOV     A,R7
0037 2B                ADD     A,R3
0038 FF                MOV     R7,A
0039 EE                MOV     A,R6
003A 3A                ADDC    A,R2
003B FE                MOV     R6,A
003C ED                MOV     A,R5
003D 39                ADDC    A,R1
003E FD                MOV     R5,A
003F EC                MOV     A,R4
0040 38                ADDC    A,R0
0041 FC                MOV     R4,A
0042 780A              MOV     R0,#0AH
0044 120000      E     LCALL   ?C?SLSHR
0047 900000      R     MOV     DPTR,#aux
004A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 28
004D 900000      R     MOV     DPTR,#aux
0050 E0                MOVX    A,@DPTR
0051 FC                MOV     R4,A
0052 A3                INC     DPTR
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 6   

0053 E0                MOVX    A,@DPTR
0054 FD                MOV     R5,A
0055 A3                INC     DPTR
0056 E0                MOVX    A,@DPTR
0057 FE                MOV     R6,A
0058 A3                INC     DPTR
0059 E0                MOVX    A,@DPTR
005A FF                MOV     R7,A
005B 900000      R     MOV     DPTR,#old_value
005E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 30
0061 900000      R     MOV     DPTR,#aux
0064 E0                MOVX    A,@DPTR
0065 FC                MOV     R4,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FD                MOV     R5,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B FE                MOV     R6,A
006C A3                INC     DPTR
006D E0                MOVX    A,@DPTR
006E FF                MOV     R7,A
006F 7806              MOV     R0,#06H
0071 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 31
0074         ?C0001:
0074 22                RET     
             ; FUNCTION _filter_i1 (END)

             ; FUNCTION _filter_i2 (BEGIN)
                                           ; SOURCE LINE # 33
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 37
0000 7806              MOV     R0,#06H
0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B03              MOV     R3,#03H
0008 FA                MOV     R2,A
0009 F9                MOV     R1,A
000A F8                MOV     R0,A
000B 120000      E     LCALL   ?C?LMUL
000E C004              PUSH    AR4
0010 C005              PUSH    AR5
0012 C006              PUSH    AR6
0014 C007              PUSH    AR7
0016 E4                CLR     A
0017 7FFD              MOV     R7,#0FDH
0019 7E03              MOV     R6,#03H
001B FD                MOV     R5,A
001C FC                MOV     R4,A
001D 900000      R     MOV     DPTR,#old_value
0020 E0                MOVX    A,@DPTR
0021 F8                MOV     R0,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 F9                MOV     R1,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FA                MOV     R2,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 7   

002A FB                MOV     R3,A
002B 120000      E     LCALL   ?C?LMUL
002E D003              POP     AR3
0030 D002              POP     AR2
0032 D001              POP     AR1
0034 D000              POP     AR0
0036 EF                MOV     A,R7
0037 2B                ADD     A,R3
0038 FF                MOV     R7,A
0039 EE                MOV     A,R6
003A 3A                ADDC    A,R2
003B FE                MOV     R6,A
003C ED                MOV     A,R5
003D 39                ADDC    A,R1
003E FD                MOV     R5,A
003F EC                MOV     A,R4
0040 38                ADDC    A,R0
0041 FC                MOV     R4,A
0042 780A              MOV     R0,#0AH
0044 120000      E     LCALL   ?C?SLSHR
0047 900000      R     MOV     DPTR,#aux
004A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 39
004D 900000      R     MOV     DPTR,#aux
0050 E0                MOVX    A,@DPTR
0051 FC                MOV     R4,A
0052 A3                INC     DPTR
0053 E0                MOVX    A,@DPTR
0054 FD                MOV     R5,A
0055 A3                INC     DPTR
0056 E0                MOVX    A,@DPTR
0057 FE                MOV     R6,A
0058 A3                INC     DPTR
0059 E0                MOVX    A,@DPTR
005A FF                MOV     R7,A
005B 900000      R     MOV     DPTR,#old_value
005E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 41
0061 900000      R     MOV     DPTR,#aux
0064 E0                MOVX    A,@DPTR
0065 FC                MOV     R4,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FD                MOV     R5,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B FE                MOV     R6,A
006C A3                INC     DPTR
006D E0                MOVX    A,@DPTR
006E FF                MOV     R7,A
006F 7806              MOV     R0,#06H
0071 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 42
0074         ?C0002:
0074 22                RET     
             ; FUNCTION _filter_i2 (END)

             ; FUNCTION _filter_vel_1 (BEGIN)
                                           ; SOURCE LINE # 48
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 52
0000 7806              MOV     R0,#06H
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 8   

0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B20              MOV     R3,#020H
0008 FA                MOV     R2,A
0009 F9                MOV     R1,A
000A F8                MOV     R0,A
000B 120000      E     LCALL   ?C?LMUL
000E C004              PUSH    AR4
0010 C005              PUSH    AR5
0012 C006              PUSH    AR6
0014 C007              PUSH    AR7
0016 E4                CLR     A
0017 7FE0              MOV     R7,#0E0H
0019 7E03              MOV     R6,#03H
001B FD                MOV     R5,A
001C FC                MOV     R4,A
001D 900000      R     MOV     DPTR,#old_value
0020 E0                MOVX    A,@DPTR
0021 F8                MOV     R0,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 F9                MOV     R1,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FA                MOV     R2,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FB                MOV     R3,A
002B 120000      E     LCALL   ?C?LMUL
002E D003              POP     AR3
0030 D002              POP     AR2
0032 D001              POP     AR1
0034 D000              POP     AR0
0036 EF                MOV     A,R7
0037 2B                ADD     A,R3
0038 FF                MOV     R7,A
0039 EE                MOV     A,R6
003A 3A                ADDC    A,R2
003B FE                MOV     R6,A
003C ED                MOV     A,R5
003D 39                ADDC    A,R1
003E FD                MOV     R5,A
003F EC                MOV     A,R4
0040 38                ADDC    A,R0
0041 FC                MOV     R4,A
0042 E4                CLR     A
0043 FB                MOV     R3,A
0044 7A04              MOV     R2,#04H
0046 F9                MOV     R1,A
0047 F8                MOV     R0,A
0048 120000      E     LCALL   ?C?SLDIV
004B 900000      R     MOV     DPTR,#aux
004E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 54
0051 900000      R     MOV     DPTR,#aux
0054 E0                MOVX    A,@DPTR
0055 FC                MOV     R4,A
0056 A3                INC     DPTR
0057 E0                MOVX    A,@DPTR
0058 FD                MOV     R5,A
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 9   

005B FE                MOV     R6,A
005C A3                INC     DPTR
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F 900000      R     MOV     DPTR,#old_value
0062 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 56
0065 900000      R     MOV     DPTR,#aux
0068 E0                MOVX    A,@DPTR
0069 FC                MOV     R4,A
006A A3                INC     DPTR
006B E0                MOVX    A,@DPTR
006C FD                MOV     R5,A
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F FE                MOV     R6,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FF                MOV     R7,A
0073 7806              MOV     R0,#06H
0075 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 57
0078         ?C0003:
0078 22                RET     
             ; FUNCTION _filter_vel_1 (END)

             ; FUNCTION _filter_vel_2 (BEGIN)
                                           ; SOURCE LINE # 59
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 63
0000 7806              MOV     R0,#06H
0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B20              MOV     R3,#020H
0008 FA                MOV     R2,A
0009 F9                MOV     R1,A
000A F8                MOV     R0,A
000B 120000      E     LCALL   ?C?LMUL
000E C004              PUSH    AR4
0010 C005              PUSH    AR5
0012 C006              PUSH    AR6
0014 C007              PUSH    AR7
0016 E4                CLR     A
0017 7FE0              MOV     R7,#0E0H
0019 7E03              MOV     R6,#03H
001B FD                MOV     R5,A
001C FC                MOV     R4,A
001D 900000      R     MOV     DPTR,#old_value
0020 E0                MOVX    A,@DPTR
0021 F8                MOV     R0,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 F9                MOV     R1,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FA                MOV     R2,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FB                MOV     R3,A
002B 120000      E     LCALL   ?C?LMUL
002E D003              POP     AR3
0030 D002              POP     AR2
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 10  

0032 D001              POP     AR1
0034 D000              POP     AR0
0036 EF                MOV     A,R7
0037 2B                ADD     A,R3
0038 FF                MOV     R7,A
0039 EE                MOV     A,R6
003A 3A                ADDC    A,R2
003B FE                MOV     R6,A
003C ED                MOV     A,R5
003D 39                ADDC    A,R1
003E FD                MOV     R5,A
003F EC                MOV     A,R4
0040 38                ADDC    A,R0
0041 FC                MOV     R4,A
0042 E4                CLR     A
0043 FB                MOV     R3,A
0044 7A04              MOV     R2,#04H
0046 F9                MOV     R1,A
0047 F8                MOV     R0,A
0048 120000      E     LCALL   ?C?SLDIV
004B 900000      R     MOV     DPTR,#aux
004E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 65
0051 900000      R     MOV     DPTR,#aux
0054 E0                MOVX    A,@DPTR
0055 FC                MOV     R4,A
0056 A3                INC     DPTR
0057 E0                MOVX    A,@DPTR
0058 FD                MOV     R5,A
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
005B FE                MOV     R6,A
005C A3                INC     DPTR
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F 900000      R     MOV     DPTR,#old_value
0062 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 67
0065 900000      R     MOV     DPTR,#aux
0068 E0                MOVX    A,@DPTR
0069 FC                MOV     R4,A
006A A3                INC     DPTR
006B E0                MOVX    A,@DPTR
006C FD                MOV     R5,A
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F FE                MOV     R6,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FF                MOV     R7,A
0073 7806              MOV     R0,#06H
0075 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 68
0078         ?C0004:
0078 22                RET     
             ; FUNCTION _filter_vel_2 (END)

             ; FUNCTION _filter_vel_3 (BEGIN)
                                           ; SOURCE LINE # 70
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 74
0000 7806              MOV     R0,#06H
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 11  

0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B20              MOV     R3,#020H
0008 FA                MOV     R2,A
0009 F9                MOV     R1,A
000A F8                MOV     R0,A
000B 120000      E     LCALL   ?C?LMUL
000E C004              PUSH    AR4
0010 C005              PUSH    AR5
0012 C006              PUSH    AR6
0014 C007              PUSH    AR7
0016 E4                CLR     A
0017 7FE0              MOV     R7,#0E0H
0019 7E03              MOV     R6,#03H
001B FD                MOV     R5,A
001C FC                MOV     R4,A
001D 900000      R     MOV     DPTR,#old_value
0020 E0                MOVX    A,@DPTR
0021 F8                MOV     R0,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 F9                MOV     R1,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FA                MOV     R2,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FB                MOV     R3,A
002B 120000      E     LCALL   ?C?LMUL
002E D003              POP     AR3
0030 D002              POP     AR2
0032 D001              POP     AR1
0034 D000              POP     AR0
0036 EF                MOV     A,R7
0037 2B                ADD     A,R3
0038 FF                MOV     R7,A
0039 EE                MOV     A,R6
003A 3A                ADDC    A,R2
003B FE                MOV     R6,A
003C ED                MOV     A,R5
003D 39                ADDC    A,R1
003E FD                MOV     R5,A
003F EC                MOV     A,R4
0040 38                ADDC    A,R0
0041 FC                MOV     R4,A
0042 E4                CLR     A
0043 FB                MOV     R3,A
0044 7A04              MOV     R2,#04H
0046 F9                MOV     R1,A
0047 F8                MOV     R0,A
0048 120000      E     LCALL   ?C?SLDIV
004B 900000      R     MOV     DPTR,#aux
004E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 76
0051 900000      R     MOV     DPTR,#aux
0054 E0                MOVX    A,@DPTR
0055 FC                MOV     R4,A
0056 A3                INC     DPTR
0057 E0                MOVX    A,@DPTR
0058 FD                MOV     R5,A
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 12  

005B FE                MOV     R6,A
005C A3                INC     DPTR
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F 900000      R     MOV     DPTR,#old_value
0062 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 78
0065 900000      R     MOV     DPTR,#aux
0068 E0                MOVX    A,@DPTR
0069 FC                MOV     R4,A
006A A3                INC     DPTR
006B E0                MOVX    A,@DPTR
006C FD                MOV     R5,A
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F FE                MOV     R6,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FF                MOV     R7,A
0073 7806              MOV     R0,#06H
0075 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 79
0078         ?C0005:
0078 22                RET     
             ; FUNCTION _filter_vel_3 (END)

             ; FUNCTION _filter_ch1 (BEGIN)
                                           ; SOURCE LINE # 85
0000 900000      R     MOV     DPTR,#new_value
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 89
0006 E4                CLR     A
0007 7F32              MOV     R7,#032H
0009 FE                MOV     R6,A
000A FD                MOV     R5,A
000B FC                MOV     R4,A
000C 900000      R     MOV     DPTR,#new_value
000F E0                MOVX    A,@DPTR
0010 F8                MOV     R0,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 F9                MOV     R1,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FA                MOV     R2,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FB                MOV     R3,A
001A 120000      E     LCALL   ?C?LMUL
001D C004              PUSH    AR4
001F C005              PUSH    AR5
0021 C006              PUSH    AR6
0023 C007              PUSH    AR7
0025 E4                CLR     A
0026 7FCE              MOV     R7,#0CEH
0028 7E03              MOV     R6,#03H
002A FD                MOV     R5,A
002B FC                MOV     R4,A
002C 900000      R     MOV     DPTR,#old_value
002F E0                MOVX    A,@DPTR
0030 F8                MOV     R0,A
0031 A3                INC     DPTR
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 13  

0032 E0                MOVX    A,@DPTR
0033 F9                MOV     R1,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FA                MOV     R2,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FB                MOV     R3,A
003A 120000      E     LCALL   ?C?LMUL
003D D003              POP     AR3
003F D002              POP     AR2
0041 D001              POP     AR1
0043 D000              POP     AR0
0045 EF                MOV     A,R7
0046 2B                ADD     A,R3
0047 FF                MOV     R7,A
0048 EE                MOV     A,R6
0049 3A                ADDC    A,R2
004A FE                MOV     R6,A
004B ED                MOV     A,R5
004C 39                ADDC    A,R1
004D FD                MOV     R5,A
004E EC                MOV     A,R4
004F 38                ADDC    A,R0
0050 FC                MOV     R4,A
0051 E4                CLR     A
0052 FB                MOV     R3,A
0053 7A04              MOV     R2,#04H
0055 F9                MOV     R1,A
0056 F8                MOV     R0,A
0057 120000      E     LCALL   ?C?SLDIV
005A 900000      R     MOV     DPTR,#aux
005D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 91
0060 900000      R     MOV     DPTR,#aux
0063 E0                MOVX    A,@DPTR
0064 FC                MOV     R4,A
0065 A3                INC     DPTR
0066 E0                MOVX    A,@DPTR
0067 FD                MOV     R5,A
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A FE                MOV     R6,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FF                MOV     R7,A
006E 900000      R     MOV     DPTR,#old_value
0071 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 93
0074 900000      R     MOV     DPTR,#aux
0077 E0                MOVX    A,@DPTR
0078 FC                MOV     R4,A
0079 A3                INC     DPTR
007A E0                MOVX    A,@DPTR
007B FD                MOV     R5,A
007C A3                INC     DPTR
007D E0                MOVX    A,@DPTR
007E FE                MOV     R6,A
007F A3                INC     DPTR
0080 E0                MOVX    A,@DPTR
0081 FF                MOV     R7,A
                                           ; SOURCE LINE # 94
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 14  

0082         ?C0006:
0082 22                RET     
             ; FUNCTION _filter_ch1 (END)

             ; FUNCTION _filter_ch2 (BEGIN)
                                           ; SOURCE LINE # 96
0000 900000      R     MOV     DPTR,#new_value
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 100
0006 E4                CLR     A
0007 7F32              MOV     R7,#032H
0009 FE                MOV     R6,A
000A FD                MOV     R5,A
000B FC                MOV     R4,A
000C 900000      R     MOV     DPTR,#new_value
000F E0                MOVX    A,@DPTR
0010 F8                MOV     R0,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 F9                MOV     R1,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FA                MOV     R2,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FB                MOV     R3,A
001A 120000      E     LCALL   ?C?LMUL
001D C004              PUSH    AR4
001F C005              PUSH    AR5
0021 C006              PUSH    AR6
0023 C007              PUSH    AR7
0025 E4                CLR     A
0026 7FCE              MOV     R7,#0CEH
0028 7E03              MOV     R6,#03H
002A FD                MOV     R5,A
002B FC                MOV     R4,A
002C 900000      R     MOV     DPTR,#old_value
002F E0                MOVX    A,@DPTR
0030 F8                MOV     R0,A
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 F9                MOV     R1,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FA                MOV     R2,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FB                MOV     R3,A
003A 120000      E     LCALL   ?C?LMUL
003D D003              POP     AR3
003F D002              POP     AR2
0041 D001              POP     AR1
0043 D000              POP     AR0
0045 EF                MOV     A,R7
0046 2B                ADD     A,R3
0047 FF                MOV     R7,A
0048 EE                MOV     A,R6
0049 3A                ADDC    A,R2
004A FE                MOV     R6,A
004B ED                MOV     A,R5
004C 39                ADDC    A,R1
004D FD                MOV     R5,A
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 15  

004E EC                MOV     A,R4
004F 38                ADDC    A,R0
0050 FC                MOV     R4,A
0051 E4                CLR     A
0052 FB                MOV     R3,A
0053 7A04              MOV     R2,#04H
0055 F9                MOV     R1,A
0056 F8                MOV     R0,A
0057 120000      E     LCALL   ?C?SLDIV
005A 900000      R     MOV     DPTR,#aux
005D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 102
0060 900000      R     MOV     DPTR,#aux
0063 E0                MOVX    A,@DPTR
0064 FC                MOV     R4,A
0065 A3                INC     DPTR
0066 E0                MOVX    A,@DPTR
0067 FD                MOV     R5,A
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A FE                MOV     R6,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FF                MOV     R7,A
006E 900000      R     MOV     DPTR,#old_value
0071 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 104
0074 900000      R     MOV     DPTR,#aux
0077 E0                MOVX    A,@DPTR
0078 FC                MOV     R4,A
0079 A3                INC     DPTR
007A E0                MOVX    A,@DPTR
007B FD                MOV     R5,A
007C A3                INC     DPTR
007D E0                MOVX    A,@DPTR
007E FE                MOV     R6,A
007F A3                INC     DPTR
0080 E0                MOVX    A,@DPTR
0081 FF                MOV     R7,A
                                           ; SOURCE LINE # 105
0082         ?C0007:
0082 22                RET     
             ; FUNCTION _filter_ch2 (END)

             ; FUNCTION _check_enc_data (BEGIN)
                                           ; SOURCE LINE # 114
;---- Variable 'value' assigned to Register 'R1/R2/R3' ----
                                           ; SOURCE LINE # 116
0000 7800        R     MOV     R0,#LOW p
0002 A603              MOV     @R0,AR3
0004 08                INC     R0
0005 A602              MOV     @R0,AR2
0007 08                INC     R0
0008 A601              MOV     @R0,AR1
                                           ; SOURCE LINE # 117
000A 120000      E     LCALL   ?C?CLDPTR
000D F500        R     MOV     a,A
                                           ; SOURCE LINE # 119
000F 7800        R     MOV     R0,#LOW p
0011 8603              MOV     AR3,@R0
0013 08                INC     R0
0014 08                INC     R0
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 16  

0015 06                INC     @R0
0016 E6                MOV     A,@R0
0017 18                DEC     R0
0018 7001              JNZ     ?C0025
001A 06                INC     @R0
001B         ?C0025:
001B F9                MOV     R1,A
001C 8602              MOV     AR2,@R0
001E 120000      E     LCALL   ?C?CLDPTR
0021 6200        R     XRL     a,A
                                           ; SOURCE LINE # 120
0023 7800        R     MOV     R0,#LOW p
0025 8603              MOV     AR3,@R0
0027 08                INC     R0
0028 08                INC     R0
0029 06                INC     @R0
002A E6                MOV     A,@R0
002B 18                DEC     R0
002C 7001              JNZ     ?C0026
002E 06                INC     @R0
002F         ?C0026:
002F F9                MOV     R1,A
0030 8602              MOV     AR2,@R0
0032 120000      E     LCALL   ?C?CLDPTR
0035 6200        R     XRL     a,A
                                           ; SOURCE LINE # 121
0037 7800        R     MOV     R0,#LOW p
0039 8603              MOV     AR3,@R0
003B 08                INC     R0
003C 08                INC     R0
003D 06                INC     @R0
003E E6                MOV     A,@R0
003F 18                DEC     R0
0040 7001              JNZ     ?C0027
0042 06                INC     @R0
0043         ?C0027:
0043 F9                MOV     R1,A
0044 8602              MOV     AR2,@R0
0046 120000      E     LCALL   ?C?CLDPTR
0049 6200        R     XRL     a,A
                                           ; SOURCE LINE # 122
004B E500        R     MOV     A,a
004D C4                SWAP    A
004E 540F              ANL     A,#0FH
0050 FF                MOV     R7,A
0051 E500        R     MOV     A,a
0053 540F              ANL     A,#0FH
0055 6F                XRL     A,R7
0056 F500        R     MOV     a,A
                                           ; SOURCE LINE # 124
0058 FF                MOV     R7,A
0059 7469              MOV     A,#069H
005B 7E96              MOV     R6,#096H
005D A807              MOV     R0,AR7
005F 08                INC     R0
0060 8005              SJMP    ?C0029
0062         ?C0028:
0062 CE                XCH     A,R6
0063 C3                CLR     C
0064 13                RRC     A
0065 CE                XCH     A,R6
0066 13                RRC     A
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 17  

0067         ?C0029:
0067 D8F9              DJNZ    R0,?C0028
0069 13                RRC     A
                                           ; SOURCE LINE # 126
006A         ?C0008:
006A 22                RET     
             ; FUNCTION _check_enc_data (END)

             ; FUNCTION calibration (BEGIN)
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 138
0000 900000      R     MOV     DPTR,#direction
0003 E0                MOVX    A,@DPTR
0004 707B              JNZ     ?C0009
                                           ; SOURCE LINE # 139
0006 900000      E     MOV     DPTR,#g_ref
0009 E0                MOVX    A,@DPTR
000A F8                MOV     R0,A
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
000D F9                MOV     R1,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FA                MOV     R2,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FB                MOV     R3,A
0014 C000              PUSH    AR0
0016 C001              PUSH    AR1
0018 C002              PUSH    AR2
001A C003              PUSH    AR3
001C 900000      E     MOV     DPTR,#g_mem+037H
001F E0                MOVX    A,@DPTR
0020 FF                MOV     R7,A
0021 900000      E     MOV     DPTR,#calib+02H
0024 E0                MOVX    A,@DPTR
0025 FE                MOV     R6,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 A807              MOV     R0,AR7
002A 08                INC     R0
002B 8005              SJMP    ?C0031
002D         ?C0030:
002D C3                CLR     C
002E 33                RLC     A
002F CE                XCH     A,R6
0030 33                RLC     A
0031 CE                XCH     A,R6
0032         ?C0031:
0032 D8F9              DJNZ    R0,?C0030
0034 FF                MOV     R7,A
0035 EE                MOV     A,R6
0036 33                RLC     A
0037 95E0              SUBB    A,ACC
0039 FD                MOV     R5,A
003A FC                MOV     R4,A
003B D003              POP     AR3
003D D002              POP     AR2
003F D001              POP     AR1
0041 D000              POP     AR0
0043 EB                MOV     A,R3
0044 2F                ADD     A,R7
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 18  

0045 FF                MOV     R7,A
0046 EA                MOV     A,R2
0047 3E                ADDC    A,R6
0048 FE                MOV     R6,A
0049 E9                MOV     A,R1
004A 3D                ADDC    A,R5
004B FD                MOV     R5,A
004C E8                MOV     A,R0
004D 3C                ADDC    A,R4
004E FC                MOV     R4,A
004F 900000      E     MOV     DPTR,#g_ref
0052 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 140
0055 900000      E     MOV     DPTR,#g_mem+064H
0058 E0                MOVX    A,@DPTR
0059 FC                MOV     R4,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C FD                MOV     R5,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FE                MOV     R6,A
0060 A3                INC     DPTR
0061 E0                MOVX    A,@DPTR
0062 FF                MOV     R7,A
0063 900000      E     MOV     DPTR,#g_ref
0066 E0                MOVX    A,@DPTR
0067 F8                MOV     R0,A
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A F9                MOV     R1,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FA                MOV     R2,A
006E A3                INC     DPTR
006F E0                MOVX    A,@DPTR
0070 FB                MOV     R3,A
0071 D3                SETB    C
0072 120000      E     LCALL   ?C?SLCMP
0075 5003              JNC     $ + 5H
0077 020000      R     LJMP    ?C0016
                                           ; SOURCE LINE # 141
007A 900000      R     MOV     DPTR,#direction
007D 7401              MOV     A,#01H
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 142
                                           ; SOURCE LINE # 143
0080 22                RET     
0081         ?C0009:
                                           ; SOURCE LINE # 144
0081 900000      E     MOV     DPTR,#g_ref
0084 E0                MOVX    A,@DPTR
0085 FC                MOV     R4,A
0086 A3                INC     DPTR
0087 E0                MOVX    A,@DPTR
0088 FD                MOV     R5,A
0089 A3                INC     DPTR
008A E0                MOVX    A,@DPTR
008B FE                MOV     R6,A
008C A3                INC     DPTR
008D E0                MOVX    A,@DPTR
008E FF                MOV     R7,A
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 19  

008F C004              PUSH    AR4
0091 C005              PUSH    AR5
0093 C006              PUSH    AR6
0095 C007              PUSH    AR7
0097 900000      E     MOV     DPTR,#g_mem+037H
009A E0                MOVX    A,@DPTR
009B FF                MOV     R7,A
009C 900000      E     MOV     DPTR,#calib+02H
009F E0                MOVX    A,@DPTR
00A0 FE                MOV     R6,A
00A1 A3                INC     DPTR
00A2 E0                MOVX    A,@DPTR
00A3 A807              MOV     R0,AR7
00A5 08                INC     R0
00A6 8005              SJMP    ?C0033
00A8         ?C0032:
00A8 C3                CLR     C
00A9 33                RLC     A
00AA CE                XCH     A,R6
00AB 33                RLC     A
00AC CE                XCH     A,R6
00AD         ?C0033:
00AD D8F9              DJNZ    R0,?C0032
00AF FF                MOV     R7,A
00B0 FB                MOV     R3,A
00B1 AA06              MOV     R2,AR6
00B3 EA                MOV     A,R2
00B4 33                RLC     A
00B5 95E0              SUBB    A,ACC
00B7 F9                MOV     R1,A
00B8 F8                MOV     R0,A
00B9 D007              POP     AR7
00BB D006              POP     AR6
00BD D005              POP     AR5
00BF D004              POP     AR4
00C1 C3                CLR     C
00C2 EF                MOV     A,R7
00C3 9B                SUBB    A,R3
00C4 FF                MOV     R7,A
00C5 EE                MOV     A,R6
00C6 9A                SUBB    A,R2
00C7 FE                MOV     R6,A
00C8 ED                MOV     A,R5
00C9 99                SUBB    A,R1
00CA FD                MOV     R5,A
00CB EC                MOV     A,R4
00CC 98                SUBB    A,R0
00CD FC                MOV     R4,A
00CE 900000      E     MOV     DPTR,#g_ref
00D1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 145
00D4 E4                CLR     A
00D5 FF                MOV     R7,A
00D6 FE                MOV     R6,A
00D7 FD                MOV     R5,A
00D8 FC                MOV     R4,A
00D9 900000      E     MOV     DPTR,#g_ref
00DC E0                MOVX    A,@DPTR
00DD F8                MOV     R0,A
00DE A3                INC     DPTR
00DF E0                MOVX    A,@DPTR
00E0 F9                MOV     R1,A
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 20  

00E1 A3                INC     DPTR
00E2 E0                MOVX    A,@DPTR
00E3 FA                MOV     R2,A
00E4 A3                INC     DPTR
00E5 E0                MOVX    A,@DPTR
00E6 FB                MOV     R3,A
00E7 C3                CLR     C
00E8 120000      E     LCALL   ?C?SLCMP
00EB 4006              JC      ?C0013
00ED 7E00              MOV     R6,#00H
00EF 7F01              MOV     R7,#01H
00F1 8004              SJMP    ?C0014
00F3         ?C0013:
00F3 7EFF              MOV     R6,#0FFH
00F5 7FFF              MOV     R7,#0FFH
00F7         ?C0014:
00F7 EF                MOV     A,R7
00F8 6401              XRL     A,#01H
00FA 4E                ORL     A,R6
00FB 6032              JZ      ?C0016
                                           ; SOURCE LINE # 146
00FD E4                CLR     A
00FE 900000      R     MOV     DPTR,#direction
0101 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 147
0102 900000      R     MOV     DPTR,#closure_counter+01H
0105 E0                MOVX    A,@DPTR
0106 04                INC     A
0107 F0                MOVX    @DPTR,A
0108 7006              JNZ     ?C0034
010A 900000      R     MOV     DPTR,#closure_counter
010D E0                MOVX    A,@DPTR
010E 04                INC     A
010F F0                MOVX    @DPTR,A
0110         ?C0034:
                                           ; SOURCE LINE # 148
0110 900000      R     MOV     DPTR,#closure_counter
0113 E0                MOVX    A,@DPTR
0114 FE                MOV     R6,A
0115 A3                INC     DPTR
0116 E0                MOVX    A,@DPTR
0117 FF                MOV     R7,A
0118 900000      E     MOV     DPTR,#calib+04H
011B E0                MOVX    A,@DPTR
011C B50610            CJNE    A,AR6,?C0016
011F A3                INC     DPTR
0120 E0                MOVX    A,@DPTR
0121 B5070B            CJNE    A,AR7,?C0016
                                           ; SOURCE LINE # 149
0124 E4                CLR     A
0125 900000      R     MOV     DPTR,#closure_counter
0128 F0                MOVX    @DPTR,A
0129 A3                INC     DPTR
012A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 150
012B 900000      E     MOV     DPTR,#calib
012E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 151
                                           ; SOURCE LINE # 152
                                           ; SOURCE LINE # 153
                                           ; SOURCE LINE # 154
012F         ?C0016:
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 21  

012F 22                RET     
             ; FUNCTION calibration (END)

             ; FUNCTION _my_mod (BEGIN)
                                           ; SOURCE LINE # 160
0000 900000      R     MOV     DPTR,#val
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 162
0006 E4                CLR     A
0007 FF                MOV     R7,A
0008 FE                MOV     R6,A
0009 FD                MOV     R5,A
000A FC                MOV     R4,A
000B 900000      R     MOV     DPTR,#val
000E E0                MOVX    A,@DPTR
000F F8                MOV     R0,A
0010 A3                INC     DPTR
0011 E0                MOVX    A,@DPTR
0012 F9                MOV     R1,A
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015 FA                MOV     R2,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 FB                MOV     R3,A
0019 C3                CLR     C
001A 120000      E     LCALL   ?C?SLCMP
001D 4028              JC      ?C0017
                                           ; SOURCE LINE # 163
001F 900000      R     MOV     DPTR,#divisor
0022 E0                MOVX    A,@DPTR
0023 F8                MOV     R0,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 F9                MOV     R1,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 FA                MOV     R2,A
002A A3                INC     DPTR
002B E0                MOVX    A,@DPTR
002C FB                MOV     R3,A
002D 900000      R     MOV     DPTR,#val
0030 E0                MOVX    A,@DPTR
0031 FC                MOV     R4,A
0032 A3                INC     DPTR
0033 E0                MOVX    A,@DPTR
0034 FD                MOV     R5,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FE                MOV     R6,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FF                MOV     R7,A
003B 120000      E     LCALL   ?C?SLDIV
003E AC00              MOV     R4,AR0
0040 AD01              MOV     R5,AR1
0042 AE02              MOV     R6,AR2
0044 AF03              MOV     R7,AR3
0046 22                RET     
                                           ; SOURCE LINE # 164
0047         ?C0017:
                                           ; SOURCE LINE # 165
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 22  

0047 900000      R     MOV     DPTR,#val
004A E0                MOVX    A,@DPTR
004B FC                MOV     R4,A
004C A3                INC     DPTR
004D E0                MOVX    A,@DPTR
004E FD                MOV     R5,A
004F A3                INC     DPTR
0050 E0                MOVX    A,@DPTR
0051 FE                MOV     R6,A
0052 A3                INC     DPTR
0053 E0                MOVX    A,@DPTR
0054 FF                MOV     R7,A
0055 120000      E     LCALL   ?C?LNEG
0058 A3                INC     DPTR
0059 E0                MOVX    A,@DPTR
005A F8                MOV     R0,A
005B A3                INC     DPTR
005C E0                MOVX    A,@DPTR
005D F9                MOV     R1,A
005E A3                INC     DPTR
005F E0                MOVX    A,@DPTR
0060 FA                MOV     R2,A
0061 A3                INC     DPTR
0062 E0                MOVX    A,@DPTR
0063 FB                MOV     R3,A
0064 120000      E     LCALL   ?C?SLDIV
0067 900000      R     MOV     DPTR,#divisor
006A E0                MOVX    A,@DPTR
006B FC                MOV     R4,A
006C A3                INC     DPTR
006D E0                MOVX    A,@DPTR
006E FD                MOV     R5,A
006F A3                INC     DPTR
0070 E0                MOVX    A,@DPTR
0071 FE                MOV     R6,A
0072 A3                INC     DPTR
0073 E0                MOVX    A,@DPTR
0074 C3                CLR     C
0075 9B                SUBB    A,R3
0076 FF                MOV     R7,A
0077 EE                MOV     A,R6
0078 9A                SUBB    A,R2
0079 FE                MOV     R6,A
007A ED                MOV     A,R5
007B 99                SUBB    A,R1
007C FD                MOV     R5,A
007D EC                MOV     A,R4
007E 98                SUBB    A,R0
007F FC                MOV     R4,A
                                           ; SOURCE LINE # 166
                                           ; SOURCE LINE # 167
0080         ?C0018:
0080 22                RET     
             ; FUNCTION _my_mod (END)

             ; FUNCTION _calc_turns_fcn (BEGIN)
                                           ; SOURCE LINE # 202
0000 900000      R     MOV     DPTR,#pos1
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 204
0006 E4                CLR     A
0007 7F1C              MOV     R7,#01CH
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 23  

0009 FE                MOV     R6,A
000A FD                MOV     R5,A
000B FC                MOV     R4,A
000C 900000      R     MOV     DPTR,#pos1
000F E0                MOVX    A,@DPTR
0010 F8                MOV     R0,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 F9                MOV     R1,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FA                MOV     R2,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FB                MOV     R3,A
001A 120000      E     LCALL   ?C?LMUL
001D C004              PUSH    AR4
001F C005              PUSH    AR5
0021 C006              PUSH    AR6
0023 C007              PUSH    AR7
0025 74FF              MOV     A,#0FFH
0027 7FE5              MOV     R7,#0E5H
0029 FE                MOV     R6,A
002A FD                MOV     R5,A
002B FC                MOV     R4,A
002C 900000      R     MOV     DPTR,#pos2
002F E0                MOVX    A,@DPTR
0030 F8                MOV     R0,A
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 F9                MOV     R1,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FA                MOV     R2,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FB                MOV     R3,A
003A 120000      E     LCALL   ?C?LMUL
003D D003              POP     AR3
003F D002              POP     AR2
0041 D001              POP     AR1
0043 D000              POP     AR0
0045 C3                CLR     C
0046 EF                MOV     A,R7
0047 9B                SUBB    A,R3
0048 FF                MOV     R7,A
0049 EE                MOV     A,R6
004A 9A                SUBB    A,R2
004B FE                MOV     R6,A
004C ED                MOV     A,R5
004D 99                SUBB    A,R1
004E FD                MOV     R5,A
004F EC                MOV     A,R4
0050 98                SUBB    A,R0
0051 FC                MOV     R4,A
0052 C004              PUSH    AR4
0054 C005              PUSH    AR5
0056 C006              PUSH    AR6
0058 C007              PUSH    AR7
005A E4                CLR     A
005B FF                MOV     R7,A
005C FE                MOV     R6,A
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 24  

005D 7D1B              MOV     R5,#01BH
005F FC                MOV     R4,A
0060 900000      R     MOV     DPTR,#?_my_mod?BYTE+04H
0063 120000      E     LCALL   ?C?LSTXDATA
0066 D007              POP     AR7
0068 D006              POP     AR6
006A D005              POP     AR5
006C D004              POP     AR4
006E 120000      R     LCALL   _my_mod
0071 E4                CLR     A
0072 2F                ADD     A,R7
0073 FF                MOV     R7,A
0074 EE                MOV     A,R6
0075 3480              ADDC    A,#080H
0077 FE                MOV     R6,A
0078 E4                CLR     A
0079 3D                ADDC    A,R5
007A FD                MOV     R5,A
007B E4                CLR     A
007C 3C                ADDC    A,R4
007D FC                MOV     R4,A
007E E4                CLR     A
007F FB                MOV     R3,A
0080 FA                MOV     R2,A
0081 7901              MOV     R1,#01H
0083 F8                MOV     R0,A
0084 120000      E     LCALL   ?C?ULDIV
;---- Variable 'x' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 206
0087 C004              PUSH    AR4
0089 C005              PUSH    AR5
008B C006              PUSH    AR6
008D C007              PUSH    AR7
008F E4                CLR     A
0090 7F1B              MOV     R7,#01BH
0092 FE                MOV     R6,A
0093 FD                MOV     R5,A
0094 FC                MOV     R4,A
0095 900000      R     MOV     DPTR,#?_my_mod?BYTE+04H
0098 120000      E     LCALL   ?C?LSTXDATA
009B D007              POP     AR7
009D D006              POP     AR6
009F D005              POP     AR5
00A1 D004              POP     AR4
00A3 120000      R     LCALL   _my_mod
;---- Variable 'aux' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 208
00A6 EF                MOV     A,R7
00A7 240D              ADD     A,#0DH
00A9 FF                MOV     R7,A
00AA E4                CLR     A
00AB 3E                ADDC    A,R6
00AC FE                MOV     R6,A
00AD E4                CLR     A
00AE 3D                ADDC    A,R5
00AF FD                MOV     R5,A
00B0 E4                CLR     A
00B1 3C                ADDC    A,R4
00B2 FC                MOV     R4,A
00B3 C004              PUSH    AR4
00B5 C005              PUSH    AR5
00B7 C006              PUSH    AR6
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 25  

00B9 C007              PUSH    AR7
00BB E4                CLR     A
00BC 7F1B              MOV     R7,#01BH
00BE FE                MOV     R6,A
00BF FD                MOV     R5,A
00C0 FC                MOV     R4,A
00C1 900000      R     MOV     DPTR,#?_my_mod?BYTE+04H
00C4 120000      E     LCALL   ?C?LSTXDATA
00C7 D007              POP     AR7
00C9 D006              POP     AR6
00CB D005              POP     AR5
00CD D004              POP     AR4
00CF 120000      R     LCALL   _my_mod
00D2 EF                MOV     A,R7
00D3 24F3              ADD     A,#0F3H
00D5 FF                MOV     R7,A
00D6 EE                MOV     A,R6
00D7 34FF              ADDC    A,#0FFH
00D9 FE                MOV     R6,A
                                           ; SOURCE LINE # 209
00DA         ?C0020:
00DA 22                RET     
             ; FUNCTION _calc_turns_fcn (END)

             ; FUNCTION _LCRChecksum (BEGIN)
                                           ; SOURCE LINE # 218
0000 900000      R     MOV     DPTR,#data_array
0003 EB                MOV     A,R3
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EA                MOV     A,R2
0007 F0                MOVX    @DPTR,A
0008 A3                INC     DPTR
0009 E9                MOV     A,R1
000A F0                MOVX    @DPTR,A
;---- Variable 'data_length' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 221
000B E4                CLR     A
000C F500        R     MOV     checksum,A
                                           ; SOURCE LINE # 223
000E F500        R     MOV     i,A
0010         ?C0021:
0010 E500        R     MOV     A,i
0012 C3                CLR     C
0013 9D                SUBB    A,R5
0014 5019              JNC     ?C0022
                                           ; SOURCE LINE # 224
0016 900000      R     MOV     DPTR,#data_array
0019 E0                MOVX    A,@DPTR
001A FB                MOV     R3,A
001B A3                INC     DPTR
001C E0                MOVX    A,@DPTR
001D FA                MOV     R2,A
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 2500        R     ADD     A,i
0022 F9                MOV     R1,A
0023 E4                CLR     A
0024 3A                ADDC    A,R2
0025 FA                MOV     R2,A
0026 120000      E     LCALL   ?C?CLDPTR
0029 6200        R     XRL     checksum,A
C51 COMPILER V9.51   UTILS                                                                 02/07/2017 16:12:06 PAGE 26  

002B 0500        R     INC     i
002D 80E1              SJMP    ?C0021
002F         ?C0022:
                                           ; SOURCE LINE # 226
002F AF00        R     MOV     R7,checksum
                                           ; SOURCE LINE # 227
0031         ?C0024:
0031 22                RET     
             ; FUNCTION _LCRChecksum (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1668    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     59      27
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----       3
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
